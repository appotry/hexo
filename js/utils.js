$(document).ready(function(){let articleCardHover=function(){let animateClass="animated pulse";$("article .article").hover(function(){$(this).addClass(animateClass)},function(){$(this).removeClass(animateClass)});$("#recommend-sections .post-card").hover(function(){$(this).addClass(animateClass)},function(){$(this).removeClass(animateClass)})};articleCardHover();let fixFooterPosition=function(){jQuery("main.content").css("min-height",window.innerHeight-165)};let fixStyles=function(){fixPostCardWidth("navContainer");fixPostCardWidth("artDetail","prenext-posts");fixFooterPosition()};fixStyles();jQuery(window).resize(function(){fixStyles();AOS.refresh();jQuery("#articles").masonry("reloadItems");progressBarInit()});jQuery("#articles").masonry({itemSelector:".article"});AOS.init({easing:"ease-in-out-sine",duration:700,delay:100,disable:function(){var maxWidth=960;return window.innerWidth<maxWidth}});$("#read_mode i, #read_mode span, .code-area .code-show-expand").on("click",function(e){if(e.target!==this)return;var isCodeExpandButton=$(this).hasClass("code-show-expand");var $parentCard=$(this).parent().parent().parent().parent();$parentCard.toggleClass("card-block-fullscreen");$("html").toggleClass("card-block-fullscreen-html-scroll");if(isCodeExpandButton){if($parentCard.hasClass("code-block-fullscreen")){$parentCard.removeClass("code-block-fullscreen");$("html").removeClass("code-block-fullscreen-html-scroll")}else{$parentCard.addClass("code-block-fullscreen");$("html").addClass("code-block-fullscreen-html-scroll")}}var $icon=$(this).is("i")?$(this):$(this).prev("i");if($icon.hasClass("fa-expand-arrows-alt")){$icon.removeClass("fa-expand-arrows-alt").addClass("fa-compress-arrows-alt")}else{$icon.removeClass("fa-compress-arrows-alt").addClass("fa-expand-arrows-alt")}});let articleInit=function(){$("#articleContent a[href^='http']").attr("target","_blank");$("#articleContent img").each(function(){let imgPath=$(this).attr("src");$(this).wrap('<div class="img-item" data-src="'+imgPath+'" data-sub-html=".caption"></div>');$(this).css("max-width","99%");$(this).addClass("img-shadow img-margin");let alt=$(this).attr("alt");let title=$(this).attr("title");let captionText="";if(alt===undefined||alt===""){if(title!==undefined&&title!==""){captionText=title}}else{captionText=alt}if(captionText!==""){let captionDiv=document.createElement("div");captionDiv.className="caption";let captionEle=document.createElement("b");captionEle.className="center-caption";captionEle.innerText=captionText;captionDiv.appendChild(captionEle);this.insertAdjacentElement("afterend",captionDiv)}});$("#articleContent, #myGallery").lightGallery({selector:".img-item",subHtmlSelectorRelative:true})};articleInit();progressBarInit();Matery.events.registerRefreshCallback(function(){fixStyles();AOS.refresh();jQuery("#articles").masonry("reloadItems");progressBarInit()});$(".modal").modal();jQuery("#headNav .sidenav").sidenav();let $nav=$("#headNav");let $backTop=$(".top-scroll");var lastScroll=0;showOrHideNavBg($(window).scrollTop());$(window).scroll(function(){let scroll=$(window).scrollTop();showOrHideNavBg(scroll);if($("#artDetail").length>0){if(lastScroll-scroll<=0){if(scroll>100){$nav.removeClass("nav-transparent");$nav.addClass("nav-transparent-none")}}else{$nav.removeClass("nav-transparent-none")}lastScroll=scroll}});function showOrHideNavBg(position){let showPosition=100;if(position<showPosition){$nav.addClass("nav-transparent");$backTop.slideUp(300)}else{$nav.removeClass("nav-transparent");$backTop.slideDown(300)}}$(".nav-menu>li").hover(function(){$(this).children("ul").stop(true,true).show();$(this).addClass("nav-show").siblings("li").removeClass("nav-show")},function(){$(this).children("ul").stop(true,true).hide();$(".nav-item.nav-show").removeClass("nav-show")});$(".m-nav-item>a").on("click",function(){if($(this).next("ul").css("display")=="none"){$(".m-nav-item").children("ul").slideUp(300);$(this).next("ul").slideDown(100);$(this).parent("li").addClass("m-nav-show").siblings("li").removeClass("m-nav-show")}else{$(this).next("ul").slideUp(100);$(".m-nav-item.m-nav-show").removeClass("m-nav-show")}});jQuery(".tooltipped").tooltip()});function windowResizeEvent(){window.onresize=function(){var target=this;if(target.resizeFlag){clearTimeout(target.resizeFlag)}target.resizeFlag=setTimeout(function(){AOS.refresh();target.resizeFlag=null},100)}}function progressBarInit(){const progressElement=window.document.querySelector(".progress-bar");if(progressElement){new ScrollProgress((x,y)=>{progressElement.style.width=y*100+"%"})}}function scrollToElement(target,offset){var of=jQuery(target).offset();if(of){jQuery("html,body").animate({scrollTop:of.top+(offset||0),easing:"swing"})}}function registerScrollDownArrowEvent(){var scrollbar=jQuery(".cover.scroll-down-bar");if(scrollbar.length===0){return false}scrollbar.on("click",function(){scrollToElement("main.content",-jQuery("#headNav").height()+30)})}function registerScrollBackCommentEvent(){var scrollbar=jQuery("#to_comment");if(scrollbar.length===0){return false}scrollbar.on("click",function(){scrollToElement("#comments",-jQuery("#headNav").height()+30)})}function postOutdate(){var times=document.getElementsByTagName("time");if(times.length===0){return}var posts=document.getElementsByClassName("article-card-content");if(posts.length===0){return}var pubTime=new Date(times[0].dateTime);var modTime=new Date(times[1].dateTime);var now=Date.now();var intervalPub=parseInt(now-pubTime);var intervalMod=parseInt(now-modTime);var warning_day=CONFIG.outdate.warning_day;if(intervalMod>3600*24*warning_day*1e3){var pubdays=parseInt(intervalPub/864e5);var moddays=parseInt(intervalMod/864e5);articleContent.innerHTML='<div class="admonition warning"><p class="admonition-title">文章时效性提示</p><p>这是一篇发布于 '+pubdays+" 天前，最近更新于 "+moddays+" 天前的文章，部分信息可能已发生改变，请注意甄别！"+"</p></div>"+articleContent.innerHTML}}function setLS(k,v){try{localStorage.setItem(k,v)}catch(e){}}function removeLS(k){try{localStorage.removeItem(k)}catch(e){}}function getLS(k){try{return localStorage.getItem(k)}catch(e){return null}}function registerColorToggleCallback(erChart,elementId,option){var colorToggleButtonSelector="#color-toggle-btn";var colorToggleButton=document.querySelector(colorToggleButtonSelector);colorToggleButton.addEventListener("click",function(){erChart.dispose();erChart=echarts.init(document.getElementById(elementId),getLS(colorSchemaInitStorageKey));erChart.setOption(option)})}function fixPostCardWidth(srcId,targetId){let srcDiv=$("#"+srcId);if(srcDiv.length===0){return}let w=srcDiv.width();if(w>=450){w=w+21}else if(w>=350&&w<450){w=w+18}else if(w>=300&&w<350){w=w+16}else{w=w+14}$("#"+targetId).width(w)}function inPageScroll(){var forEach=function(array,callback,scope){for(var i=0;i<array.length;i++){callback.call(scope,i,array[i])}};var anchorLinks=document.querySelectorAll("#articleContent a[href^='#']");if(window.scrollTo){forEach(anchorLinks,function(index,element){var target=document.getElementById(element.getAttribute("href").substring(1));element.addEventListener("click",function(el){el.preventDefault();window.scrollTo(0,target.offsetTop)})})}}function handleVideoWithCondition(windowWidth,viewCount){if($(window).width()>windowWidth&&Number(viewCount)>3){var jsonUrl=CONFIG.fun_features.videobg.url;$.getJSON(jsonUrl,function(data){handleVideoData(data)})}}function setAjaxBackgroundImage(imageUrl,insertLocation){$.ajax({url:imageUrl,method:"GET",cache:true,success:function(){var image=$("<img>");image.attr("src",imageUrl);image.css({"background-image":"url("+imageUrl+")","background-repeat":"no-repeat","background-size":"cover","background-attachment":"fixed",position:"fixed",height:"100%","z-index":"-999"});adjustVideoSize(image);jQuery(window).resize(function(){adjustVideoSize(image)});insertLocation.prepend(image)}})}function setBackgroundImage(imageUrl,insertLocation){var image=$("<img>");image.on("load",function(){image.css({"background-image":"url("+imageUrl+")","background-repeat":"no-repeat","background-size":"cover","background-attachment":"fixed",position:"fixed",height:"100%","z-index":"-999"});adjustVideoSize(image);jQuery(window).resize(function(){adjustVideoSize(image)});insertLocation.prepend(image)});image.attr("src",imageUrl)}function adjustVideoSize(body){var height=document.documentElement.clientHeight;var width=document.documentElement.clientWidth;if(height/width<.56){body.css({width:"100%",height:"auto"})}else{body.css({width:"auto",height:"100%"})}}function insertAjaxVideo(videoUrl,insertLocation){$.ajax({url:videoUrl,method:"GET",cache:true,success:function(){var video=document.createElement("video");video.src=videoUrl;video.autoplay=true;video.loop=true;video.muted=true;video.style.position="fixed";video.style.zIndex="-888";adjustVideoSize($(video));jQuery(window).resize(function(){adjustVideoSize($(video))});insertLocation.prepend(video)}})}function insertVideo(videoUrl,insertLocation){var video=document.createElement("video");video.src=videoUrl;video.autoplay=true;video.loop=true;video.muted=true;video.style.position="fixed";video.style.zIndex="-888";video.addEventListener("loadedmetadata",function(){adjustVideoSize($(video));window.addEventListener("resize",function(){adjustVideoSize($(video))});insertLocation.prepend(video)})}function handleVideoData(data){if(true){var video_list_length=data.length;var seed=Math.random();index=Math.floor(seed*video_list_length);videoUrl=data[index][0];imageUrl=data[index][1];var insertLocation=$("body");setBackgroundImage(imageUrl,insertLocation);var ua=navigator.userAgent;var isMobile=null;if(ua){var ipad=ua.match(/(iPad).*OS\s([\d_]+)/);var isIphone=!ipad&&ua.match(/(iPhone\sOS)\s([\d_]+)/);var isAndroid=ua.match(/(Android)\s+([\d.]+)/);var isMobile=isIphone||isAndroid}else{console.log("无法确定用户代理，执行默认操作")}if(isMobile===null){var insertLocation=$("body");insertVideo(videoUrl,insertLocation)}}}window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;Matery.utils={setCookie:function(name,value,days){const date=new Date;date.setTime(date.getTime()+days*864e5);document.cookie=`${name}=${value};expires=${date.toUTCString()};path=/`},getCookie:function(name){return document.cookie.split(";").map(c=>c.trim()).find(c=>c.startsWith(`${name}=`))?.split("=")[1]||null},setLS:function(k,v){try{localStorage.setItem(k,JSON.stringify(v))}catch(e){console.error("localStorage 写入失败:",e)}},removeLS:function(k){try{localStorage.removeItem(k)}catch(e){console.error("localStorage 删除失败:",e)}},getLS:function(k){try{const data=localStorage.getItem(k);return data?JSON.parse(data):null}catch(e){console.error("localStorage 读取失败:",e);return null}},listenScroll:function(callback){var dbc=new Debouncer(callback,100);window.addEventListener("scroll",dbc,false);dbc.handleEvent();return dbc},unlistenScroll:function(callback){window.removeEventListener("scroll",callback)},listenDOMLoaded(callback){if(document.readyState!=="loading"){callback()}else{document.addEventListener("DOMContentLoaded",function(){callback()})}},scrollToElement:function(target,offset){var of=jQuery(target).offset();if(of){jQuery("html,body").animate({scrollTop:of.top+(offset||0),easing:"swing"})}},throttle:function(callback,delay){var wait=arguments.length<=1||arguments[1]===undefined?100:delay;var timer=null;return function(){var _this=this;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(timer===null){timer=setTimeout(function(){callback.apply(_this,args);timer=null},wait)}}},elementVisible:function(element,offsetFactor){offsetFactor=offsetFactor&&offsetFactor>=0?offsetFactor:0;var rect=element.getBoundingClientRect();const viewportHeight=(window.innerHeight||document.documentElement.clientHeight)*(1+offsetFactor);const viewportWidth=(window.innerWidth||document.documentElement.clientWidth)*(1+offsetFactor);return rect.top<viewportHeight||rect.bottom>0||rect.left<viewportWidth||rect.right>0},waitElementVisible:function(selectorOrElement,callback,offsetFactor){var runningOnBrowser=typeof window!=="undefined";var isBot=runningOnBrowser&&!("onscroll"in window)||typeof navigator!=="undefined"&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);if(!runningOnBrowser||isBot){return}offsetFactor=Number(offsetFactor)||0;offsetFactor=Math.max(offsetFactor,0);var throttledCallback=Matery.utils.throttle(callback,200);var observerMap=new Map;function getObserver(marginValue){if(!observerMap.has(marginValue)){var observer=new IntersectionObserver(function(entries){entries.forEach(function(entry){if(entry.isIntersecting){observer.unobserve(entry.target);throttledCallback()}})},{threshold:.001,rootMargin:"0px 0px "+marginValue+" 0px"});observerMap.set(marginValue,observer)}return observerMap.get(marginValue)}function waitInViewport(element){Matery.utils.listenDOMLoaded(function(){if(element.classList.contains("loaded")){throttledCallback();return}if(Matery.utils.elementVisible(element,offsetFactor)){throttledCallback();return}if("IntersectionObserver"in window){var marginValue=Math.round((window.innerHeight||document.documentElement.clientHeight)*offsetFactor)+"px";var observer=getObserver(marginValue);observer.observe(element)}else{var wrapper=Matery.utils.listenScroll(function(){if(Matery.utils.elementVisible(element,offsetFactor)){Matery.utils.unlistenScroll(wrapper);throttledCallback()}})}})}if(typeof selectorOrElement==="string"){this.waitElementLoaded(selectorOrElement,function(element){waitInViewport(element)})}else{waitInViewport(selectorOrElement)}},waitElementLoaded:function(selector,callback){var runningOnBrowser=typeof window!=="undefined";var isBot=runningOnBrowser&&!("onscroll"in window)||typeof navigator!=="undefined"&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);if(!runningOnBrowser||isBot){return}if("MutationObserver"in window){var mo=new MutationObserver(function(records,ob){var ele=document.querySelector(selector);if(ele){callback(ele);ob.disconnect()}});mo.observe(document,{childList:true,subtree:true})}else{Matery.utils.listenDOMLoaded(function(){var waitLoop=function(){var ele=document.querySelector(selector);if(ele){callback(ele)}else{setTimeout(waitLoop,100)}};waitLoop()})}},createScript:function(url,onload){var s=document.createElement("script");s.setAttribute("src",url);s.setAttribute("type","text/javascript");s.setAttribute("charset","UTF-8");s.async=false;if(typeof onload==="function"){if(window.attachEvent){s.onreadystatechange=function(){var e=s.readyState;if(e==="loaded"||e==="complete"){s.onreadystatechange=null;onload()}}}else{s.onload=onload}}var ss=document.getElementsByTagName("script");var e=ss.length>0?ss[ss.length-1]:document.head||document.documentElement;e.parentNode.insertBefore(s,e.nextSibling)},createAsyncScript:function(url,isAsync,onload){var s=document.createElement("script");s.setAttribute("src",url);s.setAttribute("type","text/javascript");s.setAttribute("charset","UTF-8");s.async=isAsync;if(typeof onload==="function"){if(window.attachEvent){s.onreadystatechange=function(){var e=s.readyState;if(e==="loaded"||e==="complete"){s.onreadystatechange=null;onload()}}}else{s.onload=onload}}var ss=document.getElementsByTagName("script");var e=ss.length>0?ss[ss.length-1]:document.head||document.documentElement;e.parentNode.insertBefore(s,e.nextSibling)},createCssLink:function(url){var l=document.createElement("link");l.setAttribute("rel","stylesheet");l.setAttribute("type","text/css");l.setAttribute("href",url);var e=document.getElementsByTagName("link")[0]||document.getElementsByTagName("head")[0]||document.head||document.documentElement;e.parentNode.insertBefore(l,e)},loadComments:function(selector,loadFunc){var ele=document.querySelector("#comments[lazyload]");if(ele){var callback=function(){loadFunc();ele.removeAttribute("lazyload")};Matery.utils.waitElementVisible(selector,callback,CONFIG.lazyload.offset_factor)}else{loadFunc()}},getBackgroundLightness(selectorOrElement){var ele=selectorOrElement;if(typeof selectorOrElement==="string"){ele=document.querySelector(selectorOrElement)}var view=ele.ownerDocument.defaultView;if(!view){view=window}var rgbArr=view.getComputedStyle(ele).backgroundColor.replace(/rgba*\(/,"").replace(")","").split(/,\s*/);if(rgbArr.length<3){return 0}var colorCast=.213*rgbArr[0]+.715*rgbArr[1]+.072*rgbArr[2];return colorCast===0||colorCast>255/2?1:-1},retry(handler,interval,times){if(times<=0){return}var next=function(){if(--times>=0&&!handler()){setTimeout(next,interval)}};setTimeout(next,interval)}};function Debouncer(callback){this.callback=callback;this.ticking=false}Debouncer.prototype={constructor:Debouncer,update:function(){this.callback&&this.callback();this.ticking=false},requestTick:function(){if(!this.ticking){requestAnimationFrame(this.rafCallback||(this.rafCallback=this.update.bind(this)));this.ticking=true}},handleEvent:function(){this.requestTick()}};