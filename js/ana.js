const website_id=CONFIG.web_analytics.umami.website_id;const request_url=CONFIG.web_analytics.umami.api_server+"/api/websites/"+website_id+"/stats";const start_time=new Date(CONFIG.web_analytics.umami.start_time).getTime();const end_time=(new Date).getTime();const token=CONFIG.web_analytics.umami.token;if(!website_id){throw new Error("Umami website_id is empty")}if(!request_url){throw new Error("Umami request_url is empty")}if(!start_time){throw new Error("Umami start_time is empty")}if(!token){throw new Error("Umami token is empty")}const params=new URLSearchParams({startAt:start_time,endAt:end_time});const request_header={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+token}};async function siteStats(){try{const response=await fetch(`${request_url}?${params}`,request_header);const data=await response.json();const totalTraffic=data.pageviews.value;const uniqueVisitors=data.visitors.value;let pvCtn=document.querySelector("#busuanzi_container_site_pv");if(pvCtn){let ele=document.querySelector("#busuanzi_value_site_pv");if(ele){ele.textContent=totalTraffic;pvCtn.style.display="inline-block";document.getElementById("busuanzi_loading_icon_site_pv").style.display="none"}}let uvCtn=document.querySelector("#busuanzi_container_site_uv");if(uvCtn){let ele=document.querySelector("#busuanzi_value_site_uv");if(ele){ele.textContent=uniqueVisitors;uvCtn.style.display="inline-block";document.getElementById("busuanzi_loading_icon_site_uv").style.display="none"}}}catch(error){console.error(error);return"-1"}}async function pageStats(path){try{const response=await fetch(`${request_url}?${params}&url=${path}`,request_header);const data=await response.json();const pageViews=data.pageviews.value;let viewCtn=document.querySelector("#umami-page-views-container");if(viewCtn){let ele=document.querySelector("#umami-page-views");if(ele){ele.textContent=pageViews;viewCtn.style.display="inline";document.getElementById("umami-page-views").style.display="inline-block";document.getElementById("umami_pageviews_loading_icon").style.display="none"}}}catch(error){console.error(error);return"-1"}}siteStats();let viewCtn=document.querySelector("#umami-page-views-container");if(viewCtn){let path=window.location.pathname.replace(/\/$/,"")+"/";let target=decodeURI(path.replace(/\/*(index.html)?$/,"/"));pageStats(target)}function trackClicks(selector,eventName,dataAttributes={}){document.querySelectorAll(selector).forEach(link=>{link.addEventListener("click",function(){const linkUrl=link.getAttribute("href");const linkText=link.textContent.trim();let eventData={url:linkUrl,...dataAttributes};if(dataAttributes.hasOwnProperty("tags"))eventData.tags=linkText;if(dataAttributes.hasOwnProperty("categories"))eventData.categories=linkText;if(dataAttributes.hasOwnProperty("toc"))eventData.toc=linkText;if(dataAttributes.hasOwnProperty("nav"))eventData.nav=linkText;if(dataAttributes.hasOwnProperty("id"))eventData.id=link.getAttribute("data-tg-id");console.log(eventData);umami.track(eventName,eventData)})})}const trackingConfigs=[{selector:'a[href^="/tags/"]',eventName:"Tags Click",data:{tags:""}},{selector:'a[href^="/categories/"]',eventName:"categories Click",data:{categories:""}},{selector:"#toc-content a.toc-link",eventName:"TOC Click",data:{toc:""}},{selector:"#headNav a.nav-link",eventName:"HeadNav Click",data:{nav:""}},{selector:"#toc-aside .tg-link",eventName:"Ad Click",data:{id:""}}];trackingConfigs.forEach(({selector,eventName,data})=>trackClicks(selector,eventName,data));