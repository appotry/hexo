<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="traefik, proxy, docker, swarm, ubuntu"><meta name="description" content="traefik 与 nginx 一样是反向代理工具，或者叫 Edge Router。具有无须重启即可更新配置，自动的服务发现与负载均衡，与 docker 完美集成 等优点。"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="夜法之书"><meta name="theme-color" content="#7e9fc4"><meta name="msapplication-TileImage" content="/medias_webp/icons/android-chrome-192x192.png"><meta name="msapplication-TileColor" content="#7e9fc4"><meta http-equiv="Content-Security-Policy" content="default-src * vitals.vercel-insights.com 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; font-src * data: blob: 'unsafe-inline'; frame-src *;style-src * 'unsafe-inline';"><link rel="apple-touch-icon" href="/medias_webp/icons/apple-touch-icon.webp"><meta name="referrer" content="no-referrer-when-downgrade"><title>如何使用Traefik V2 在Ubuntu20.04 上面来做 Dockers Containers 的反向代理 | 夜法之书</title><link rel="manifest" href="/manifest.json"><link rel="icon" type="image/png" href="/favicon.webp"><link href="//fast.17lai.site" rel="preconnect" crossorigin><link href="//busuanzi.ibruce.info" rel="preconnect" crossorigin><link href="//busuanzi.ibruce.info" rel="dns-prefetch" crossorigin><link href="//cimg1.17lai.fun" rel="preconnect" crossorigin><link href="https://hm.baidu.com" rel="preconnect" crossorigin><link href="https://www.googletagmanager.com" rel="preconnect" crossorigin><link href="https://www.google-analytics.com" rel="preconnect" crossorigin><link href="//cdn.webpushr.com" rel="preconnect" crossorigin><link href="//bot.webpushr.com" rel="preconnect" crossorigin><link href="//analytics.webpushr.com" rel="preconnect" crossorigin><link href="https://waline.17lai.site" rel="preconnect" crossorigin><link href="https://waline.17lai.site" rel="dns-prefetch" crossorigin><link rel="alternate" type="application/atom+xml" title="所有订阅ATOM--夜法之书" href="https://blog.17lai.site/atom.xml"><link rel="alternate" type="application/rss+xml" title="所有订阅RSS2--夜法之书" href="https://blog.17lai.site/rss.xml"><link rel="alternate" type="application/json" title="所有订阅JSON--夜法之书" href="https://blog.17lai.site/feed.json"><style>.lazy-background{background-image:var(--background-img);background-repeat:no-repeat;background-size:cover;background-attachment:fixed;-webkit-transition:all 1s ease-in-out;-moz-transition:all 1s ease-in-out;-o-transition:all 1s ease-in-out;-ms-transition:all 1s ease-in-out;transition:all 1s ease-in-out}@media only screen and (max-width:1024px){.lazy-background{background-image:none}}</style><link rel="preload" href="https://fast.17lai.site/libs/jquery/jquery.min.js" as="script" importance="high"><link rel="preload" href="https://fast.17lai.site/js/utils.js" as="script" importance="high"><link rel="preload" href="https://fast.17lai.site/js/color-schema.js" as="script" importance="high"><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/libs/awesome/css/all.min.css"><link rel="preload" as="font" type="font/woff2" href="https://fast.17lai.site/libs/awesome/webfonts/fa-brands-400.woff2" crossorigin><link rel="preload" as="font" type="font/woff2" href="https://fast.17lai.site/libs/awesome/webfonts/fa-regular-400.woff2" crossorigin><link rel="preload" as="font" type="font/woff2" href="https://fast.17lai.site/libs/awesome/webfonts/fa-solid-900.woff2" crossorigin><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/css/reward.css"><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/libs/materialize/materialize.min.css"><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/libs/aos/aos.min.css"><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/libs/animate/animate.min.css"><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/libs/jquery/jquery-ui.min.css"><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/css/matery.css"><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/css/my.css"><link rel="stylesheet" href="https://fast.17lai.site/libs/materialize/materialize.min.css"><link rel="stylesheet" href="https://fast.17lai.site/css/matery.css"><link rel="stylesheet" href="https://fast.17lai.site/css/my.css"><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/libs/share/css/share.min.css"><style>#artDetail{margin-top:-60px}@media only screen and (max-width:550px){#articleContent table{table-layout:fixed}}@media only screen and (min-width:1418px){#artDetail{margin-top:-60px;padding:0 .75rem}}#artDetail .card{box-shadow:0 15px 8px rgba(50,50,93,.1),0 5px 8px rgba(0,0,0,.07)!important}#artDetail .tag-cate{padding-bottom:15px}#artDetail a{margin-right:0!important;text-transform:none!important}#artDetail .article-info{padding:20px 30px 1px 40px;margin-bottom:-5px}#artDetail .article-tag .chip,#artDetail .tag_share .article-tag .chip{font-size:1rem;font-weight:400;height:25px;line-height:24px;color:var(--navbar-text-color);border-radius:15px;margin-right:5px;margin-bottom:2px;border:1px solid}#artDetail .post-cate{float:right;color:var(--post-link-color)}#artDetail .post-cate a{padding-right:5px;color:var(--post-link-color);font-weight:500}#artDetail .post-cate a:hover{text-decoration:underline}#artDetail .post-info{color:#525f7f}#artDetail .post-info .post-category{padding-right:4px;color:#525f7f}#artDetail .post-info .post-category:hover{font-weight:700;color:var(--post-link-color);text-decoration:underline}#artDetail .post-info .post-date{color:#525f7f}#artDetail .post-info .post-word-count{margin-left:15px}#artDetail .post-info .post-read{margin-left:15px;color:#525f7f}#artDetail .article-card-content{padding:0 15px 20px 18px}@media only screen and (max-width:601px){#artDetail .article-info{padding:15px 15px 1px 15px;margin-bottom:-5px}}@media only screen and (min-width:600px) and (max-width:992px){#artDetail .article-card-content{padding:0 30px 20px 32px}#artDetail .article-info{padding:15px 20px 0 28px;margin-bottom:-5px}}@media only screen and (min-width:993px){#artDetail .article-card-content{padding:0 50px 20px 50px}}#artDetail .reprint{margin:15px 0 20px 0;border:1px solid #5cb85c;border-radius:10px;padding:.5rem .8rem;line-height:2;transition:box-shadow .3s ease-in-out}#artDetail .reprint-info{word-break:break-word}#artDetail .reprint:hover{box-shadow:0 0 10px 0 rgba(232,237,250,.6),0 4px 8px 0 rgba(232,237,250,.5)}#artDetail .reprint a{font-size:1.05rem;color:var(--post-link-color);font-weight:500}#articleContent p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.85rem}#articleContent blockquote p{text-indent:.2rem}#articleContent a,#comments a{padding:0 2px;color:var(--post-link-color);font-weight:500;text-decoration:underline;word-wrap:break-word;cursor:pointer;transition:color .2s ease-in-out,background-color .2s ease-in-out}#articleContent a:hover,#comments a:hover{color:var(--link-hover-color);transition:color .2s ease-in-out,background-color .2s ease-in-out}#articleContent .img-item{text-align:center}#articleContent img{max-width:100%;height:auto;cursor:pointer}#articleContent video{display:block;margin:30px auto;box-shadow:0 5px 35px 0 rgba(0,0,0,.2),0 10px 35px -11px rgba(0,0,0,.6);cursor:pointer}#articleContent ol,#articleContent ul{display:block;padding-left:2em;word-spacing:.05rem}#articleContent ol li,#articleContent ul li{display:list-item;line-height:1.8rem;font-size:1rem}#articleContent ul li{list-style-type:disc}#articleContent ul ul li{list-style-type:circle}#articleContent table{width:100%;display:block;border-collapse:collapse;border-spacing:0;overflow:auto}table tr:nth-child(2n),thead{background-color:var(--table-tr-bg-color)}#articleContent table th{background-color:var(--table-th-bg-color);min-width:80px;border:1px solid var(--text-color);padding:6px 6px}#articleContent table td{min-width:80px;border:1px solid var(--text-color);padding:6px 6px}tbody tr:nth-child(even){background-color:var(--table-tr-bg-color)}td:nth-child(1){background-color:var(--table-td-bg-color)}#articleContent table th{background-color:var(--table-th-bg-color);border:1px solid var(--text-color);color:var(--text-color)}#articleContent [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible;opacity:1}.task-list label{color:var(--text-color);font-size:var(--text-font-size)}.task-list li::marker{content:""}@media only screen and (min-width:600px){#article-share .social-share a{margin-left:15px!important}}</style><link rel="stylesheet preload" as="style" href="https://fast.17lai.site/libs/tocbot/tocbot.min.css"><link rel="stylesheet preload" as="style" href="https://fast.17lai.site/css/post.css"><link rel="stylesheet preload" as="style" href="https://fast.17lai.site/libs/tocbot/tocbot.min.css"><link rel="stylesheet preload" as="style" href="https://fast.17lai.site/css/post.css"><link rel="stylesheet" type="text/css" href="https://fast.17lai.site/css/reward.css"><style>body.DarkMode .theme-btn{background:#222;border:2px solid #555;border-radius:2px;color:#ccc!important;display:inline-block;font-size:.875em;line-height:2;padding:0 5px!important;text-decoration:unset!important;transition:background-color .2s ease-in-out}body.DarkMode .theme-btn:hover{background:#666;border-color:#666;color:#ccc}.theme-btn{background:#fff;border:2px solid #222;border-radius:2px;color:#555!important;display:inline-block;font-size:.875em;line-height:2;padding:0 5px!important;text-decoration:unset!important;transition:background-color .2s ease-in-out}.theme-btn:hover{background:#222;border-color:#222;color:#fff!important}.theme-btn+.theme-btn{margin:0 0 8px 8px}.theme-btn .fa-fw{text-align:left;width:1.285714285714286em}</style><style>.post-container .note{border-radius:0;margin-bottom:20px;padding:1em;position:relative;border:1px solid #eee;border-left-width:5px}.post-container .note summary{cursor:pointer;outline:0}.post-container .note summary p{display:inline}.post-container .note h2,.post-container .note h3,.post-container .note h4,.post-container .note h5,.post-container .note h6{border-bottom:initial;margin:0;padding-top:0}.post-container .note blockquote:first-child,.post-container .note img:first-child,.post-container .note ol:first-child,.post-container .note p:first-child,.post-container .note pre:first-child,.post-container .note table:first-child,.post-container .note ul:first-child{margin-top:0}.post-container .note blockquote:last-child,.post-container .note img:last-child,.post-container .note ol:last-child,.post-container .note p:last-child,.post-container .note pre:last-child,.post-container .note table:last-child,.post-container .note ul:last-child{margin-bottom:0}.post-container .note:not(.no-icon){padding-left:2.5em}.post-container .note:not(.no-icon)::before{font-size:1.5em;left:.3em;position:absolute;top:calc(50% - 1em)}.post-container .note.default{border-left-color:#777}.post-container .note.default h2,.post-container .note.default h3,.post-container .note.default h4,.post-container .note.default h5,.post-container .note.default h6{color:#777}.post-container .note.default:not(.no-icon)::before{content:'\f0a9';font-family:'Font Awesome 5 Free';font-weight:900;color:#777}.post-container .note.primary{border-left-color:#6f42c1}.post-container .note.primary h2,.post-container .note.primary h3,.post-container .note.primary h4,.post-container .note.primary h5,.post-container .note.primary h6{color:#6f42c1}.post-container .note.primary:not(.no-icon)::before{content:'\f055';font-family:'Font Awesome 5 Free';font-weight:900;color:#6f42c1}.post-container .note.info{border-left-color:#428bca}.post-container .note.info h2,.post-container .note.info h3,.post-container .note.info h4,.post-container .note.info h5,.post-container .note.info h6{color:#428bca}.post-container .note.info:not(.no-icon)::before{content:'\f05a';font-family:'Font Awesome 5 Free';font-weight:900;color:#428bca}.post-container .note.success{border-left-color:#5cb85c}.post-container .note.success h2,.post-container .note.success h3,.post-container .note.success h4,.post-container .note.success h5,.post-container .note.success h6{color:#5cb85c}.post-container .note.success:not(.no-icon)::before{content:'\f058';font-family:'Font Awesome 5 Free';font-weight:900;color:#5cb85c}.post-container .note.warning{border-left-color:#f0ad4e}.post-container .note.warning h2,.post-container .note.warning h3,.post-container .note.warning h4,.post-container .note.warning h5,.post-container .note.warning h6{color:#f0ad4e}.post-container .note.warning:not(.no-icon)::before{content:'\f06a';font-family:'Font Awesome 5 Free';font-weight:900;color:#f0ad4e}.post-container .note.danger{border-left-color:#d9534f}.post-container .note.danger h2,.post-container .note.danger h3,.post-container .note.danger h4,.post-container .note.danger h5,.post-container .note.danger h6{color:#d9534f}.post-container .note.danger:not(.no-icon)::before{content:'\f056';font-family:'Font Awesome 5 Free';font-weight:900;color:#d9534f}</style><style>.post-container .tabs{margin-bottom:20px;height:auto}.post-container .tabs,.tabs-comment{padding-top:10px}.post-container .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{background:var(--card-bg-color);display:flex!important;flex-wrap:wrap;justify-content:center;margin:0;padding:0!important;position:-webkit-sticky;position:sticky;top:0}@media (max-width:413px){.post-container .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{display:block;margin-bottom:5px}}.post-container .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid var(--text-color);border-left:1px solid transparent;border-right:1px solid transparent;border-radius:0;border-top:3px solid transparent;flex-grow:1;list-style-type:none!important;transition:all .2s ease-out}@media (max-width:413px){.post-container .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid transparent;border-left:3px solid transparent;border-right:1px solid transparent;border-top:1px solid transparent}}@media (max-width:413px){.post-container .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-radius:0}}.post-container .tabs ul.nav-tabs li.tab a,.tabs-comment ul.nav-tabs li.tab a{border-bottom:initial;display:block;line-height:1.8;padding:.25em .75em;text-align:center;text-decoration:unset!important;transition:all .2s ease-out}.post-container .tabs{background-color:var(--card-bg-color)}.post-container .tabs ul.nav-tabs li.tab a i,.tabs-comment ul.nav-tabs li.tab a i{width:1.285714285714286em}.post-container .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-bottom-color:transparent;border-left-color:var(--text-color);border-right-color:var(--text-color);border-top-color:var(--tab-border-top-color)}@media (max-width:413px){.post-container .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-bottom-color:var(--text-color);border-left-color:var(--tab-border-top-color);border-right-color:var(--text-color);border-top-color:var(--text-color)}}.post-container .tabs ul.nav-tabs li.tab.active a,.tabs-comment ul.nav-tabs li.tab.active a{cursor:default;text-decoration:unset}.post-container .tabs .tab-content,.tabs-comment .tab-content{border:1px solid var(--text-color);border-radius:0;border-top-color:transparent;white-space:break-spaces}@media (max-width:413px){.post-container .tabs .tab-content,.tabs-comment .tab-content{border-radius:0;border-top-color:var(--text-color)}}.post-container .tabs .tab-content .tab-pane,.tabs-comment .tab-content .tab-pane{padding:20px 20px 0}.post-container .tabs .tab-content .tab-pane:not(.active),.tabs-comment .tab-content .tab-pane:not(.active){display:none}.tabs-comment{margin-top:4em;padding-top:0}.tabs-comment .comments{margin-top:0;padding-top:0}</style><style>.label{display:inline;border-radius:3px;font-size:85%;margin:0;padding:.2em .4em;color:var(--text-color);transition:color .2s ease-in-out}.label-default{background:rgba(187,187,187,.25)}.label-primary{background:rgba(183,160,224,.25)}.label-info{background:rgba(160,197,228,.25)}.label-success{background:rgba(174,220,174,.25)}.label-warning{background:rgba(248,214,166,.25)}.label-danger{background:rgba(236,169,167,.25)}</style><style>.group-image-container{margin:1.5rem auto}.group-image-container img{margin:0 auto;border-radius:3px;background-color:transparent;box-shadow:0 3px 9px 0 rgba(0,0,0,.15),0 3px 9px 0 rgba(0,0,0,.15)}.group-image-row{margin-bottom:.5rem;display:flex;justify-content:center}.group-image-wrap{flex:1;display:flex;justify-content:center}.group-image-wrap:not(:last-child){margin-right:.25rem}</style><link id="highlight-css" rel="stylesheet" href="https://fast.17lai.site/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="https://fast.17lai.site/css/highlight-dark.css"><link rel="stylesheet" type="text/css" href="https://fast.17lai.site/libs/waline/waline.min.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" type="text/css" href="https://fast.17lai.site/css/waline.css" media="none" onload='"all"!=media&&(media="all")'><style>.admonition,.admonition.attention,.admonition.error,.admonition.info,.admonition.note{margin:1.5625em 0;padding:.6rem!important;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:var(--toc-activ-bg-color)}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}.admonition code[class*=language-],.admonition pre[class*=language-]{background:var(--toc-activ-bg-color)!important}</style><style>.bvideo a:link{text-decoration:none!important}.bvideo-box{width:80%;height:96px;margin:0 auto;font-weight:400;box-sizing:border-box;background:#f4f4f5;border:.0625rem solid #d1d1d1;border-radius:6px;background-color:#fcfcfc;display:flex;user-select:none;cursor:pointer;overflow:hidden}.bvideo-cover{display:inline-block;width:150px;height:94px;min-width:150px;min-height:94px;border-bottom-left-radius:6px;border-top-left-radius:6px;overflow:hidden;position:relative}.bvideo-cover .video-cover-img{height:100%;width:100%;top:0;left:0;position:absolute;display:inline-block;background-size:cover;background-position:50%}.bvideo-cover .duration{position:absolute;right:3px;bottom:0;padding:0;color:#fff;font-size:12px;border-radius:2px}.bvideo-cover .bvideo-cover-layer{position:absolute;left:0;top:0;width:100%;height:100%;background-position:50%;background-size:cover;background-repeat:no-repeat}.bvideo-info{margin-left:1rem;padding-top:10px;min-height:84px;position:relative;text-align:left}.bvideo-info .title{max-height:40px;min-height:19px;color:#222;line-height:1.4;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:25rem;margin:0}.bvideo-info .up-name{height:19px;margin-top:1px;margin-left:2px;display:inline-block;vertical-align:middle;font-size:12px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:150px}.bvideo-info .card-status{line-height:13px;font-size:12px;color:#999;margin:0;bottom:30px}.bvideo-info .play-num{margin-right:13px}.bvideo-info .partition{font-size:12px;line-height:13px;color:#999;position:absolute;bottom:-1px;padding-left:35px;top:78px}.icon-video{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA2CAMAAACsuQomAAAAclBMVEX///8AAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+As+VLAAAAJnRSTlOzAK8+F4OppBAmnTKsllOOb2dhOS0JBJqAWk0aB19FHgJ8dUAgC8ZU4VsAAAGPSURBVEjHpdbrcqowGIXhtbIxnEGOCmKt2n3/t1hSO6Y2qYwf779M5plkCJkJ+Fih85i+4lwX/NUvHAHQLd3SDED0HHcagGoc2ygA4eRidwV15WNvytmRDzPWmBv5sxFzYcxFzI8QcwVtw5c9kcuYhwRz9X1cYS4J+Cfu4+bfvUJhbvs9umBOFXY6PT3gqNJ4pWSY7rhx6DL/+MZXhdfTRoOnDJJ2ncEbyBpIxBCmJ+IIaSlRivGRCOGpbMdkEV8IBU8t2R3VAt4T3gLOBefnePMMk2m+ArMvtByT0VaAbXEpwLa3cAXm/0rJMXnaCLCtSVZgRvkKzOOalXcCbM9LiuMSEGLzjwqxuR1SnO4AIT7sASHuagUpNscjw+7xuDiDp9Q9HrczkcBTfq01ltoSe0gbiVGMD0SUCe2GBGshbg2ecpGtaDCDncBe+htmdH6VquHdPuLabZ4pdZ/yZSfDcgjc52MDk36nrz6DKeVXLu6S25fwV90eUA62l1eFdU9/Ux2q/YEOtjlbfjoLrugTV6YSSQ5kbxYAAAAASUVORK5CYII=);position:absolute;background-size:100% 100%;display:inline-block;top:50%;left:50%;margin-left:-15px;margin-top:-13px;height:26px}.card-label{display:inline-block;font-weight:550;width:25px;height:13px;border:1.5px solid #ffc3d4;color:#ffc3d4;background-size:100% 100%;position:absolute;top:-1px;left:0;padding-left:1px}.bvideo-cover .cover-default{position:absolute;left:0;top:0;width:100%;height:100%;background-size:44px;background-color:#f0f1f4;background-position:50%;background-repeat:no-repeat}@media (max-width:768px){.bvideo-cover{display:none}.partition{display:none}.bvideo-info .title{max-height:40px;min-height:19px;color:#222;line-height:1.4;font-size:14px;text-overflow:clip;overflow:hidden;white-space:normal;margin:0}}</style><style>.douban-card-block{display:flex;justify-content:center;align-items:center;width:100%;max-height:400px}.douban-card{display:flex;margin:30px 10px;padding:15px;border-radius:15px;position:relative;justify-content:center;align-items:center;overflow:hidden;color:#faebd7;text-decoration:none}.douban-card:hover{text-decoration:none}.douban-card-bgimg{position:absolute;width:115%;height:115%;filter:blur(15px) brightness(.6);background-size:100%;background-position:center;background-repeat:no-repeat}.douban-card-img{position:relative;height:130px;width:80px;background-size:100%;background-position:center;background-repeat:no-repeat}.douban-card-left:hover .douban-card-img{filter:blur(5px) brightness(.6);transform:perspective(800px) rotateX(180deg)}.douban-card-left .douban-card-img{transition:all .5s ease}.douban-card-left{position:relative;display:flex;flex-direction:column;align-items:center}.douban-card-left .douban-card-status{height:130px;width:80px;text-align:center;font-weight:700;position:absolute;left:0;top:30%;transform:rotateX(180deg);backface-visibility:hidden;transition:all .5s ease}.douban-card-left:hover .douban-card-status{transform:perspective(800px) rotateX(0)}.douban-card-right{position:relative;display:flex;flex-direction:column;margin-left:12px;font-size:16px;font-family:"Courier New",Courier,monospace;line-height:1.3;color:#faebd7}.douban-card-item{margin-top:4px}</style><style>.github-emoji{height:2em;width:2em;display:inline-block!important;position:relative;margin:0 3px!important;padding:0}.github-emoji:hover{animation:emoji-face 5s infinite ease-in-out}@keyframes emoji-face{2%{transform:translate(0,1.5px) rotate(1.5deg)}4%{transform:translate(0,-1.5px) rotate(-.5deg)}6%{transform:translate(0,1.5px) rotate(-1.5deg)}8%{transform:translate(0,-1.5px) rotate(-1.5deg)}10%{transform:translate(0,2.5px) rotate(1.5deg)}12%{transform:translate(0,-.5px) rotate(1.5deg)}14%{transform:translate(0,-1.5px) rotate(1.5deg)}16%{transform:translate(0,-.5px) rotate(-1.5deg)}18%{transform:translate(0,.5px) rotate(-1.5deg)}20%{transform:translate(0,-1.5px) rotate(2.5deg)}22%{transform:translate(0,.5px) rotate(-1.5deg)}24%{transform:translate(0,1.5px) rotate(1.5deg)}26%{transform:translate(0,.5px) rotate(.5deg)}28%{transform:translate(0,.5px) rotate(1.5deg)}}</style><style>.vkr-url-wrapper{padding:10px;border-radius:5px;border:1px solid;border-color:var(--text-color) var(--text-color) var(--text-color);box-shadow:rgba(0,0,0,.14) 0 1px 3px;margin-bottom:10px;display:flex}.vkr-url-wrapper .desc-wrapper>hr{margin:10px 0;height:1px}.vkr-url-wrapper .avatar{width:150px!important;height:150px!important;border:solid 1px var(--text-color);box-shadow:none!important;margin:0;margin-right:10px}.vkr-url-wrapper h2{border:none;margin:0;padding:0}.vkr-url-wrapper .desc-wrapper{flex:1}.vkr-url-wrapper .desc-wrapper a{font-size:22px;font-weight:700}</style><style>.typed-cursor.typed-cursor--blink{-webkit-animation:1s van-cursor-flicker infinite;animation:1s van-cursor-flicker infinite}#articles .article .card-image i,#next-cover i,#prev-cover i,#recommend-sections .post-card .post-body i,.index-cover .container .cover-btns i,.paging i{-webkit-animation:1.5s breathe-flicker infinite;animation:1.5s breathe-flicker infinite}@keyframes van-cursor-flicker{from{opacity:0}50%{opacity:1}100%{opacity:0}}@keyframes breathe-flicker{from{opacity:.3}50%{opacity:1}100%{opacity:.3}}@media only screen and (max-width:1024px){.typed-cursor.typed-cursor--blink{-webkit-animation:none;animation:none}#articles .article .card-image i,#next-cover i,#prev-cover i,#recommend-sections .post-card .post-body i,.index-cover .container .cover-btns i,.paging i{-webkit-animation:none;animation:none}}</style><style>::-webkit-scrollbar-thumb{background-color:var(--scrollbar-color);background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.4) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.4) 50%,rgba(255,255,255,.4) 75%,transparent 75%,transparent);border-radius:6px}::-webkit-scrollbar-corner,::-webkit-scrollbar-track{background-color:var(--card-bg-color);border-radius:3em}::-webkit-scrollbar-thumb:hover{background-color:var(--scrollbar-hover-color)}::-webkit-scrollbar{width:8px;height:8px}</style><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/libs/live2d/waifu.css"><link rel="preload" href="https://fast.17lai.site/libs/materialize/materialize.min.js" as="script"><link rel="preload" href="https://fast.17lai.site/libs/masonry/masonry.pkgd.min.js" as="script"><link rel="preload" href="https://fast.17lai.site/libs/aos/aos.min.js" as="script"><link rel="preload" href="https://fast.17lai.site/js/events.js" as="script"><link rel="preload" href="https://fast.17lai.site/js/plugins.js" as="script"><link rel="preload" href="https://fast.17lai.site/libs/lightGallery/js/lightgallery-all.min.js" as="script"><link rel="preload" href="https://fast.17lai.site/libs/jquery/jquery-ui.min.js" as="script"><link rel="preload" href="https://fast.17lai.site/libs/scrollprogress/scrollProgress.min.js" as="script"><link rel="preload" href="https://fast.17lai.site/js/tw_cn.js" as="script" importance="low"><link rel="preload" href="https://fast.17lai.site/js/boot.js" as="script" importance="low"><link rel="preload" href="https://fast.17lai.site/libs/tocbot/tocbot.min.js" as="script"><link rel="preload" href="https://fast.17lai.site/" as="script"><link rel="preload" href="https://fast.17lai.site/libs/waline/pageview.min.mjs" as="script"><link rel="preload" href="https://fast.17lai.site/libs/waline/comment.min.mjs" as="script"><link rel="preload" href="https://fast.17lai.site/libs/others/bsz.pure.mini.min.js" as="script"><link rel="preload" href="https://fast.17lai.site/libs/prism/components/prism-core.min.js" as="script"><link rel="preload" href="https://fast.17lai.site/libs/prism/plugins/autoloader/prism-autoloader.min.js" as="script"><link rel="stylesheet preload" as="style" type="text/css" href="https://fast.17lai.site/libs/prism/plugins/line-numbers/prism-line-numbers.min.css"><link rel="preload" href="https://fast.17lai.site/libs/prism/plugins/line-numbers/prism-line-numbers.min.js" as="script"><script src="https://fast.17lai.site/libs/jquery/jquery.min.js"></script><script id="matery-configs">var Matery=window.Matery||{};Matery.ctx=Object.assign({},Matery.ctx);var CONFIG={hostname:"blog.17lai.site",root:"/",version:"2.0.0",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!1,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,show_full:!0,show_expand:!0,shrink:!0,break:!1,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"https://fast.17lai.site/medias_webp/loading2.svg",loading_img_dark:"https://fast.17lai.site/medias_webp/loading2-dark.svg",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!1,baidu:{enable:!0,id:"22cc5bdea6e529c1349d44b7306b3b8c"},google:{enable:!1,id:"G-JNYZP4ZLDJ"},gtag:{enable:!0,id:"G-JNYZP4ZLDJ"},tencent:{enable:!1,sid:null,cid:null},woyaola:{enable:!1,id:null},cnzz:{enable:!1,id:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Matery.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="https://fast.17lai.site/js/utils.js"></script><script src="https://fast.17lai.site/js/color-schema.js"></script><script async>if(!Matery.ctx.dnt){var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?22cc5bdea6e529c1349d44b7306b3b8c";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()}</script><script async>Matery.ctx.dnt||Matery.utils.createAsyncScript("https://www.googletagmanager.com/gtag/js?id=G-JNYZP4ZLDJ",!1,(function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","G-JNYZP4ZLDJ")}))</script><link rel="stylesheet" href="https://fast.17lai.site/libs/prism/plugins/line-numbers/prism-line-numbers.min.css"><script async>var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}});window.addEventListener("testpassive",null,opts),window.removeEventListener("testpassive",null,opts)}catch(s){}</script><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="lazy-background" bg-lazy><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img no-lazy src="https://fast.17lai.site/favicon.webp" style="width:40px;height:45px" class="logo-img" alt="LOGO"> <span class="logo-span">夜法之书</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse" aria-label="侧边菜单"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item menu-2d-home"><a href="/" class="nav-link"><i class="fas fa-home" style="zoom:.6"></i> 首页</a></li><li class="hide-on-med-and-down nav-item menu-2d-nav"><a target="_blank" rel="noopener" href="https://nav.17lai.site/" class="nav-link"><i class="fas fa-suitcase" style="zoom:.6"></i> 导航</a></li><li class="hide-on-med-and-down nav-item menu-2d-sosuo"><a target="_blank" rel="noopener" href="https://so.17lai.site/" class="nav-link"><i class="fas fa-mask" style="zoom:.6"></i> SO</a></li><li class="hide-on-med-and-down nav-item menu-2d-media"><a href="#" class="nav-link"><i class="fas fa-music" style="zoom:.6"></i> 多媒体 <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li class="menu-2d-musics"><a class="nav-link" href="/musics/"><i class="fas fa-music" style="margin-top:-20px;zoom:.6"></i> 音乐</a></li><li class="menu-2d-galleries"><a class="nav-link" href="/galleries/"><i class="fas fa-image" style="margin-top:-20px;zoom:.6"></i> 相册</a></li><li class="menu-2d-movies"><a class="nav-link" href="/movies/"><i class="fas fa-film" style="margin-top:-20px;zoom:.6"></i> 视频</a></li><li class="menu-2d-musicplayer"><a class="nav-link" target="_blank" rel="noopener" href="https://musicplayer.17lai.site/"><i class="fas fa-music" style="margin-top:-20px;zoom:.6"></i> 在线云音乐</a></li><li class="menu-2d-music"><a class="nav-link" target="_blank" rel="noopener" href="https://music.17lai.site/"><i class="fas fa-music" style="margin-top:-20px;zoom:.6"></i> 音乐播放器</a></li></ul></li><li class="hide-on-med-and-down nav-item menu-2d-posts"><a href="#" class="nav-link"><i class="fas fa-folder-plus" style="zoom:.6"></i> 文章 <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li class="menu-2d-tags"><a class="nav-link" href="/tags/"><i class="fas fa-tags" style="margin-top:-20px;zoom:.6"></i> 标签</a></li><li class="menu-2d-categories"><a class="nav-link" href="/categories/"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:.6"></i> 分类</a></li><li class="menu-2d-archives"><a class="nav-link" href="/archives/"><i class="fas fa-archive" style="margin-top:-20px;zoom:.6"></i> 归档</a></li></ul></li><li class="hide-on-med-and-down nav-item menu-2d-friends"><a href="/friends/" class="nav-link"><i class="fas fa-link" style="zoom:.6"></i> 友链</a></li><li class="hide-on-med-and-down nav-item menu-2d-toolbox"><a href="#" class="nav-link"><i class="fas fa-toolbox" style="zoom:.6"></i> 工具 <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li class="menu-2d-tg"><a class="nav-link" target="_blank" rel="noopener" href="https://t.me/chat_17laisite"><i class="fab fa-telegram-plane" style="margin-top:-20px;zoom:.6"></i> TG交流群</a></li><li class="menu-2d-tg-sub"><a class="nav-link" target="_blank" rel="noopener" href="https://t.me/sub_17laisite"><i class="fab fa-telegram-plane" style="margin-top:-20px;zoom:.6"></i> TG订阅群</a></li><li class="menu-2d-linuxtool"><a class="nav-link" target="_blank" rel="noopener" href="https://linux-command.17lai.site/"><i class="fas fa-terminal" style="margin-top:-20px;zoom:.6"></i> Linux命令</a></li><li class="menu-2d-cheatsheets"><a class="nav-link" href="/dash/"><i class="fas fa-laptop-code" style="margin-top:-20px;zoom:.6"></i> 各种快查表</a></li><li class="menu-2d-onebox"><a class="nav-link" target="_blank" rel="noopener" href="https://onebox.17lai.site/"><i class="fas fa-cloud" style="margin-top:-20px;zoom:.6"></i> 私人网盘</a></li><li class="menu-2d-staticnav"><a class="nav-link" href="/nav/"><i class="fas fa-tools" style="margin-top:-20px;zoom:.6"></i> 网址导航</a></li></ul></li><li class="hide-on-med-and-down nav-item menu-2d-about"><a href="#" class="nav-link"><i class="fas fa-id-badge" style="zoom:.6"></i> 关于 <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li class="site-author menu-2d-aboutme"><a class="nav-link" href="/about/"><i class="fas fa-user-circle" style="margin-top:-20px;zoom:.6"></i> 关于我</a></li><li class="menu-2d-abouttech"><a class="nav-link" href="/myTeck/"><i class="fas fa-address-card" style="margin-top:-20px;zoom:.6"></i> 我的技术</a></li><li class="menu-2d-aboutporj"><a class="nav-link" href="/myProject/"><i class="fas fa-laptop-code" style="margin-top:-20px;zoom:.6"></i> 我的项目</a></li><li class="menu-2d-aboutpost"><a class="nav-link" href="/myPost/"><i class="fas fa-pen-nib" style="margin-top:-20px;zoom:.6"></i> 我的文章</a></li><li class="menu-2d-aboutneed"><a class="nav-link" href="/needtoread/"><i class="fas fa-exclamation-circle" style="margin-top:-20px;zoom:.6"></i> 博客须知</a></li></ul></li><li class="nav-item menu-2d-search"><a href="#searchModal" class="nav-link modal-trigger" onclick="startXMLSearch()"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li><li class="nav-item menu-2d-dark" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp; <i class="fas fa-sun" id="color-toggle-icon" style="zoom:.85"></i>&nbsp;</a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><div><img src="https://fast.17lai.site/favicon.webp" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload style="width:45px;height:45px" class="logo-img circle responsive-img" alt="LOGO"><div class="logo-name">夜法之书</div><div class="logo-desc">~软件驱动世界~个人独立技术博客，关于Linux,开源，Nas，Docker，嵌入式，理财，健身等主题！</div></div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a target="_blank" rel="noopener" href="https://nav.17lai.site/" class="waves-effect waves-light"><i class="fa-fw fas fa-suitcase"></i> 导航</a></li><li class="m-nav-item"><a target="_blank" rel="noopener" href="https://so.17lai.site/" class="waves-effect waves-light"><i class="fa-fw fas fa-mask"></i> SO</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-music"></i> 多媒体 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/musics/" style="margin-left:75px"><i class="fa fas fa-music" style="position:absolute;left:50px"></i> <span>音乐</span></a></li><li><a href="/galleries/" style="margin-left:75px"><i class="fa fas fa-image" style="position:absolute;left:50px"></i> <span>相册</span></a></li><li><a href="/movies/" style="margin-left:75px"><i class="fa fas fa-film" style="position:absolute;left:50px"></i> <span>视频</span></a></li><li><a target="_blank" rel="noopener" href="https://musicplayer.17lai.site/" style="margin-left:75px"><i class="fa fas fa-music" style="position:absolute;left:50px"></i> <span>在线云音乐</span></a></li><li><a target="_blank" rel="noopener" href="https://music.17lai.site/" style="margin-left:75px"><i class="fa fas fa-music" style="position:absolute;left:50px"></i> <span>音乐播放器</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-folder-plus"></i> 文章 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags/" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>标签</span></a></li><li><a href="/categories/" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>分类</span></a></li><li><a href="/archives/" style="margin-left:75px"><i class="fa fas fa-archive" style="position:absolute;left:50px"></i> <span>归档</span></a></li></ul></li><li class="m-nav-item"><a href="/friends/" class="waves-effect waves-light"><i class="fa-fw fas fa-link"></i> 友链</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-toolbox"></i> 工具 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a target="_blank" rel="noopener" href="https://t.me/chat_17laisite" style="margin-left:75px"><i class="fa fab fa-telegram-plane" style="position:absolute;left:50px"></i> <span>TG交流群</span></a></li><li><a target="_blank" rel="noopener" href="https://t.me/sub_17laisite" style="margin-left:75px"><i class="fa fab fa-telegram-plane" style="position:absolute;left:50px"></i> <span>TG订阅群</span></a></li><li><a target="_blank" rel="noopener" href="https://linux-command.17lai.site/" style="margin-left:75px"><i class="fa fas fa-terminal" style="position:absolute;left:50px"></i> <span>Linux命令</span></a></li><li><a href="/dash/" style="margin-left:75px"><i class="fa fas fa-laptop-code" style="position:absolute;left:50px"></i> <span>各种快查表</span></a></li><li><a target="_blank" rel="noopener" href="https://onebox.17lai.site/" style="margin-left:75px"><i class="fa fas fa-cloud" style="position:absolute;left:50px"></i> <span>私人网盘</span></a></li><li><a href="/nav/" style="margin-left:75px"><i class="fa fas fa-tools" style="position:absolute;left:50px"></i> <span>网址导航</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-id-badge"></i> 关于 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/about/" style="margin-left:75px"><i class="fa fas fa-user-circle" style="position:absolute;left:50px"></i> <span>关于我</span></a></li><li><a href="/myTeck/" style="margin-left:75px"><i class="fa fas fa-address-card" style="position:absolute;left:50px"></i> <span>我的技术</span></a></li><li><a href="/myProject/" style="margin-left:75px"><i class="fa fas fa-laptop-code" style="position:absolute;left:50px"></i> <span>我的项目</span></a></li><li><a href="/myPost/" style="margin-left:75px"><i class="fa fas fa-pen-nib" style="position:absolute;left:50px"></i> <span>我的文章</span></a></li><li><a href="/needtoread/" style="margin-left:75px"><i class="fa fas fa-exclamation-circle" style="position:absolute;left:50px"></i> <span>博客须知</span></a></li></ul></li></ul></div></div></nav></header><script>pagePath=window.location.pathname</script><div id="banner" class="bg-cover pd-header post-cover" style="background-image:url(https://fast.17lai.site/medias_webp/cover/web.webp)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand center"><h1 class="description center-align post-title">如何使用Traefik V2 在Ubuntu20.04 上面来做 Dockers Containers 的反向代理 <span class="typed-cursor h2 typed-cursor--blink" aria-hidden="true">_</span></h1><div class="center-align"><div id="waline_container_page_pv" style="display:inline"><i class="far fa-eye fa-fw"></i>查阅:&nbsp;&nbsp; <span class="waline-pageview-count" data-path=""></span>&nbsp;&nbsp;</div><div id="waline_container_comment_count" style="display:inline"><i class="far fa-comment fa-fw"></i>评论:&nbsp;&nbsp; <span class="waline-comment-count" data-path=""></span>条</div></div></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/docker/"><span class="chip bg-color">docker</span> </a><a href="/tags/traefik/"><span class="chip bg-color">traefik</span> </a><a href="/tags/proxy/"><span class="chip bg-color">proxy</span> </a><a href="/tags/swarm/"><span class="chip bg-color">swarm</span> </a><a href="/tags/ubuntu/"><span class="chip bg-color">ubuntu</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/docker/" class="post-category">docker</a><link rel="alternate dns-prefetch" type="application/atom+xml" title="分类订阅--docker" href="https://blog.17lai.site/categories/docker/atom.xml"></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> <span>发布:&nbsp;&nbsp;</span><time datetime="2021-10-14 19:25" pubdate> 2021年10月14日 晚上</time></div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i> <span>更新:&nbsp;&nbsp;</span><time datetime="2023-02-12 13:26" update> 2023年2月12日 下午</time></div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>字数:&nbsp;&nbsp; 3.8k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>阅时:&nbsp;&nbsp; 23 分</div><div id="read_mode" class="info-break-policy" style="display:inline"><i class="fas fa-expand" title="【进入/离开】阅读模式" aria-hidden="true"></i>&nbsp;&nbsp;<span title="【进入/离开】阅读模式" aria-hidden="true">阅读模式</span></div></div></div><hr class="clearfix"><div class="card-content article-card-content markdown-body"><div id="articleContent"><p>How To Use Traefik v2 as a Reverse Proxy for Docker Containers on Ubuntu 20.04</p><blockquote><p>Traefik 适合配合Dockers swarm 做服务， Dockers portainer 做管理，ELK集群做监控日志。</p></blockquote><p><img src="https://cimg1.17lai.fun/data/2021/10/1420211014200800.png" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload alt="Traefik"></p><p><code>traefik</code> 与 <code>nginx</code> 一样，是一款优秀的反向代理工具，或者叫 <code>Edge Router</code>。至于使用它的原因则基于以下几点</p><ul><li>无须重启即可更新配置</li><li>自动的服务发现与负载均衡</li><li>与 <code>docker</code> 完美集成，基于 <code>container label</code> 的配置</li><li>漂亮的 <code>dashboard</code> 界面</li><li><code>metrics</code> 的支持，支持对 <code>prometheus</code> 和 <code>k8s</code> 集成</li></ul><h3 id="Introduction">Introduction</h3><p><a target="_blank" rel="noopener" href="https://www.docker.com/">Docker</a> can be an efficient way to run web applications in production, but you may want to run multiple applications on the same Docker host. In this situation, you’ll need to set up a reverse proxy. This is because you only want to expose ports <code>80</code> and <code>443</code> to the rest of the world.</p><p><a target="_blank" rel="noopener" href="https://traefik.io/">Traefik</a> is a Docker-aware reverse proxy that includes a monitoring dashboard. Traefik v1 has been widely used for a while, and <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-use-traefik-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04">you can follow this earlier tutorial to install Traefik v1</a>). But in this tutorial, you’ll install and configure Traefik v2, which includes quite a few differences.</p><p>The biggest difference between Traefik v1 and v2 is that <em>frontends</em> and <em>backends</em> were removed and their combined functionality spread out across <em>routers</em>, <em>middlewares</em>, and <em>services</em>. Previously a backend did the job of making modifications to requests and getting that request to whatever was supposed to handle it. Traefik v2 provides more separation of concerns by introducing middlewares that can modify requests before sending them to a service. Middlewares make it easier to specify a single modification step that might be used by a lot of different routes so that they can be reused (such as HTTP Basic Auth, which you’ll see later). A router can also use many different middlewares.</p><p>In this tutorial you’ll configure Traefik v2 to route requests to two different web application containers: a <a target="_blank" rel="noopener" href="http://wordpress.org/">Wordpress</a> container and an <a target="_blank" rel="noopener" href="https://www.adminer.org/">Adminer</a> container, each talking to a <a target="_blank" rel="noopener" href="https://www.mysql.com/">MySQL</a> database. You’ll configure Traefik to serve everything over HTTPS using <a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s Encrypt</a>.</p><h2 id="Prerequisites">Prerequisites</h2><p>To complete this tutorial, you will need the following:</p><ul><li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/products/linux-distribution/ubuntu/">One Ubuntu 20.04 server</a> with a sudo non-root user and a firewall. You can set this up by following our <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04">Ubuntu 20.04 initial server setup guide</a>.</li><li>Docker installed on your server, which you can accomplish by following <strong>Steps 1 and 2</strong> of <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04">How to Install and Use Docker on Ubuntu 20.04</a>.</li><li>Docker Compose installed using the instructions from <strong>Step 1</strong> of <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-compose-on-ubuntu-20-04">How to Install Docker Compose on Ubuntu 20.04</a>.</li><li>A domain and three A records, <code>db-admin.your_domain</code>, <code>blog.your_domain</code> and <code>monitor.your_domain</code>. Each should point to the IP address of your server. You can learn how to point domains to DigitalOcean Droplets by reading through <a target="_blank" rel="noopener" href="https://www.digitalocean.com/docs/networking/dns/">DigitalOcean’s Domains and DNS documentation</a>. Throughout this tutorial, substitute your domain for <code>your_domain</code> in the configuration files and examples.</li></ul><h2 id="Step-1-—-Configuring-and-Running-Traefik">Step 1 — Configuring and Running Traefik</h2><p>The Traefik project has an <a target="_blank" rel="noopener" href="https://hub.docker.com/_/traefik">official Docker image</a>, so you will use that to run Traefik in a Docker container.</p><p>But before you get your Traefik container up and running, you need to create a configuration file and set up an encrypted password so you can access the monitoring dashboard.</p><p>You’ll use the <code>htpasswd</code> utility to create this encrypted password. First, install the utility, which is included in the <code>apache2-utils</code> package:</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sudo apt-get install apache2-utils</code></pre></div></figure><p>Then generate the password with <code>htpasswd</code>. Substitute <code>secure_password</code> with the password you’d like to use for the Traefik admin user:</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">htpasswd -nb admin secure_password</code></pre></div></figure><p>The output from the program will look like this:</p><figure><div class="code-area"><pre class="line-numbers language-none"><code class="language-none">Outputadmin:$apr1$ruca84Hq$mbjdMZBAG.KWn7vfN/SNK/</code></pre></div></figure><p>You’ll use this output in the Traefik configuration file to set up HTTP Basic Authentication for the Traefik health check and monitoring dashboard. Copy the entire output line so you can paste it later.</p><p>To configure the Traefik server, you’ll create two new configuration files called <code>traefik.toml</code> and <code>traefik_dynamic.toml</code> using the TOML format. <a target="_blank" rel="noopener" href="https://github.com/toml-lang/toml">TOML</a> is a configuration language similar to INI files, but standardized. <a target="_blank" rel="noopener" href="https://docs.traefik.io/providers/overview/">These files let us configure the Traefik server and various integrations</a>, or <code>providers</code>, that you want to use. In this tutorial, you will use three of Traefik’s available providers: <code>api</code>, <code>docker</code>, and <code>acme</code>. The last of these, <code>acme</code>, supports TLS certificates using Let’s Encrypt.</p><p>Create and open <code>traefik.toml</code> using <code>nano</code> or your preferred text editor:</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nano traefik.toml</code></pre></div></figure><p>First, you want to specify the ports that Traefik should listen on using the <code>entryPoints</code> section of your config file. You want two because you want to listen on port <code>80</code> and <code>443</code>. Let’s call these <code>web</code> (port <code>80</code>) and <code>websecure</code> (port <code>443</code>).</p><p>Add the following configurations:</p><p>traefik.toml</p><figure><div class="code-area"><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml">[entryPoints]
  [entryPoints.web]
    address = ":80"
    [entryPoints.web.http.redirections.entryPoint]
      to = "websecure"
      scheme = "https"

  [entryPoints.websecure]
    address = ":443"</code></pre></div></figure><p>Note that you are also automatically redirecting traffic to be handled over TLS.</p><p>Next, configure the Traefik <code>api</code>, which gives you access to both the API and your dashboard interface. The heading of <code>[api]</code> is all that you need because the dashboard is then enabled by default, but you’ll be explicit for the time being.</p><p>Add the following code:</p><p>traefik.toml</p><figure><div class="code-area"><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml">...
[api]
  dashboard = true</code></pre></div></figure><p>To finish securing your web requests you want to use Let’s Encrypt to generate valid TLS certificates. Traefik v2 supports Let’s Encrypt out of the box and you can configure it by creating a <em>certificates resolver</em> of the type <code>acme</code>.</p><p>Let’s configure your certificates resolver now using the name <code>lets-encrypt</code>:</p><p>traefik.toml</p><figure><div class="code-area"><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml">...
[certificatesResolvers.lets-encrypt.acme]
  email = "your_email@your_domain"
  storage = "acme.json"
  [certificatesResolvers.lets-encrypt.acme.tlsChallenge]</code></pre></div></figure><p>This section is called <code>acme</code> because <a target="_blank" rel="noopener" href="https://github.com/ietf-wg-acme/acme/">ACME</a> is the name of the protocol used to communicate with Let’s Encrypt to manage certificates. The Let’s Encrypt service requires registration with a valid email address, so to have Traefik generate certificates for your hosts, set the <code>email</code> key to your email address. You then specify that you will store the information that you will receive from Let’s Encrypt in a JSON file called <code>acme.json</code>.</p><p>The <code>acme.tlsChallenge</code> section allows us to specify how Let’s Encrypt can verify that the certificate. You’re configuring it to serve a file as part of the challenge over port <code>443</code>.</p><p>Finally, you need to configure Traefik to work with Docker.</p><p>Add the following configurations:</p><p>traefik.toml</p><figure><div class="code-area"><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml">...
[providers.docker]
  watch = true
  network = "web"</code></pre></div></figure><p>The <code>docker</code> provider enables Traefik to act as a proxy in front of Docker containers. You’ve configured the provider to <code>watch</code> for new containers on the <code>web</code> network, which you’ll create soon.</p><p>Our final configuration uses the <code>file</code> provider. With Traefik v2, static and dynamic configurations can’t be mixed and matched. To get around this, you will use <code>traefik.toml</code> to define your static configurations and then keep your dynamic configurations in another file, which you will call <code>traefik_dynamic.toml</code>. Here you are using the <code>file</code> provider to tell Traefik that it should read in dynamic configurations from a different file.</p><p>Add the following <code>file</code> provider:</p><p>traefik.toml</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">[providers.file]
  filename = "traefik_dynamic.toml"</code></pre></div></figure><p>Your completed <code>traefik.toml</code> will look like this:</p><p>traefik.toml</p><figure><div class="code-area"><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml">[entryPoints]
  [entryPoints.web]
    address = ":80"
    [entryPoints.web.http.redirections.entryPoint]
      to = "websecure"
      scheme = "https"

  [entryPoints.websecure]
    address = ":443"

[api]
  dashboard = true

[certificatesResolvers.lets-encrypt.acme]
  email = "your_email@your_domain"
  storage = "acme.json"
  [certificatesResolvers.lets-encrypt.acme.tlsChallenge]

[providers.docker]
  watch = true
  network = "web"

[providers.file]
  filename = "traefik_dynamic.toml"</code></pre></div></figure><p>Save and close the file.</p><p>Now let’s create <code>traefik_dynamic.toml</code>.</p><p>The dynamic configuration values that you need to keep in their own file are the <em>middlewares</em> and the <em>routers</em>. To put your dashboard behind a password you need to customize the API’s <em>router</em> and configure a <em>middleware</em> to handle HTTP basic authentication. Let’s start by setting up the middleware.</p><p>The middleware is configured on a per-protocol basis and since you’re working with HTTP you’ll specify it as a section chained off of <code>http.middlewares</code>. Next comes the name of your middleware so that you can reference it later, followed by the type of middleware that it is, which will be <code>basicAuth</code> in this case. Let’s call your middleware <code>simpleAuth</code>.</p><p>Create and open a new file called <code>traefik_dynamic.toml</code>:</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nano traefik_dynamic.toml</code></pre></div></figure><p>Add the following code. This is where you’ll paste the output from the <code>htpasswd</code> command:</p><p>traefik_dynamic.toml</p><figure><div class="code-area"><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml">[http.middlewares.simpleAuth.basicAuth]
  users = [
    "admin:$apr1$ruca84Hq$mbjdMZBAG.KWn7vfN/SNK/"
  ]</code></pre></div></figure><p>To configure the router for the api you’ll once again be chaining off of the protocol name, but instead of using <code>http.middlewares</code>, you’ll use <code>http.routers</code> followed by the name of the router. In this case, the <code>api</code> provides its own named router that you can configure by using the <code>[http.routers.api]</code> section. You’ll configure the domain that you plan on using with your dashboard also by setting the <code>rule</code> key using a host match, the entrypoint to use <code>websecure</code>, and the middlewares to include <code>simpleAuth</code>.</p><p>Add the following configurations:</p><p>traefik_dynamic.toml</p><figure><div class="code-area"><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml">...
[http.routers.api]
  rule = "Host(`monitor.your_domain`)"
  entrypoints = ["websecure"]
  middlewares = ["simpleAuth"]
  service = "api@internal"
  [http.routers.api.tls]
    certResolver = "lets-encrypt"</code></pre></div></figure><p>The <code>web</code> entry point handles port <code>80</code>, while the <code>websecure</code> entry point uses port <code>443</code> for TLS/SSL. You automatically redirect all of the traffic on port <code>80</code> to the <code>websecure</code> entry point to force secure connections for all requests.</p><p>Notice the last three lines here configure a <em>service</em>, enable tls, and configure <code>certResolver</code> to <code>"lets-encrypt"</code>. Services are the final step to determining where a request is finally handled. The <code>api@internal</code> service is a built-in service that sits behind the API that you expose. Just like routers and middlewares, services can be configured in this file, but you won’t need to do that to achieve your desired result.</p><p>Your completed <code>traefik_dynamic.toml</code> file will look like this:</p><p>traefik_dynamic.toml</p><figure><div class="code-area"><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml">[http.middlewares.simpleAuth.basicAuth]
  users = [
    "admin:$apr1$ruca84Hq$mbjdMZBAG.KWn7vfN/SNK/"
  ]

[http.routers.api]
  rule = "Host(`monitor.your_domain`)"
  entrypoints = ["websecure"]
  middlewares = ["simpleAuth"]
  service = "api@internal"
  [http.routers.api.tls]
    certResolver = "lets-encrypt"</code></pre></div></figure><p>Save the file and exit the editor.</p><p>With these configurations in place, you will now start Traefik.</p><h2 id="Step-2-–-Running-the-Traefik-Container">Step 2 – Running the Traefik Container</h2><p>In this step you will create a Docker network for the proxy to share with containers. You will then access the Traefik dashboard. The Docker network is necessary so that you can use it with applications that are run using Docker Compose.</p><p>Create a new Docker network called <code>web</code>:</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker network create web</code></pre></div></figure><p>When the Traefik container starts, you will add it to this network. Then you can add additional containers to this network later for Traefik to proxy to.</p><p>Next, create an empty file that will hold your Let’s Encrypt information. You’ll share this into the container so Traefik can use it:</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">touch acme.json</code></pre></div></figure><p>Traefik will only be able to use this file if the root user inside of the container has unique read and write access to it. To do this, lock down the permissions on <code>acme.json</code> so that only the owner of the file has read and write permission.</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chmod 600 acme.json</code></pre></div></figure><p>Once the file gets passed to Docker, the owner will automatically change to the <strong>root</strong> user inside the container.</p><p>Finally, create the Traefik container with this command:</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run -d \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v $PWD/traefik.toml:/traefik.toml \
  -v $PWD/traefik_dynamic.toml:/traefik_dynamic.toml \
  -v $PWD/acme.json:/acme.json \
  -p 80:80 \
  -p 443:443 \
  --network web \
  --name traefik \
  traefik:v2.2</code></pre></div></figure><p>This command is a little long. Let’s break it down.</p><p>You use the <code>-d</code> flag to run the container in the background as a daemon. You then share your <code>docker.sock</code> file into the container so that the Traefik process can listen for changes to containers. You also share the <code>traefik.toml</code> and <code>traefik_dynamic.toml</code> configuration files into the container, as well as <code>acme.json</code>.</p><p>Next, you map ports <code>:80</code> and <code>:443</code> of your Docker host to the same ports in the Traefik container so Traefik receives all HTTP and HTTPS traffic to the server.</p><p>You set the network of the container to <code>web</code>, and you name the container <code>traefik</code>.</p><p>Finally, you use the <code>traefik:v2.2</code> image for this container so that you can guarantee that you’re not running a completely different version than this tutorial is written for.</p><p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#entrypoint">A Docker image’s <code>ENTRYPOINT</code> is a command that always runs when a container is created from the image</a>. In this case, the command is the <code>traefik</code> binary within the container. You can pass additional arguments to that command when you launch the container, but you’ve configured all of your settings in the <code>traefik.toml</code> file.</p><p>With the container started, you now have a dashboard you can access to see the health of your containers. You can also use this dashboard to visualize the routers, services, and middlewares that Traefik has registered. You can try to access the monitoring dashboard by pointing your browser to <code>https://monitor.your_domain/dashboard/</code> (the trailing <code>/</code> is required).</p><p>You will be prompted for your username and password, which are <strong>admin</strong> and the password you configured in Step 1.</p><p>Once logged in, you’ll see the Traefik interface:</p><p><img src="https://cimg1.17lai.fun/data/2021/10/1420211014200207.png" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload alt="Empty Traefik dashboard"></p><p>You will notice that there are already some routers and services registered, but those are the ones that come with Traefik and the router configuration that you wrote for the API.</p><p>You now have your Traefik proxy running, and you’ve configured it to work with Docker and monitor other containers. In the next step you will start some containers for Traefik to proxy.</p><h2 id="Step-3-—-Registering-Containers-with-Traefik">Step 3 — Registering Containers with Traefik</h2><p>With the Traefik container running, you’re ready to run applications behind it. Let’s launch the following containers behind Traefik:</p><ol><li>A blog using the <a target="_blank" rel="noopener" href="https://hub.docker.com/_/wordpress/">official WordPress image</a>.</li><li>A database management server using the <a target="_blank" rel="noopener" href="https://hub.docker.com/_/adminer/">official Adminer image</a>.</li></ol><p>You’ll manage both of these applications with Docker Compose using a <code>docker-compose.yml</code> file.</p><p>Create and open the <code>docker-compose.yml</code> file in your editor:</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nano docker-compose.yml</code></pre></div></figure><p>Add the following lines to the file to specify the version and the networks you’ll use:</p><p>docker-compose.yml</p><figure><div class="code-area"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">version: "3"

networks:
  web:
    external: true
  internal:
    external: false</code></pre></div></figure><p>You use Docker Compose version <code>3</code> because it’s the newest major version of the Compose file format.</p><p>For Traefik to recognize your applications, they must be part of the same network, and since you created the network manually, you pull it in by specifying the network name of <code>web</code> and setting <code>external</code> to <code>true</code>. Then you define another network so that you can connect your exposed containers to a database container that you won’t expose through Traefik. You’ll call this network <code>internal</code>.</p><p>Next, you’ll define each of your <code>services</code>, one at a time. Let’s start with the <code>blog</code> container, which you’ll base on the official WordPress image. Add this configuration to the bottom of the file:</p><p>docker-compose.yml</p><figure><div class="code-area"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">...

services:
  blog:
    image: wordpress:4.9.8-apache
    environment:
      WORDPRESS_DB_PASSWORD:
    labels:
      - traefik.http.routers.blog.rule=Host(`blog.your_domain`)
      - traefik.http.routers.blog.tls=true
      - traefik.http.routers.blog.tls.certresolver=lets-encrypt
      - traefik.port=80
    networks:
      - internal
      - web
    depends_on:
      - mysql</code></pre></div></figure><p>The <code>environment</code> key lets you specify environment variables that will be set inside of the container. By not setting a value for <code>WORDPRESS_DB_PASSWORD</code>, you’re telling Docker Compose to get the value from your shell and pass it through when you create the container. You will define this environment variable in your shell before starting the containers. This way you don’t hard-code passwords into the configuration file.</p><p>The <code>labels</code> section is where you specify configuration values for Traefik. Docker labels don’t do anything by themselves, but Traefik reads these so it knows how to treat containers. Here’s what each of these labels does:</p><ul><li><code>traefik.http.routers.adminer.rule=Host(`````blog.your_domain`````)</code> creates a new <em>router</em> for your container and then specifies the routing rule used to determine if a request matches this container.</li><li><code>traefik.routers.custom_name.tls=true</code> specifies that this router should use TLS.</li><li><code>traefik.routers.custom_name.tls.certResolver=lets-encrypt</code> specifies that the certificates resolver that you created earlier called <code>lets-encrypt</code> should be used to get a certificate for this route.</li><li><code>traefik.port</code> specifies the exposed port that Traefik should use to route traffic to this container.</li></ul><p>With this configuration, all traffic sent to your Docker host on port <code>80</code> or <code>443</code> with the domain of <code>blog.your_domain</code> will be routed to the <code>blog</code> container.</p><p>You assign this container to two different networks so that Traefik can find it via the <code>web</code> network and it can communicate with the database container through the <code>internal</code> network.</p><p>Lastly, the <code>depends_on</code> key tells Docker Compose that this container needs to start <em>after</em> its dependencies are running. Since WordPress needs a database to run, you must run your <code>mysql</code> container before starting your <code>blog</code> container.</p><p>Next, configure the MySQL service:</p><p>docker-compose.yml</p><figure><div class="code-area"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">services:
...
  mysql:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD:
    networks:
      - internal
    labels:
      - traefik.enable=false</code></pre></div></figure><p>You’re using the official MySQL 5.7 image for this container. You’ll notice that you’re once again using an <code>environment</code> item without a value. The <code>MYSQL_ROOT_PASSWORD</code> and <code>WORDPRESS_DB_PASSWORD</code> variables will need to be set to the same value to make sure that your WordPress container can communicate with the MySQL. You don’t want to expose the <code>mysql</code> container to Traefik or the outside world, so you’re only assigning this container to the <code>internal</code> network. Since Traefik has access to the Docker socket, the process will still expose a router for the <code>mysql</code> container by default, so you’ll add the label <code>traefik.enable=false</code> to specify that Traefik should not expose this container.</p><p>Finally, define the Adminer container:</p><p>docker-compose.yml</p><figure><div class="code-area"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">services:
...
  adminer:
    image: adminer:4.6.3-standalone
    labels:
      - traefik.http.routers.adminer.rule=Host(`db-admin.your_domain`)
      - traefik.http.routers.adminer.tls=true
      - traefik.http.routers.adminer.tls.certresolver=lets-encrypt
      - traefik.port=8080
    networks:
      - internal
      - web
    depends_on:
      - mysql</code></pre></div></figure><p>This container is based on the official Adminer image. The <code>network</code> and <code>depends_on</code> configuration for this container exactly match what you’re using for the <code>blog</code> container.</p><p>The line <code>traefik.http.routers.adminer.rule=Host(`````db-admin.your_domain`````)</code> tells Traefik to examine the host requested. If it matches the pattern of <code>db-admin.your_domain</code>, Traefik will route the traffic to the <code>adminer</code> container over port <code>8080</code>.</p><p>Your completed <code>docker-compose.yml</code> file will look like this:</p><p>docker-compose.yml</p><figure><div class="code-area"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">version: "3"

networks:
  web:
    external: true
  internal:
    external: false

services:
  blog:
    image: wordpress:4.9.8-apache
    environment:
      WORDPRESS_DB_PASSWORD:
    labels:
      - traefik.http.routers.blog.rule=Host(`blog.your_domain`)
      - traefik.http.routers.blog.tls=true
      - traefik.http.routers.blog.tls.certresolver=lets-encrypt
      - traefik.port=80
    networks:
      - internal
      - web
    depends_on:
      - mysql

  mysql:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD:
    networks:
      - internal
    labels:
      - traefik.enable=false

  adminer:
    image: adminer:4.6.3-standalone
    labels:
    labels:
      - traefik.http.routers.adminer.rule=Host(`db-admin.your_domain`)
      - traefik.http.routers.adminer.tls=true
      - traefik.http.routers.adminer.tls.certresolver=lets-encrypt
      - traefik.port=8080
    networks:
      - internal
      - web
    depends_on:
      - mysql</code></pre></div></figure><p>Save the file and exit the text editor.</p><p>Next, set values in your shell for the <code>WORDPRESS_DB_PASSWORD</code> and <code>MYSQL_ROOT_PASSWORD</code> variables:</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">export WORDPRESS_DB_PASSWORD=secure_database_password
export MYSQL_ROOT_PASSWORD=secure_database_password</code></pre></div></figure><p>Substitute <code>secure_database_password</code> with your desired database password. Remember to use the same password for both <code>WORDPRESS_DB_PASSWORD</code> and <code>MYSQL_ROOT_PASSWORD</code>.</p><p>With these variables set, run the containers using <code>docker-compose</code>:</p><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker-compose up -d</code></pre></div></figure><p>Now watch the Traefik admin dashboard while it populates.</p><p><img src="https://cimg1.17lai.fun/data/2021/10/1420211014200110.png" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload alt="Populated Traefik dashboard"></p><p>If you explore the <strong>Routers</strong> section you will find routers for <code>adminer</code> and <code>blog</code> configured with TLS:</p><p><img src="https://cimg1.17lai.fun/data/2021/10/1420211014200142.png" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload alt="HTTP Routers w/ TLS"></p><p>Navigate to <code>blog.your_domain</code>, substituting <code>your_domain</code> with your domain. You’ll be redirected to a TLS connection and you can now complete the WordPress setup:</p><p><img src="https://cimg1.17lai.fun/data/2021/10/1420211014200114.png" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload alt="WordPress setup screen"></p><p>Now access Adminer by visiting <code>db-admin.your_domain</code> in your browser, again substituting <code>your_domain</code> with your domain. The <code>mysql</code> container isn’t exposed to the outside world, but the <code>adminer</code> container has access to it through the <code>internal</code> Docker network that they share using the <code>mysql</code> container name as a hostname.</p><p>On the Adminer login screen, enter <code>root</code> for <strong>Username</strong>, enter <code>mysql</code> for <strong>Server</strong>, and enter the value you set for <code>MYSQL_ROOT_PASSWORD</code> for the <strong>Password</strong>. Leave <strong>Database</strong> empty. Now press <strong>Login</strong>.</p><p>Once logged in, you’ll see the Adminer user interface.</p><p><img src="https://cimg1.17lai.fun/data/2021/10/1420211014200132.png" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload alt="Adminer connected to the MySQL database"></p><p>Both sites are now working, and you can use the dashboard at <code>monitor.your_domain</code> to keep an eye on your applications.</p><h2 id="Conclusion">Conclusion</h2><p>In this tutorial, you configured Traefik v2 to proxy requests to other applications in Docker containers.</p><p>Traefik’s declarative configuration at the application container level makes it easy to configure more services, and there’s no need to restart the <code>traefik</code> container when you add new applications to proxy traffic to since Traefik notices the changes immediately through the Docker socket file it’s monitoring.</p><p>To learn more about what you can do with Traefik v2, head over to <a target="_blank" rel="noopener" href="https://doc.traefik.io/traefik/">the official Traefik documentation</a>.</p><h2 id="服务集群">服务集群</h2><blockquote><p>k8s 太重了,虽然也有 k3s 之类的轻量级 k8s 解决方案，不过我还是选择了原生的 docker swarm。VPS 安装好 Docker 之后，不需要额外安装软件，就可以马上建立集群。</p></blockquote><figure><div class="code-area"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># 集群初始化，节点成为 manager 节点
docker swarm init --advertise-addr=x.x.x.x

# 集群丢失 Leader 时，强制重建集群
docker swarm init --advertise-addr=x.x.x.x --force-new-cluster

# 获取作为 worker 节点加入集群的命令
docker swarm join-token worker

# 获取作为 manager 节点加入集群的命令
docker swarm join-token manager

# 加入集群
docker swarm join --token xxx x.x.x.x:xxx --advertise-addr=x.x.x.x
</code></pre></div></figure><h2 id="参考：">参考：</h2><ul><li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04">digitalocean</a></li><li><a target="_blank" rel="noopener" href="https://shanyue.tech/op/traefik.html">shanyue</a></li></ul><h2 id="i-class-fa-solid-fa-school-i-系列教程"><i class="fa-solid fa-school"></i><strong>系列教程</strong></h2><p><a href="/atom.xml"><i class="fa-solid fa-square-rss"></i>全部文章RSS订阅</a></p><h3 id="i-class-fa-brands-fa-docker-i-Docker系列"><i class="fa-brands fa-docker"></i><strong>Docker系列</strong></h3><p><a href="/categories/docker/atom.xml"><i class="fa-solid fa-square-rss"></i><strong>Docker 分类 RSS 订阅</strong></a></p><ul><li><a href="/posts/42b6a86d/">Docker使用简明教程</a></li><li><a href="/posts/9912bd5d/">使用jeckett,sonarr,iyuu,qt,emby打造全自动追剧流程</a></li><li><a href="/posts/1802a8a7/">为知笔记私有化Docker部署</a></li><li><a href="/posts/593cc323/">Earthly 一个更加强大的镜像构建工具</a></li><li><a href="/posts/90e60aac/">使用 Shell 脚本实现一个简单 Docker</a></li><li><a href="/posts/465d2738/">如何使用Traefik V2 在Ubuntu20.04 上面来做 Dockers</a></li><li><a href="/posts/462f1e5c/">通过IPV6访问Qnap NAS中Docker的服务</a></li></ul></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: </i></span><span class="reprint-info"><a href="https://blog.17lai.site" rel="external nofollow noreferrer">夜法之书</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: </i></span><span class="reprint-info"><a href="https://blog.17lai.site/posts/465d2738/">https://blog.17lai.site/posts/465d2738/</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.17lai.site" target="_blank">夜法之书</a> !</span></div></div><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/docker/"><span class="chip bg-color">docker</span> </a><a href="/tags/traefik/"><span class="chip bg-color">traefik</span> </a><a href="/tags/proxy/"><span class="chip bg-color">proxy</span> </a><a href="/tags/swarm/"><span class="chip bg-color">swarm</span> </a><a href="/tags/ubuntu/"><span class="chip bg-color">ubuntu</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close" href="javascript:;" aria-label="打赏作者"><i class="fa fa-times-circle"></i></a><p class="reward-title">码字辛苦，打赏作者！</p><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://fast.17lai.site/medias_webp/reward/alipay.webp" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload loading="lazy" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://fast.17lai.site/medias_webp/reward/wechat.webp" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload loading="lazy" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><div class="webpush-dingyue" style="margin:10px 0;text-align:center"><div id="webpushr-subscription-button" data-size="small" data-button-text="订阅博文" data-subscriber-count-text="个用户已订阅" data-background-color="#6295d0"></div></div><script>$((function(){$(".reward-tabs").tabs({event:"mouseover"})}))</script></div></div><div id="comments" lazyload><div class="card waline-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="waline" class="card-content" style="display:grid"></div></div><div id="to_comment" class="comment-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="javascript:;" title="直达评论"><i class="fas fa-comments"></i></a></div></div><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;上一篇</div><div class="card"><a href="/posts/44557ab0/"><div class="card-image card-image-V"><div class="box-content"><p class="title">阅读全文</p><span class="post" style="width:180px">第一次使用VS CODE时你应该指导的一切配置</span></div><img src="https://fast.17lai.site/medias_webp/cover/vscode.webp" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload class="responsive-img" alt="第一次使用VS CODE时你应该指导的一切配置"> <span class="card-title title-V">第一次使用VS CODE时你应该指导的一切配置</span></div></a><div class="card-content article-content"><div class="summary block-with-text">VS Code 的全称是 Visual Studio Code，是一款开源的、免费的、跨平台的、高性能的、轻量级的代码编辑器。它在性能、语言支持、开源社区方面，都做得很不错。</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2021-10-18 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/tools/" class="post-category">tools</a></span></div></div><div class="card-action article-tags"><a href="/tags/vscode/"><span class="chip bg-color">vscode</span> </a><a href="/tags/%E6%8F%92%E4%BB%B6/"><span class="chip bg-color">插件</span> </a><a href="/tags/%E7%BC%96%E7%A0%81/"><span class="chip bg-color">编码</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/462f1e5c/"><div class="card-image card-image-V"><div class="box-content"><p class="title">阅读全文</p><span class="post" style="width:180px">如何通过IPV6访问Qnap NAS中Docker的服务</span></div><img src="https://fast.17lai.site/medias_webp/cover/qnap.webp" srcset="https://fast.17lai.site/medias_webp/loading2.svg" loading="lazy" lazyload class="responsive-img" alt="如何通过IPV6访问Qnap NAS中Docker的服务"> <span class="card-title title-V">如何通过IPV6访问Qnap NAS中Docker的服务</span></div></a><div class="card-content article-content"><div class="summary block-with-text">qnap内置的dockers是不支持ipv6的，官方确认过的。但是，通过两种特殊技巧，可以通过IPV6访问Qnap NAS中Docker的服务。方法适用于所有Docker版本！</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2021-10-12 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/docker/" class="post-category">docker</a></span></div></div><div class="card-action article-tags"><a href="/tags/qnap/"><span class="chip bg-color">qnap</span> </a><a href="/tags/nas/"><span class="chip bg-color">nas</span> </a><a href="/tags/docker/"><span class="chip bg-color">docker</span> </a><a href="/tags/ipv6/"><span class="chip bg-color">ipv6</span></a></div></div></div></div></article></div></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color" href="javascript:;" title="显示/隐藏目录"><i class="fas fa-list-ul"></i></a></div></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2020-2023</span> <a href="/about" target="_blank">夜法之书</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a> <span id="translate">|&nbsp;繁/简：</span><a id="translateLink" href="javascript:translatePage();">繁</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">495.2k</span> <span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp; <span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp; <span id="busuanzi_value_site_uv" class="white-color"></span> </span><span id="waline_container_site_pv" style="display:none">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp; <span class="waline-pageview-count" data-path="/" class="white-color"></span></span><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),a=e.getHours(),r=e.getMinutes(),s=e.getSeconds(),o=Date.UTC("2020","6","28","0","0","0"),g=Date.UTC(t,n,i,a,r,s)-o,d=Math.floor(g/31536e6),m=Math.floor(g/864e5-365*d);if("2020"===String(t)){document.getElementById("year").innerHTML=t;var l="This site has been running for "+m+" days";l="本站已运行 "+m+" 天",document.getElementById("sitetime").innerHTML=l}else{document.getElementById("year").innerHTML="2020 - "+t;var c="This site has been running for "+d+" years and "+m+" days";c="本站已运行 "+d+" 年 "+m+" 天",document.getElementById("sitetime").innerHTML=c}};calcSiteTime()</script><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/appotry" class="tooltipped" target="_blank" title="访问我的GitHub" aria-label="访问我的GitHub" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github fa-fw"></i> </a><a href="https://hub.docker.com/u/bloodstar" class="tooltipped" target="_blank" title="访问我的DockerHub" aria-label="访问我的DockerHub" data-tooltip="访问我的DockerHub" data-position="top" data-delay="50"><i class="fab fa-docker fa-fw"></i> </a><a href="mailto:andycrusoe@gmail.com" class="tooltipped" target="_blank" title="邮件联系我" aria-label="邮件联系我" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open fa-fw"></i> </a><a href="/atom.xml" class="tooltipped" target="_blank" title="RSS 订阅" aria-label="RSS 订阅" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss fa-fw"></i></a></div></div></footer><div class="progress-bar"></div><canvas id="snowdown" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:100;pointer-events:none"></canvas><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span><div class="search-input-container"><input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><a class="close modal-close" href="javascript:;" title="关闭搜索"><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></a></div><div id="searchResult"></div></div></div><script type="text/javascript">var searchFunc=function(t,e,r){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var n=$("entry",t).map((function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}})).get(),a=document.getElementById(e),s=document.getElementById(r);a.addEventListener("input",(function(){var t='<ul class="search-result-list">',e=this.value.trim().toLowerCase().split(/[\s\-]+/);s.innerHTML="",this.value.trim().length<=0||(n.forEach((function(r){var n=!0,a=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),c=r.url;c=0===c.indexOf("/")?r.url:"/"+c;var i=-1,l=-1,u=-1;if(""!==a&&""!==s&&e.forEach((function(t,e){i=a.indexOf(t),l=s.indexOf(t),i<0&&l<0?n=!1:(l<0&&(l=0),0===e&&(u=l))})),n){t+="<li><a href='"+c+"' class='search-result-title'>"+a+"</a>";var o=r.content.trim().replace(/<[^>]+>/g,"");if(u>=0){var h=u-20,f=u+80;h<0&&(h=0),0===h&&(f=100),f>o.length&&(f=o.length);var m=o.substr(h,f);e.forEach((function(t){var e=new RegExp(t,"gi");m=m.replace(e,'<em class="search-keyword">'+t+"</em>")})),t+='<p class="search-result">'+m+"...</p>"}t+="</li>"}})),t+="</ul>",s.innerHTML=t)}))}})};function startXMLSearch(){searchFunc("https://fast.17lai.site/search.xml","searchInput","searchResult")}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!" title="回到顶部"><i class="fas fa-arrow-up"></i></a></div><script src="https://fast.17lai.site/libs/materialize/materialize.min.js"></script><script src="https://fast.17lai.site/libs/masonry/masonry.pkgd.min.js"></script><script src="https://fast.17lai.site/libs/aos/aos.min.js"></script><script src="https://fast.17lai.site/js/events.js"></script><script src="https://fast.17lai.site/js/plugins.js"></script><script type="module" async>var pagePath=window.location.pathname.replace(/\/$/,"")+"/";import{pageviewCount}from"https://fast.17lai.site/libs/waline/pageview.min.mjs";function isOwnEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function upDatePageview(){const e=pageviewCount({serverURL:"https://waline.17lai.site",path:pagePath});setTimeout(()=>e(),2e3);document.getElementById("waline_container_site_pv");var t=document.getElementById("waline_container_page_pv");t?1!=isOwnEmpty(t.style)?(t.style.display="inline",console.log("[waline]update pageview count!")):console.log("[waline]ewacpv.style null!"):console.log("[waline]home page!")}function delayupDatePageview(){setTimeout((function(){upDatePageview()}),3e3),console.log("[waline]delay update comment count!")}delayupDatePageview()</script><script type="module" async>var pagePath=window.location.pathname.replace(/\/$/,"")+"/";import{commentCount}from"https://fast.17lai.site/libs/waline/comment.min.mjs";function upDateComment(){const e=commentCount({serverURL:"https://waline.17lai.site",path:pagePath});setTimeout(()=>e(),3e3);try{wa_ccc="waline_container_comment_count",document.getElementById(wa_ccc).style.display="inline"}catch(e){console.log("[waline-count][Error] err")}console.log("[waline]update comment count!")}function delayUpDateComment(){setTimeout((function(){upDateComment()}),3e3),console.log("[waline]delay update comment count!")}delayUpDateComment()</script><script async>var index,img,image,windowWidth=$(window).width(),colorSchemaInitStorageKey="Matery_Color_Scheme_Now",colorToggleButtonSelector="#color-toggle-btn";function getRandomBackgroundPic(e){return"dark"==e?(index=Math.ceil(17*Math.random())-1,img=["/medias_webp/featureimages/5.webp","/medias_webp/featureimages/7.webp","/medias_webp/featureimages/8.webp","/medias_webp/featureimages/12.webp","/medias_webp/featureimages/15.webp","/medias_webp/featureimages/24.webp","/medias_webp/featureimages/26.webp","/medias_webp/featureimages/28.webp","/medias_webp/featureimages/31.webp","/medias_webp/featureimages/32.webp","/medias_webp/featureimages/37.webp","/medias_webp/featureimages/38.webp","/medias_webp/featureimages/39.webp","/medias_webp/featureimages/40.webp","/medias_webp/featureimages/41.webp","/medias_webp/featureimages/42.webp","/medias_webp/featureimages/50.webp"],"dark"):(index=Math.ceil(15*Math.random())-1,img=["/medias_webp/featureimages/0.webp","/medias_webp/featureimages/6.webp","/medias_webp/featureimages/8.webp","/medias_webp/featureimages/17.webp","/medias_webp/featureimages/18.webp","/medias_webp/featureimages/22.webp","/medias_webp/featureimages/23.webp","/medias_webp/featureimages/26.webp","/medias_webp/featureimages/29.webp","/medias_webp/featureimages/48.webp","/medias_webp/featureimages/49.webp","/medias_webp/featureimages/1.webp","/medias_webp/featureimages/13.webp","/medias_webp/featureimages/14.webp","/medias_webp/featureimages/16.webp"],"light")}function setBackgroundPic(){var e=document.querySelector(colorToggleButtonSelector);e&&e.addEventListener("click",(function(){getRandomBackgroundPic(getLS(colorSchemaInitStorageKey)),(image=new Image).onload=function(){document.getElementsByClassName("lazy-background")[0].style.backgroundImage="url(https://fast.17lai.site"+img[index]+")",console.log("get background pic:"+index+":https://fast.17lai.site"+img[index])},image.src="https://fast.17lai.site"+img[index]}))}if(windowWidth>1024&&Number(localStorage.viewCount)>1)try{getRandomBackgroundPic(getLS(colorSchemaInitStorageKey)),document.getElementsByClassName("lazy-background")[0].style.backgroundImage="var(--loading-img)",(image=new Image).onload=function(){document.getElementsByClassName("lazy-background")[0].style.backgroundImage="url(https://fast.17lai.site"+img[index]+")",console.log("get background pic:"+index+":https://fast.17lai.site"+img[index])},image.src="https://fast.17lai.site"+img[index]}catch(e){console.log("随机背景图片 error.")}windowWidth>1024&&setBackgroundPic()</script><script src="https://fast.17lai.site/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://fast.17lai.site/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://fast.17lai.site/libs/jquery/jquery-ui.min.js"></script><script type="text/javascript" src="https://fast.17lai.site/js/tw_cn.js"></script><script type="text/javascript">var defaultEncoding=2,translateDelay=0,cookieDomain="https://blog.17lai.site",msgToTraditionalChinese="繁",msgToSimplifiedChinese="简",translateButtonId="translateLink";translateInitilization()</script><div class="waifu"><div class="waifu-tips"></div><canvas id="live2d" class="live2d"></canvas><div class="waifu-tool"><span class="fa fa-lg fa-home"></span> <span class="fa fa-lg fa-comment"></span> <span class="fa fa-lg fa-user-circle"></span> <span class="fa fa-lg fa-street-view"></span> <span class="fa fa-lg fa-camera-retro"></span> <span class="fa fa-lg fa-info-circle"></span> <span class="fa fa-lg fa-times-circle"></span></div></div><script async src="https://fast.17lai.site/libs/instantpage/instantpage.min.js" type="module"></script><script type="text/javascript">localStorage.getItem("viewCount")?(localStorage.viewCount=Number(localStorage.viewCount)+1,console.log("Welcome to visited again!")):(localStorage.setItem("viewCount","1"),console.log("Welcome! New Reader!"))</script><script type="text/javascript">var themeStorage=window.localStorage;window.localStorage?(console.log("设定waline count title"),themeStorage.setItem("title","夜法之书")):console.log("浏览器不支持localstorage")</script><script src="https://fast.17lai.site/libs/jquery/jquery-ui.min.js"></script><script type="text/javascript">var windowWidth=$(window).width();if(windowWidth>1024&&Number(localStorage.viewCount)>1)try{$.ajax({url:"https://fast.17lai.site/libs/live2d/waifu-tips.js",dataType:"script",cache:!0,success:function(){$.ajax({url:"https://fast.17lai.site/libs/live2d/live2d.js",dataType:"script",cache:!0,success:function(){live2d_settings.modelId=2,live2d_settings.modelTexturesId=17,live2d_settings.modelStorage=!0,live2d_settings.canCloseLive2d=!0,live2d_settings.canTurnToHomePage=!1,live2d_settings.waifuDraggable="axis-x",live2d_settings.waifuDraggableRevert=!0,initModel("https://fast.17lai.site/libs/live2d/waifu-tips.json")}})}})}catch(i){console.log("[Live2d][Error] JQuery is not defined.")}</script><script>var pagePath=window.location.pathname.replace(/\/$/,"")+"/";function initWaline(){console.log("[WALINE]init waline"),Waline.init({el:"#waline",locale:{lang:"zh-cn",nick:"🧊 昵称",mail:"📧 邮箱",link:"🔗 网址",placeholder:"🤣一起来玩，留下你的足迹吧~。评论支持邮箱回复通知！📧\r\n 🚀支持注册登录，并新增支持Github登录(⊙o⊙)！💖\r\n 💣请文明评论哦禁止恶意评论🈲\r\n ⚠️公开网络空间，请不要发表任何包含个人或其他人的隐私信息⛔",sofa:"🌌 来发评论吧~",submit:"发送留言",comment:"评论",more:"读取更多评论",uploading:"正在上传",login:"登录",admin:"博主",word:"个字",nickError:"昵称不能少於 3 个字符",mailError:"请填写正确的电子邮箱",wordHint:"评论字数应在 $0 到 $1 字之间！\\n目前字数：$2",seconds:"秒前",minutes:"分钟前",hours:"小时前",days:"天前",now:"就在刚刚",reply:"回复",canaleReply:"取消回复",emoji:"表情",uploadImage:"上传图片",logout:"退出登录",preview:"预览",level0:"炼体",level1:"炼气",level2:"筑基",level3:"金丹",level4:"元婴",level5:"化神",reactionTitle:"码字辛苦！客官不评论一下么？",reaction0:"赞一个",reaction1:"踩一下",reaction2:"有点酷",reaction3:"看不懂",reaction4:"啥玩意",reaction5:"想睡觉"},serverURL:"https://waline.17lai.site",path:pagePath,avatar:"mp",emoji:["//cdn.jsdelivr.net/gh/walinejs/emojis@latest/weibo"],lang:"zh-CN",dark:'html[data-user-color-scheme="dark"]',login:"enable",wordLimit:"1000",pageSize:"10",highlighter:"hanabi",pageview:!1,comment:!0,reaction:!0,imageUploader:!1,meta:["nick","mail","link"],recaptchaV3Key:"6LeUY0MiAAAAABNBvi6m4PcCtKkv_W6x-_YhTb6n",requiredMeta:["nick","mail"]});{function e(){const e=Waline.commentCount({serverURL:"https://waline.17lai.site",path:pagePath});setTimeout(()=>e(),2e3);try{wa_ccc="waline_container_comment_count",document.getElementById(wa_ccc).style.display="inline"}catch(e){console.log("[waline-count][Error] err")}console.log("[waline]update comment count!")}function n(){setTimeout((function(){e()}),5e3),console.log("[waline]delay update comment count!")}var i=document.body.getElementsByClassName("wl-btn primary");void 0!==i[0]?(void 0!==window.addEventListener?i[0].addEventListener("click",n,!1):i[0].attachEvent("onclick",n),e()):console.log("[waline]没有开启waline!")}AOS.refresh(),progressBarInit()}function loadWaline(){try{$.ajax({url:"https://fast.17lai.site/libs/waline/waline.min.css",dataType:"text/css",cache:!0,success:function(e){$("head").append("<style>"+e+"</style>")},error:function(e){console.log(e)}}),$.ajax({url:"https://fast.17lai.site/libs/waline/waline.min.js",dataType:"script",cache:!0,success:function(){initWaline()}})}catch(e){console.log("[SHARE][Error] JQuery is not defined.")}}var runningOnBrowser="undefined"!=typeof window,isBot=runningOnBrowser&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;setTimeout((function(){if(!isBot&&supportsIntersectionObserver){var e=new IntersectionObserver((function(n){n[0].isIntersecting&&(loadWaline(),e.disconnect())}),{threshold:[0]});e.observe(document.getElementById("comments"))}else loadWaline()}),1)</script><script>AOS.refresh(),progressBarInit()</script><script type="text/javascript">postTimeliness(),inPageScroll()</script><script>var tocSchemaStorageKey=window.location.pathname.replace(/\/$/,"")+"/toc";function setLS(t,e){try{localStorage.setItem(t,e)}catch(t){}}function getLS(t){try{return localStorage.getItem(t)}catch(t){return null}}getLS(tocSchemaStorageKey)||setLS(tocSchemaStorageKey,"show")</script><script src="https://fast.17lai.site/libs/tocbot/tocbot.min.js"></script><script>$((function(){if($(window).width()<800)return!0;document.documentElement;var e=jQuery("#toc-aside .toc-widget");if(0===e.length||!window.tocbot)return;var t=jQuery("#headNav").height()+10,o=window.location.pathname.replace(/\/$/,"")+"/toc",s=getLS(o);let l=$("#toc-aside"),n=$("#main-content");function i(e){return"show"===s?(console.log("Current page toc: show"),!0):"hide"===s?(console.log("Current page toc: hide"),!1):void console.log("Current page toc: unknow, use default")}var a=e[0].getElementsByClassName("is-active-li");e[0].getElementsByClassName("toc-title");function c(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-t,scrollSmoothOffset:-t,collapseDepth:Number("0"),scrollSmooth:!0,headingSelector:"h2, h3, h4, h5, h6"}),e.find(".toc-list-item").length>0&&e.css("visibility","visible")}window.onscroll=()=>{e.length>0&&(a.length>0&&a[0].offsetTop>e[0].offsetHeight&&(e[0].scrollTop=a[0].offsetTop-e[0].offsetHeight/2),a.length>0&&e[0].offsetHeight>a[0].offsetHeight&&(e[0].scrollTop=0),a.length>0&&a[0].offsetTop>e[0].offsetHeight&&(e[0].scrollTop=a[0].offsetTop-e[0].offsetHeight/2))},getLS(o),("show"===s?(console.log("Current page toc: show"),l.addClass("expanded").show(),n.addClass("l9"),1):"hide"===s?(console.log("Current page toc: hide"),l.removeClass("expanded").hide(),n.removeClass("l9"),0):void console.log("Current page toc: unknow, use default"))&&c();let d=parseInt(.6*$(window).height()-64),r=$("#toc-aside .toc-widget");$(window).scroll((function(){$(window).scrollTop()>d?r.addClass("toc-fixed"):r.removeClass("toc-fixed")}));let h=function(e,t){let o=$("#"+e);if(0===o.length)return;let s=o.width();s+=s>=450?21:s>=350&&s<450?18:s>=300&&s<350?16:14,$("#"+t).width(s)};h("artDetail","prenext-posts"),$("#floating-toc-btn .btn-floating").click((function(){l.hasClass("expanded")?(l.removeClass("expanded").hide(),n.removeClass("l9"),i(getLS(o))||tocbot.destroy(),setLS(o,"hide")):(i(getLS(o))||c(),setLS(o,"show"),l.addClass("expanded").show(),n.addClass("l9")),h("artDetail","prenext-posts"),AOS.refresh(),progressBarInit()}))}))</script><script>$("#articleContent").on("copy",(function(e){if(void 0!==window.getSelection){var n=window.getSelection();if(!((""+n).length<Number.parseInt("120"))){var t=document.getElementsByTagName("body")[0],o=document.createElement("div");o.style.position="absolute",o.style.left="-99999px",t.appendChild(o),o.appendChild(n.getRangeAt(0).cloneContents()),"PRE"!==n.getRangeAt(0).commonAncestorContainer.nodeName&&"CODE"!==n.getRangeAt(0).commonAncestorContainer.nodeName||(o.innerHTML="<pre>"+o.innerHTML+"</pre>");var i=document.location.href;o.innerHTML+='<br />来源: 夜法之书<br />文章作者: 夜法之书<br />文章链接: <a href="'+i+'">'+i+"</a><br />本文章著作权归作者所有，任何形式的转载都请注明出处。",n.selectAllChildren(o),window.setTimeout((function(){t.removeChild(o)}),200)}}}))</script><script>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",(function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})}))</script><script>function loadShare(){try{jQuery.ajax({url:"https://fast.17lai.site/libs/share/js/social-share.min.js",dataType:"script",cache:!0,success:function(){}})}catch(e){console.log("[SHARE][Error] JQuery is not defined.")}}var runningOnBrowser="undefined"!=typeof window,isBot=runningOnBrowser&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;setTimeout((function(){if(!isBot&&supportsIntersectionObserver){var e=new IntersectionObserver((function(n){n[0].isIntersecting&&(loadShare(),e.disconnect())}),{threshold:[0]});e.observe(document.getElementById("article-share"))}else loadShare()}),1)</script><script type="text/javascript">progressBarInit()</script><script type="text/javascript" async>for(const t of document.querySelectorAll("[data-lazy-src]"))Matery.utils.waitElementVisible(t,(function(){var e=t.dataset.lazySrc;t.removeAttribute("data-lazy-src");var o=new Image;o.onload=function(){t.classList.add("is-loaded"),t.style.backgroundImage="url("+e+")"},o.src=e}),CONFIG.lazyload.offset_factor);for(const t of document.querySelectorAll("[bg-lazy]"))Matery.utils.waitElementVisible(t,(function(){t.removeAttribute("bg-lazy")}),CONFIG.lazyload.offset_factor);for(const t of document.querySelectorAll("img[lazyload]:not([no-lazy])"))Matery.utils.waitElementVisible(t,(function(){t.setAttribute("srcset",t.getAttribute("src")),t.onload=function(){t.removeAttribute("lazyload")}}),CONFIG.lazyload.offset_factor)</script><script type="text/javascript" defer src="https://fast.17lai.site/libs/others/snowflake.js"></script><script async src="https://fast.17lai.site/libs/others/bsz.pure.mini.min.js"></script><script defer src="https://fast.17lai.site/libs/prism/components/prism-core.min.js"></script><script defer src="https://fast.17lai.site/libs/prism/plugins/autoloader/prism-autoloader.min.js"></script><script defer src="https://fast.17lai.site/libs/prism/plugins/line-numbers/prism-line-numbers.min.js"></script><script>Matery.plugins.codeWidget()</script><script>Matery.utils.createScript("https://fast.17lai.site/libs/anchor/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var a of n)o.push(".markdown-body #articleContent > "+a.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Matery.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var a of n)o.push(".markdown-body #articleContent > "+a.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script src="https://fast.17lai.site/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript><script src="https://cdn.jsdelivr.net/npm/hexo-tag-common-new@0.2.4/js/index.js"></script><script>(function (w, d, s, id) {
            if (typeof (w.webpushr) !== 'undefined') return; w.webpushr = w.webpushr || function () { (w.webpushr.q = w.webpushr.q || []).push(arguments) }; var js, fjs = d.getElementsByTagName(s)[0]; js = d.createElement(s); js.id = id; js.async = 1; js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window, document, 'script', 'webpushr-jssdk'));webpushr('setup', { 'key': 'BDHamjevXR9yPJrttxl80MjCYEwm3CKzwsi3rwMXxq4Lnbzhr2fNQARqXJVhfBn_ucmy9QHixa3qps8eEFXBwmw' });</script></body></html>