<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.17lai.site</id>
    <title>夜法之书 • Posts by &#34;sql&#34; category</title>
    <link href="https://blog.17lai.site" />
    <updated>2025-11-22T07:57:38.000Z</updated>
    <category term="github" />
    <category term="jekyll" />
    <category term="blog" />
    <category term="embeded" />
    <category term="hisilicon" />
    <category term="linux" />
    <category term="driver" />
    <category term="3798m" />
    <category term="mpp" />
    <category term="unf" />
    <category term="kernel" />
    <category term="gitlab" />
    <category term="git" />
    <category term="crack" />
    <category term="hardlink" />
    <category term="bt" />
    <category term="pt" />
    <category term="qnap" />
    <category term="硬盘" />
    <category term="nas" />
    <category term="markdown" />
    <category term="picgo" />
    <category term="wiz" />
    <category term="joplin" />
    <category term="typora" />
    <category term="宝塔" />
    <category term="vps" />
    <category term="建站" />
    <category term="nginx" />
    <category term="apache" />
    <category term="mysql" />
    <category term="3G" />
    <category term="4G" />
    <category term="3531a" />
    <category term="移植" />
    <category term="嵌入式" />
    <category term="docker" />
    <category term="lamp" />
    <category term="php" />
    <category term="tomcat" />
    <category term="registry" />
    <category term="教程" />
    <category term="email" />
    <category term="https" />
    <category term="ssl" />
    <category term="debian" />
    <category term="laptop" />
    <category term="ed2k" />
    <category term="ati" />
    <category term="qbittorrent" />
    <category term="transmission" />
    <category term="ssd" />
    <category term="hdd" />
    <category term="pdca" />
    <category term="5w2h" />
    <category term="smart" />
    <category term="swot" />
    <category term="grow" />
    <category term="okr" />
    <category term="wbs" />
    <category term="启动" />
    <category term="tls" />
    <category term="隐私" />
    <category term="安全" />
    <category term="优化" />
    <category term="gitbook" />
    <category term="emby" />
    <category term="sonarr" />
    <category term="jeckett" />
    <category term="portainer" />
    <category term="mariadb" />
    <category term="note" />
    <category term="mermaid" />
    <category term="webdav" />
    <category term="web" />
    <category term="http" />
    <category term="hexo" />
    <category term="matery" />
    <category term="npm" />
    <category term="css" />
    <category term="js" />
    <category term="3a" />
    <category term="ae" />
    <category term="image" />
    <category term="ai" />
    <category term="face" />
    <category term="vim" />
    <category term="ide" />
    <category term="music" />
    <category term="韩红" />
    <category term="ccs" />
    <category term="thinkpad" />
    <category term="sound" />
    <category term="speaker" />
    <category term="刮削" />
    <category term="musicbrainz" />
    <category term="mp3tag" />
    <category term="tmm" />
    <category term="字幕" />
    <category term="plex" />
    <category term="cmake" />
    <category term="develop" />
    <category term="ipv6" />
    <category term="traefik" />
    <category term="proxy" />
    <category term="swarm" />
    <category term="ubuntu" />
    <category term="vscode" />
    <category term="插件" />
    <category term="编码" />
    <category term="plantuml" />
    <category term="mathjax" />
    <category term="earthly" />
    <category term="ci/cd" />
    <category term="mstream" />
    <category term="selfhost" />
    <category term="中岛美嘉" />
    <category term="node" />
    <category term="jenkins" />
    <category term="tools" />
    <category term="winrar" />
    <category term="emoji" />
    <category term="shell" />
    <category term="isp" />
    <category term="awb" />
    <category term="mywork" />
    <category term="cdn" />
    <category term="seo" />
    <category term="fitness" />
    <category term="健身" />
    <category term="运动" />
    <category term="devops" />
    <category term="k8s" />
    <category term="harbor" />
    <category term="drowio" />
    <category term="man" />
    <category term="框架" />
    <category term="图解" />
    <category term="doxygen" />
    <category term="bash" />
    <category term="中医" />
    <category term="西医" />
    <category term="文化历史" />
    <category term="管理" />
    <category term="竞品分析" />
    <category term="rss" />
    <category term="rsshub" />
    <category term="社会观察" />
    <category term="知识" />
    <category term="智慧" />
    <category term="os" />
    <category term="自制" />
    <category term="pmbok" />
    <category term="ipd" />
    <category term="绩效" />
    <category term="驱动" />
    <category term="sensor" />
    <category term="编译器" />
    <category term="C" />
    <category term="compiler" />
    <category term="nodeppt" />
    <category term="故事" />
    <category term="写作" />
    <category term="vercel" />
    <category term="potplayer" />
    <category term="action" />
    <category term="workflow" />
    <category term="概率" />
    <category term="普朗克" />
    <category term="echarts" />
    <category term="yandex" />
    <category term="source" />
    <category term="hack" />
    <category term="download" />
    <category term="chatgpt" />
    <category term="openai" />
    <category term="投资" />
    <category term="理财" />
    <category term="金融" />
    <category term="calibre" />
    <category term="douban" />
    <category term="book" />
    <category term="不可能三角" />
    <category term="waline" />
    <category term="IPD" />
    <category term="MM方法论" />
    <category term="端到端" />
    <category term="信用卡" />
    <category term="search" />
    <category term="开源" />
    <category term="定制服务器" />
    <category term="读书评鉴" />
    <category term="穿越必备" />
    <category term="易学" />
    <category term="高考" />
    <category term="专业" />
    <category term="google" />
    <category term="人性" />
    <category term="人格分析" />
    <category term="profile" />
    <category term="tampermonkey" />
    <category term="zhihu" />
    <category term="csdn" />
    <category term="juejin" />
    <category term="webhook" />
    <category term="密码" />
    <category term="bitwarden" />
    <category term="office" />
    <category term="kms" />
    <category term="破解" />
    <category term="刀郎" />
    <category term="健康" />
    <category term="恢复" />
    <category term="养生" />
    <category term="umami" />
    <category term="windows" />
    <category term="垃圾清理" />
    <category term="速度优化" />
    <category term="阳历" />
    <category term="阴历" />
    <category term="阴阳和历" />
    <category term="天干" />
    <category term="地支" />
    <category term="热水器" />
    <category term="维护" />
    <category term="汽车" />
    <category term="测速" />
    <category term="nat" />
    <category term="光猫" />
    <category term="ipfs" />
    <category term="zlibrary" />
    <category term="sql" />
    <category term="postgresql" />
    <category term="sqlite" />
    <category term="dns" />
    <category term="smartdns" />
    <category term="dnsmasq" />
    <category term="study" />
    <category term="english" />
    <category term="雅思" />
    <entry>
        <id>https://blog.17lai.site/posts/a416ccaa/</id>
        <title>PostgreSQL 实现原理深度剖析：高性能数据库引擎的核心机制</title>
        <link rel="alternate" href="https://blog.17lai.site/posts/a416ccaa/"/>
        <content type="html">&lt;blockquote&gt;
&lt;p&gt;PostgreSQL 作为&lt;strong&gt;最先进的开源关系数据库系统&lt;/strong&gt;，其内部实现原理体现了数据库领域的前沿设计与工程智慧。本文将深入探讨 PostgreSQL 的架构设计、存储机制、并发控制和优化器原理，并通过与 MySQL 的对比展示其&lt;strong&gt;独特优势&lt;/strong&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;视频&lt;/strong&gt;：&lt;a href=&#34;https://alist.17lai.site/%E5%A4%9A%E5%AA%92%E4%BD%93/Video/%E6%95%99%E7%A8%8B/%E5%85%BB%E6%B4%BB%E5%9B%BD%E5%86%85%E5%A4%A7%E5%8D%8A%E8%87%AA%E7%A0%94%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9B%A2%E9%98%9F%E7%9A%84PostgreSQL%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F.mp4&#34;&gt;养活国内大半自研数据库团队的PostgreSQL是什么？&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;h2 id=&#34;I-PostgreSQL-整体架构&#34;&gt;I. PostgreSQL 整体架构&lt;/h2&gt;
&lt;p&gt;PostgreSQL 采用&lt;strong&gt;多进程架构 (Process-based)&lt;/strong&gt;，每个客户端连接对应一个独立的服务进程。这种设计虽然比线程模型消耗更多内存，但提供了极高的隔离性和稳定性——一个查询的崩溃绝不会拖垮整个数据库。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;graph TD
    Client[客户端应用] --&amp;gt;|TCP&amp;#x2F;IP| Postmaster[Postmaster 主守护进程]
    
    subgraph &amp;quot;进程模型&amp;quot;
        Postmaster --&amp;gt;|fork| Backend1[服务进程 1: Backend]
        Postmaster --&amp;gt;|fork| Backend2[服务进程 2: Backend]
        Postmaster --&amp;gt;|fork| Backend3[服务进程 3: Backend]
    end

    subgraph &amp;quot;共享内存区域&amp;quot;
        SharedBuffer[Shared Buffer&amp;lt;br&amp;#x2F;&amp;gt;共享缓冲区]
        WALBuffer[WAL Buffer&amp;lt;br&amp;#x2F;&amp;gt;日志缓冲区]
        
        Backend1 &amp;lt;--&amp;gt; SharedBuffer
        Backend2 &amp;lt;--&amp;gt; SharedBuffer
        Backend3 &amp;lt;--&amp;gt; SharedBuffer
        SharedBuffer &amp;lt;--&amp;gt; WALBuffer
    end
    
    subgraph &amp;quot;关键后台进程&amp;quot;
        BgWriter[BgWriter&amp;lt;br&amp;#x2F;&amp;gt;后台写入器]
        Checkpointer[Checkpointer&amp;lt;br&amp;#x2F;&amp;gt;检查点进程]
        WALWriter[WAL Writer&amp;lt;br&amp;#x2F;&amp;gt;日志写入器]
        Autovacuum[Autovacuum&amp;lt;br&amp;#x2F;&amp;gt;自动清理进程]
    end
    
    SharedBuffer --&amp;gt; BgWriter
    WALBuffer --&amp;gt; WALWriter
    SharedBuffer --&amp;gt; Checkpointer
    SharedBuffer --&amp;gt; Autovacuum
    
    BgWriter --&amp;gt;|写入脏页| Storage[持久化存储&amp;lt;br&amp;#x2F;&amp;gt;数据文件]
    WALWriter --&amp;gt;|写入WAL| WALStorage[WAL文件]
    Checkpointer --&amp;gt;|检查点| Storage
    Autovacuum --&amp;gt;|清理| Storage
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;核心组件交互流程&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Postmaster&lt;/strong&gt;：主守护进程 (PID 1 of PG)，负责监听端口 (5432)、管理连接请求、恢复系统。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Server Process (Backend)&lt;/strong&gt;：每个客户端连接对应一个 &lt;code&gt;postgres&lt;/code&gt; 子进程，负责执行 SQL、排序、计算。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Shared Buffer&lt;/strong&gt;：所有进程共享的内存池，用于缓存数据页 (Page)。Postgres 依赖 OS Cache 形成双重缓存架构。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;后台进程 (Background Processes)&lt;/strong&gt;：
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;BgWriter&lt;/strong&gt;：将脏页 (Dirty Pages) 缓慢刷盘，减轻 Checkpoint 压力。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Checkpointer&lt;/strong&gt;：定期执行检查点，确保数据落盘，缩短恢复时间。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;WAL Writer&lt;/strong&gt;：将 WAL Buffer 中的日志条目刷入磁盘。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Autovacuum&lt;/strong&gt;：自动发现并清理死元组，更新统计信息。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;II-存储引擎与数据组织&#34;&gt;II. 存储引擎与数据组织&lt;/h2&gt;
&lt;p&gt;PostgreSQL 的存储层设计精妙，采用 &lt;strong&gt;堆表 (Heap Table)&lt;/strong&gt; 结构，并辅以多种辅助文件。&lt;/p&gt;
&lt;h3 id=&#34;2-1-页面与元组结构-Page-Tuple&#34;&gt;2.1 页面与元组结构 (Page &amp;amp; Tuple)&lt;/h3&gt;
&lt;p&gt;Postgres 的标准页面大小为 &lt;strong&gt;8KB&lt;/strong&gt;。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;classDiagram
    class PageHeaderData &amp;#123;
        +uint16 pd_lower (空闲空间起始)
        +uint16 pd_upper (空闲空间结束)
        +uint16 pd_special (特殊空间起始)
    &amp;#125;

    class LinePointer &amp;#123;
        +uint32 IpId (行指针: 偏移量+长度)
    &amp;#125;

    class HeapTupleData &amp;#123;
        +uint32 t_xmin (创建事务ID)
        +uint32 t_xmax (删除事务ID)
        +ItemPointerData t_ctid (物理位置)
        +uint16 t_infomask (标志位&amp;#x2F;Hint Bits)
        +data fields[] (实际数据)
    &amp;#125;

    class TablePage &amp;#123;
        PageHeaderData header
        LinePointer[] pointers
        FreeSpace 空闲空间
        HeapTupleData[] tuples
    &amp;#125;

    TablePage &amp;quot;1&amp;quot; *-- &amp;quot;1&amp;quot; PageHeaderData : 包含
    TablePage &amp;quot;1&amp;quot; *-- &amp;quot;n&amp;quot; LinePointer : 从前向后生长
    TablePage &amp;quot;1&amp;quot; *-- &amp;quot;n&amp;quot; HeapTupleData : 从后向前生长&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;关键机制&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;行指针 (ItemPointer)&lt;/strong&gt;：索引不直接指向数据行，而是指向 Page 里的行指针。这使得 Page 内部进行碎片整理（移动 Tuple）时，无需修改外部索引，只需更新行指针即可。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TOAST 机制&lt;/strong&gt;：当行大小超过页面的 1/4 (约 2KB) 时，超长字段（如 JSONB, Text）会被压缩并切片存储到专门的 TOAST 表中，主表只留一个指针。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2-2-关键辅助文件&#34;&gt;2.2 关键辅助文件&lt;/h3&gt;
&lt;p&gt;Postgres 除了主数据文件，还维护着两个至关重要的位图文件：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;FSM (Free Space Map)&lt;/strong&gt;:
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;作用&lt;/strong&gt;: 快速定位哪个页面有足够的空闲空间来插入新数据，避免全表扫描寻找空位。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;VM (Visibility Map)&lt;/strong&gt;:
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;作用&lt;/strong&gt;: 标记某个页面上的所有元组是否对“所有活跃事务”可见。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;核心优化&lt;/strong&gt;: &lt;strong&gt;Index-Only Scan&lt;/strong&gt;。如果 VM 显示页面全可见，索引扫描可以直接返回数据，&lt;strong&gt;无需回表&lt;/strong&gt; (Heap Fetch)。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;III-多版本并发控制-MVCC&#34;&gt;III. 多版本并发控制 (MVCC)&lt;/h2&gt;
&lt;p&gt;PostgreSQL 的 MVCC 通过&lt;strong&gt;保留数据旧版本&lt;/strong&gt;来实现，而不是像 MySQL (InnoDB) 那样使用 Undo Log 回滚段。&lt;/p&gt;
&lt;h3 id=&#34;3-1-元组生命周期&#34;&gt;3.1 元组生命周期&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;stateDiagram-v2
    [*] --&amp;gt; Active : INSERT (创建新行)
    Active --&amp;gt; Committed : COMMIT (事务提交)
    Active --&amp;gt; Aborted : ROLLBACK (事务回滚)
    
    Committed --&amp;gt; Updating : UPDATE (被新事务更新)
    Updating --&amp;gt; Dead : COMMIT (更新提交，旧行失效)
    
    Committed --&amp;gt; Deleting : DELETE (被新事务删除)
    Deleting --&amp;gt; Dead : COMMIT (删除提交)
    
    Dead --&amp;gt; Reusable : VACUUM (清理死元组)
    Reusable --&amp;gt; [*] : 空间重用&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;3-2-版本链与可见性&#34;&gt;3.2 版本链与可见性&lt;/h3&gt;
&lt;p&gt;当一行数据被更新时，新旧版本通过 &lt;code&gt;ctid&lt;/code&gt; 指针连接形成版本链。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;graph TB
    Query[查询事务 Snapshot&amp;lt;br&amp;#x2F;&amp;gt;Xmin&amp;#x3D;250]
    
    subgraph VersionChain [元组版本链]
        V1[&amp;quot;&amp;lt;b&amp;gt;版本 1&amp;lt;&amp;#x2F;b&amp;gt;&amp;lt;br&amp;#x2F;&amp;gt;xmin&amp;#x3D;100 (Committed)&amp;lt;br&amp;#x2F;&amp;gt;xmax&amp;#x3D;200 (Committed)&amp;quot;]
        V2[&amp;quot;&amp;lt;b&amp;gt;版本 2&amp;lt;&amp;#x2F;b&amp;gt;&amp;lt;br&amp;#x2F;&amp;gt;xmin&amp;#x3D;200 (Committed)&amp;lt;br&amp;#x2F;&amp;gt;xmax&amp;#x3D;300 (Running)&amp;quot;]
        V3[&amp;quot;&amp;lt;b&amp;gt;版本 3&amp;lt;&amp;#x2F;b&amp;gt;&amp;lt;br&amp;#x2F;&amp;gt;xmin&amp;#x3D;300 (Running)&amp;lt;br&amp;#x2F;&amp;gt;xmax&amp;#x3D;0&amp;quot;]
    end

    Query --&amp;gt; V1
    Query --&amp;gt; V2
    Query --&amp;gt; V3
    
    V1 --&amp;gt;|ctid| V2
    V2 --&amp;gt;|ctid| V3
    
    %% 添加可见性标签
    V1_Label[不可见: xmax已提交]
    V2_Label[&amp;quot;&amp;lt;b&amp;gt;可见&amp;lt;&amp;#x2F;b&amp;gt;: xmin已提交 &amp;amp; xmax未提交&amp;quot;]
    V3_Label[不可见: xmin未提交]
    
    V1 -.-&amp;gt; V1_Label
    V2 -.-&amp;gt; V2_Label  
    V3 -.-&amp;gt; V3_Label
    
    class V2 highlight
    classDef highlight fill:#d5f5e3,stroke:#2ecc71,stroke-width:2px
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;可见性规则的核心&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;xmin&lt;/code&gt; &amp;lt; 当前快照 &amp;amp;&amp;amp; (&lt;code&gt;xmax&lt;/code&gt; == 0 || &lt;code&gt;xmax&lt;/code&gt; &amp;gt; 当前快照)&lt;/li&gt;
&lt;li&gt;简而言之：&lt;strong&gt;我只能看到在我开始之前已经提交的数据，且这些数据在我开始之前没有被删除。&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;IV-查询处理与优化器&#34;&gt;IV. 查询处理与优化器&lt;/h2&gt;
&lt;p&gt;PostgreSQL 拥有极其强大的查询优化器，支持遗传算法 (GEQO) 和复杂代价模型。&lt;/p&gt;
&lt;h3 id=&#34;4-1-查询执行流水线&#34;&gt;4.1 查询执行流水线&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;sequenceDiagram
    participant Client
    participant Parser as 解析器 (Parser)
    participant Analyzer as 分析器 (Analyzer)
    participant Rewriter as 重写器 (Rewriter)
    participant Planner as 规划器 (Planner)
    participant Executor as 执行器 (Executor)
    
    Client-&amp;gt;&amp;gt;Parser: 发送 SQL 查询
    Parser-&amp;gt;&amp;gt;Analyzer: 生成原始解析树 (Parse Tree)
    Analyzer-&amp;gt;&amp;gt;Rewriter: 语义分析 &amp;amp; 生成查询树 (Query Tree)
    Rewriter-&amp;gt;&amp;gt;Planner: 应用规则 (如视图展开)
    Planner-&amp;gt;&amp;gt;Planner: 逻辑优化 &amp;amp; 物理优化
    Note right of Planner: 成本估算 (CBO)&amp;lt;br&amp;#x2F;&amp;gt;遗传算法 (GEQO)&amp;lt;br&amp;#x2F;&amp;gt;连接顺序选择
    Planner-&amp;gt;&amp;gt;Executor: 生成最优执行计划 (Plan Tree)
    Executor-&amp;gt;&amp;gt;Executor: 递归执行节点 (Scan&amp;#x2F;Join&amp;#x2F;Sort)
    Executor--&amp;gt;&amp;gt;Client: 返回结果集&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;4-2-优化器黑科技&#34;&gt;4.2 优化器黑科技&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;遗传查询优化 (GEQO)&lt;/strong&gt;: 当连接的表数量非常多（默认 &amp;gt;= 12）时，穷举所有连接顺序太慢，PG 会自动切换到遗传算法来搜索近似最优解。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JIT (即时编译)&lt;/strong&gt;: 对于复杂的大型 OLAP 查询，PG 可以利用 LLVM 将 SQL 表达式动态编译为机器码，加速执行。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;并行查询&lt;/strong&gt;: 自动利用多核 CPU 并行执行扫描、连接和聚合操作。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;V-索引机制详解&#34;&gt;V. 索引机制详解&lt;/h2&gt;
&lt;p&gt;PG 的索引是开放接口的，支持极其丰富的数据结构。&lt;/p&gt;
&lt;h3 id=&#34;5-1-B-tree-索引结构-Lehman-Yao-算法&#34;&gt;5.1 B-tree 索引结构 (Lehman &amp;amp; Yao 算法)&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;graph TD
    Root[Root Node] --&amp;gt; I1[Internal Node]
    Root --&amp;gt; I2[Internal Node]
    I1 --&amp;gt; L1[Leaf Node 1&amp;lt;br&amp;#x2F;&amp;gt;Data: 1..10]
    I1 --&amp;gt; L2[Leaf Node 2&amp;lt;br&amp;#x2F;&amp;gt;Data: 11..20]
    I2 --&amp;gt; L3[Leaf Node 3&amp;lt;br&amp;#x2F;&amp;gt;Data: 21..30]
    
    L1 -.-&amp;gt;|Right Link| L2
    L2 -.-&amp;gt;|Right Link| L3
    
    classDef leaf fill:#e8f8f5,stroke:#1abc9c
    class L1,L2,L3 leaf&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Right-Link 机制&lt;/strong&gt;: 允许读操作在节点分裂 (Split) 时无需加锁，极大提升并发性能。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;5-2-索引类型全景&#34;&gt;5.2 索引类型全景&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;索引类型&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;原理&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;杀手级应用场景&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;B-tree&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;平衡树&lt;/td&gt;
&lt;td&gt;绝大多数常规查询 (=, &amp;gt;, &amp;lt;, BETWEEN)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;GIN&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;倒排索引 (Inverted)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;JSONB&lt;/strong&gt; 包含查询、数组搜索、全文检索&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;GiST&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;通用搜索树&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;GIS 地理数据&lt;/strong&gt; (PostGIS)、几何图形重叠判断&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;SP-GiST&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;空间分区树&lt;/td&gt;
&lt;td&gt;非平衡数据集，如 URL 路由、分区数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;BRIN&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;块范围索引&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;时序数据&lt;/strong&gt;、超大数据集的日志表 (极省空间)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;VI-事务管理与-WAL&#34;&gt;VI. 事务管理与 WAL&lt;/h2&gt;
&lt;h3 id=&#34;6-1-ACID-的基石：WAL&#34;&gt;6.1 ACID 的基石：WAL&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;sequenceDiagram
    participant Tx as 事务
    participant WALBuf as WAL Buffer
    participant WALFile as 磁盘 WAL 文件
    participant SharedBuf as Shared Buffer
    participant DataFile as 磁盘数据文件

    Note over Tx, WALFile: 预写日志原则 (Write-Ahead Logging)

    Tx-&amp;gt;&amp;gt;WALBuf: 1. 写入变更日志 (XLogRecord)
    Tx-&amp;gt;&amp;gt;SharedBuf: 2. 修改内存中的数据页 (Dirty Page)
    
    Tx-&amp;gt;&amp;gt;Tx: 3. 提交事务 (COMMIT)
    Tx-&amp;gt;&amp;gt;WALBuf: 4. 写入 Commit Record
    WALBuf-&amp;gt;&amp;gt;WALFile: 5. 刷盘 (fsync&amp;#x2F;fdatasync)
    WALFile--&amp;gt;&amp;gt;Tx: 6. 提交成功确认

    Note over SharedBuf, DataFile: 此时数据页可能还没写入磁盘！
    
    loop Checkpoint &amp;#x2F; BgWriter
        SharedBuf-&amp;gt;&amp;gt;DataFile: 7. 异步将脏页写入数据文件
    end&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Full Page Write (全页写入)&lt;/strong&gt;: 在 Checkpoint 后，第一次修改页面会记录整个页面内容，防止 OS 崩溃导致的“半页写入”损坏。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;VII-扩展性与高级特性&#34;&gt;VII. 扩展性与高级特性&lt;/h2&gt;
&lt;h3 id=&#34;7-1-强大的分区表&#34;&gt;7.1 强大的分区表&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;graph TD
    Parent[主表: Sales] --&amp;gt;|Partition Key: Date| P1[分区: Sales_Jan]
    Parent --&amp;gt; P2[分区: Sales_Feb]
    Parent --&amp;gt; P3[分区: Sales_Mar]
    
    Client[查询: WHERE date&amp;#x3D;&amp;#39;Jan-01&amp;#39;] -.-&amp;gt;|Partition Pruning| P1
    Client -.-&amp;gt;|忽略| P2
    Client -.-&amp;gt;|忽略| P3&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Partition Pruning (分区剪枝)&lt;/strong&gt;: 查询优化器能自动跳过不需要扫描的分区。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;7-2-物理复制-vs-逻辑复制&#34;&gt;7.2 物理复制 vs 逻辑复制&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;graph TB
    subgraph &amp;quot;物理流复制 (HA)&amp;quot;
        P1[主库] --&amp;gt;|WAL Stream| P2[备库]
    end

    subgraph &amp;quot;逻辑复制 (ETL&amp;#x2F;微服务)&amp;quot; 
        L1[发布端] --&amp;gt;|Logical Decoding| L2[订阅端]
    end

    %% 为两个子图添加描述性文本
    P_Desc[整实例复制&amp;lt;br&amp;#x2F;&amp;gt;只读副本&amp;lt;br&amp;#x2F;&amp;gt;故障切换] 
    L_Desc[表级粒度&amp;lt;br&amp;#x2F;&amp;gt;跨版本&amp;#x2F;跨OS&amp;lt;br&amp;#x2F;&amp;gt;数据汇聚]
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;VIII-PostgreSQL-vs-MySQL-核心对比&#34;&gt;VIII. PostgreSQL vs MySQL 核心对比&lt;/h2&gt;
&lt;h3 id=&#34;8-1-功能与理念对比&#34;&gt;8.1 功能与理念对比&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;特性&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;PostgreSQL&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;MySQL (InnoDB)&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;核心差异点&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;架构&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;多进程&lt;/td&gt;
&lt;td&gt;多线程&lt;/td&gt;
&lt;td&gt;PG 隔离性强，连接开销大 (需连接池)；MySQL 连接轻量。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;MVCC&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;append-only (新旧版本共存)&lt;/td&gt;
&lt;td&gt;undo log (回滚段)&lt;/td&gt;
&lt;td&gt;PG 写不阻塞读，清理依赖 VACUUM；MySQL 空间回收由 Purge 线程自动处理。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Join 算法&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Nested Loop, Hash Join, Merge Join&lt;/td&gt;
&lt;td&gt;长期仅 Nested Loop (8.0+ 加入 Hash Join)&lt;/td&gt;
&lt;td&gt;PG 处理复杂多表关联性能极强 (OLAP 能力更优)。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;数据类型&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;JSONB (二进制+索引)&lt;/strong&gt;, GIS, 数组&lt;/td&gt;
&lt;td&gt;JSON (文本), GIS 较弱&lt;/td&gt;
&lt;td&gt;PG 是 NoSQL + SQL 的完美结合体。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;许可证&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;PostgreSQL (类 BSD)&lt;/td&gt;
&lt;td&gt;GPL&lt;/td&gt;
&lt;td&gt;PG 商业化更自由。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;8-2-选型建议图谱&#34;&gt;8.2 选型建议图谱&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;journey
    title 数据库选型决策路径
    section 业务场景分析
      简单 CRUD, 互联网高并发: 5: MySQL
      复杂 SQL, 数据分析, 报表: 5: PostgreSQL
      需要 GIS 地理信息: 5: PostgreSQL (PostGIS)
      需要 JSON 文档存储: 4: PostgreSQL (JSONB)
    section 运维考量
      DBA 人才储备充足: 5: MySQL
      需要极致的数据一致性: 5: PostgreSQL
      需要 Oracle 迁移: 4: PostgreSQL&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;总结&#34;&gt;总结&lt;/h2&gt;
&lt;p&gt;PostgreSQL 能够成为当今最流行的数据库之一，归功于其&lt;strong&gt;学院派的严谨&lt;/strong&gt;与&lt;strong&gt;工程派的实用&lt;/strong&gt;的完美结合：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;真正的 MVCC 实现&lt;/strong&gt;：提供无阻塞读取和严格的快照隔离。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;可扩展架构&lt;/strong&gt;：通过 Extension (如 PostGIS, TimescaleDB) 让数据库能力无限延伸。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;强大的优化器&lt;/strong&gt;：能够驾驭极其复杂的查询逻辑，不仅仅是简单的 Key-Value 查询。&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;专家建议&lt;/strong&gt;：如果你的业务涉及复杂的数据模型、混合负载 (HTAP) 或地理空间数据，PostgreSQL 是不二之选；如果是纯粹的高并发简单点查询 (Point Select)，MySQL 依然表现优异。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;参考-致谢&#34;&gt;参考&amp;amp;致谢&lt;/h2&gt;
&lt;h2 id=&#34;系列教程&#34;&gt;&lt;strong&gt;系列教程&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;/atom.xml&#34;&gt;&lt;i class=&#34;fas fa-rss&#34;&gt;&lt;/i&gt;全部文章RSS订阅&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;数据库系列&#34;&gt;&lt;strong&gt;数据库系列&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/posts/b2f7c564/&#34;&gt;SQL命令使用教程：从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/847851a6/&#34;&gt;SQLite使用全面教程：轻量级数据库的终极指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/a460ae99/&#34;&gt;MySQL命令行使用全面教程：从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/622f0f0f/&#34;&gt;MySQL 使用全面指南：从入门到高级实践&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/16bffe88/&#34;&gt;PostgreSQL 使用全面指南：从入门到企业级应用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/6c6f64dc/&#34;&gt;PostgreSQL命令行使用教程：掌握 psql 工具&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/a416ccaa/&#34;&gt;PostgreSQL 实现原理深度剖析：高性能数据库引擎的核心机制&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;link rel=&#34;stylesheet&#34; href=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css&#34;&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/d3@7&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-view@0.18.10&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;/css/markmap.css&#34;&gt;

&lt;script src=&#34;/js/markmap.js&#34;&gt;&lt;/script&gt;
</content>
        <category term="sql" />
        <category term="postgresql" />
        <updated>2025-11-22T07:57:38.000Z</updated>
    </entry>
    <entry>
        <id>https://blog.17lai.site/posts/16bffe88/</id>
        <title>PostgreSQL 使用全面指南：从入门到企业级应用</title>
        <link rel="alternate" href="https://blog.17lai.site/posts/16bffe88/"/>
        <content type="html">&lt;blockquote&gt;
&lt;p&gt;PostgreSQL 是世界上最先进的开源关系型数据库，以其&lt;strong&gt;强大的功能&lt;/strong&gt;、&lt;strong&gt;高度的扩展性&lt;/strong&gt;和&lt;strong&gt;严格的SQL标准兼容性&lt;/strong&gt;著称。本教程将带你从基础到高级全面掌握PostgreSQL的使用技巧，涵盖安装配置、核心操作、高级特性和性能优化等各个方面。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;hr&gt;
&lt;p&gt;&lt;img src=&#34;https://cimg1.17lai.site/data/2025/11/22/20251122170322.webp&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;一、PostgreSQL概述&#34;&gt;一、PostgreSQL概述&lt;/h2&gt;
&lt;p&gt;PostgreSQL（常简称为Postgres）是一个功能强大的开源对象关系数据库系统，具有以下核心特点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;高度符合SQL标准&lt;/strong&gt;：支持SQL:2016标准的绝大部分功能&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;可扩展性&lt;/strong&gt;：支持自定义数据类型、函数、操作符和索引方法&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ACID兼容&lt;/strong&gt;：完全支持事务处理&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;丰富的特性&lt;/strong&gt;：&lt;/li&gt;
&lt;li&gt;复杂查询&lt;/li&gt;
&lt;li&gt;外键&lt;/li&gt;
&lt;li&gt;触发器&lt;/li&gt;
&lt;li&gt;可更新的视图&lt;/li&gt;
&lt;li&gt;事务完整性&lt;/li&gt;
&lt;li&gt;多版本并发控制(MVCC)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;多语言支持&lt;/strong&gt;：PL/pgSQL、PL/Python、PL/Perl、PL/Tcl等&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;强大的扩展&lt;/strong&gt;：PostGIS（地理空间）、pgRouting（路径规划）、TimescaleDB（时序数据）等&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;graph TD
PostgreSQL --&amp;gt; 核心功能[核心功能]
PostgreSQL --&amp;gt; 扩展模块[扩展模块]

核心功能 --&amp;gt; SQL标准
核心功能 --&amp;gt; ACID事务
核心功能 --&amp;gt; MVCC
核心功能 --&amp;gt; 复杂索引

扩展模块 --&amp;gt; PostGIS
扩展模块 --&amp;gt; TimescaleDB
扩展模块 --&amp;gt; pg_partman
扩展模块 --&amp;gt; PL&amp;#x2F;Python&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;二、安装与配置&#34;&gt;二、安装与配置&lt;/h2&gt;
&lt;h3 id=&#34;不同平台安装&#34;&gt;不同平台安装&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# Ubuntu&amp;#x2F;Debian
sudo apt update
sudo apt install postgresql postgresql-contrib

# CentOS&amp;#x2F;RHEL
sudo yum install postgresql-server postgresql-contrib
sudo postgresql-setup --initdb

# macOS (Homebrew)
brew install postgresql
brew services start postgresql

# Windows
下载安装包：https:&amp;#x2F;&amp;#x2F;www.postgresql.org&amp;#x2F;download&amp;#x2F;windows&amp;#x2F;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;基本配置&#34;&gt;基本配置&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;初始化数据库集群&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo -u postgres initdb -D &amp;#x2F;var&amp;#x2F;lib&amp;#x2F;postgres&amp;#x2F;data&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;启动服务&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo systemctl start postgresql
sudo systemctl enable postgresql&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;配置访问权限&lt;/strong&gt;&lt;br&gt;
编辑 &lt;code&gt;pg_hba.conf&lt;/code&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-ini&#34; data-language=&#34;ini&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-ini&#34;&gt;# 允许本地所有连接
localallalltrust
# 允许网络连接
hostallall0.0.0.0&amp;#x2F;0md5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;strong&gt;修改监听地址&lt;/strong&gt;&lt;br&gt;
编辑 &lt;code&gt;postgresql.conf&lt;/code&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-ini&#34; data-language=&#34;ini&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-ini&#34;&gt;listen_addresses &amp;#x3D; &amp;#39;*&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;创建用户和数据库&#34;&gt;创建用户和数据库&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 连接PostgreSQL
sudo -u postgres psql

-- 创建用户
CREATE USER myuser WITH PASSWORD &amp;#39;securepassword&amp;#39;;

-- 创建数据库
CREATE DATABASE mydb OWNER myuser;

-- 授予权限
GRANT ALL PRIVILEGES ON DATABASE mydb TO myuser;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;三、数据库基础操作&#34;&gt;三、数据库基础操作&lt;/h2&gt;
&lt;h3 id=&#34;表操作&#34;&gt;表操作&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建表
CREATE TABLE employees (
id SERIAL PRIMARY KEY,
name VARCHAR(100) NOT NULL,
email VARCHAR(100) UNIQUE,
department VARCHAR(50),
salary NUMERIC(10,2),
hire_date DATE DEFAULT CURRENT_DATE,
skills TEXT[]
);

-- 修改表
ALTER TABLE employees ADD COLUMN phone VARCHAR(15);
ALTER TABLE employees ALTER COLUMN department SET NOT NULL;

-- 删除表
DROP TABLE IF EXISTS temp_employees;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;数据操作（CRUD）&#34;&gt;数据操作（CRUD）&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 插入数据
INSERT INTO employees (name, email, department, salary)
VALUES
(&amp;#39;张伟&amp;#39;, &amp;#39;zhang@company.com&amp;#39;, &amp;#39;研发部&amp;#39;, 15000),
(&amp;#39;李娜&amp;#39;, &amp;#39;li@company.com&amp;#39;, &amp;#39;市场部&amp;#39;, 12000);

-- 查询数据
SELECT * FROM employees WHERE department &amp;#x3D; &amp;#39;研发部&amp;#39; AND salary &amp;gt; 13000;

-- 更新数据
UPDATE employees SET salary &amp;#x3D; salary * 1.1 WHERE department &amp;#x3D; &amp;#39;研发部&amp;#39;;

-- 删除数据
DELETE FROM employees WHERE id &amp;#x3D; 5;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;事务管理&#34;&gt;事务管理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;BEGIN;

UPDATE accounts SET balance &amp;#x3D; balance - 100 WHERE id &amp;#x3D; 1;
UPDATE accounts SET balance &amp;#x3D; balance + 100 WHERE id &amp;#x3D; 2;

-- 提交事务
COMMIT;

-- 出错时回滚
ROLLBACK;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;四、数据类型详解&#34;&gt;四、数据类型详解&lt;/h2&gt;
&lt;p&gt;PostgreSQL提供丰富的数据类型：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;数据类型&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;数值&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;SMALLINT&lt;/code&gt;, &lt;code&gt;INTEGER&lt;/code&gt;, &lt;code&gt;BIGINT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;整数类型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;NUMERIC(precision, scale)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;精确小数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;REAL&lt;/code&gt;, &lt;code&gt;DOUBLE PRECISION&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;浮点数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;字符&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;VARCHAR(n)&lt;/code&gt;, &lt;code&gt;TEXT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;变长字符串&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CHAR(n)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;定长字符串&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;日期/时间&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;DATE&lt;/code&gt;, &lt;code&gt;TIME&lt;/code&gt;, &lt;code&gt;TIMESTAMP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;日期时间类型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;布尔&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BOOLEAN&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;true/false&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;二进制&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;BYTEA&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;二进制数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;几何&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;POINT&lt;/code&gt;, &lt;code&gt;LINE&lt;/code&gt;, &lt;code&gt;CIRCLE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;几何图形&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;网络&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;INET&lt;/code&gt;, &lt;code&gt;CIDR&lt;/code&gt;, &lt;code&gt;MACADDR&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;网络地址&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;JSON&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;JSON&lt;/code&gt;, &lt;code&gt;JSONB&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;JSON数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;数组&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;INT[]&lt;/code&gt;, &lt;code&gt;TEXT[]&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;数组类型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;范围&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;INT4RANGE&lt;/code&gt;, &lt;code&gt;TSRANGE&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;范围类型&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;JSONB示例&lt;/strong&gt;：&lt;/p&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;CREATE TABLE products (
id SERIAL PRIMARY KEY,
name VARCHAR(100),
attributes JSONB
);

INSERT INTO products (name, attributes)
VALUES (&amp;#39;Laptop&amp;#39;, &amp;#39;&amp;#123;&amp;quot;color&amp;quot;: &amp;quot;silver&amp;quot;, &amp;quot;memory&amp;quot;: &amp;quot;16GB&amp;quot;, &amp;quot;ports&amp;quot;: [&amp;quot;USB-C&amp;quot;, &amp;quot;HDMI&amp;quot;]&amp;#125;&amp;#39;);

-- 查询JSON字段
SELECT name, attributes-&amp;gt;&amp;gt;&amp;#39;color&amp;#39; AS color
FROM products
WHERE attributes @&amp;gt; &amp;#39;&amp;#123;&amp;quot;memory&amp;quot;: &amp;quot;16GB&amp;quot;&amp;#125;&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;五、高级查询技术&#34;&gt;五、高级查询技术&lt;/h2&gt;
&lt;h3 id=&#34;窗口函数&#34;&gt;窗口函数&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT
name,
department,
salary,
AVG(salary) OVER (PARTITION BY department) AS avg_dept_salary,
RANK() OVER (ORDER BY salary DESC) AS salary_rank
FROM employees;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;CTE（公共表表达式）&#34;&gt;CTE（公共表表达式）&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;WITH regional_sales AS (
SELECT region, SUM(amount) AS total_sales
FROM orders
GROUP BY region
),
top_regions AS (
SELECT region
FROM regional_sales
WHERE total_sales &amp;gt; (SELECT SUM(total_sales)&amp;#x2F;10 FROM regional_sales)
)
SELECT region, product, SUM(quantity) AS product_units
FROM orders
WHERE region IN (SELECT region FROM top_regions)
GROUP BY region, product;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;全文搜索&#34;&gt;全文搜索&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建全文搜索索引
CREATE TABLE documents (
id SERIAL PRIMARY KEY,
title TEXT,
body TEXT
);

CREATE INDEX idx_documents_search ON documents USING GIN (to_tsvector(&amp;#39;english&amp;#39;, body));

-- 执行搜索
SELECT title, ts_headline(body, q) AS highlight
FROM documents, to_tsquery(&amp;#39;english&amp;#39;, &amp;#39;database &amp;amp; performance&amp;#39;) q
WHERE to_tsvector(&amp;#39;english&amp;#39;, body) @@ q;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;六、索引与性能优化&#34;&gt;六、索引与性能优化&lt;/h2&gt;
&lt;h3 id=&#34;索引类型&#34;&gt;索引类型&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;索引类型&lt;/th&gt;
&lt;th&gt;适用场景&lt;/th&gt;
&lt;th&gt;示例&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;B-tree&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;默认索引，适用于等值查询和范围查询&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CREATE INDEX idx_name ON table (column)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Hash&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;等值查询（仅内存表）&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CREATE INDEX idx_name ON table USING HASH (column)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;GIN&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;JSONB、数组、全文搜索&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CREATE INDEX idx_gin ON table USING GIN (jsonb_column)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;GiST&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;几何数据、全文搜索&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CREATE INDEX idx_gist ON table USING GiST (geom_column)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;SP-GiST&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;空间分区数据&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CREATE INDEX idx_spgist ON table USING SP-GiST (phone)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;BRIN&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;大型表，按物理顺序存储&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CREATE INDEX idx_brin ON table USING BRIN (timestamp)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;查询优化技巧&#34;&gt;查询优化技巧&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;使用EXPLAIN分析&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;EXPLAIN ANALYZE SELECT * FROM large_table WHERE category_id &amp;#x3D; 10;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;**避免SELECT ***&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 不推荐
SELECT * FROM orders;

-- 推荐
SELECT order_id, customer_id, order_date FROM orders;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;批量操作优化&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 使用COPY导入数据
COPY large_table FROM &amp;#39;&amp;#x2F;path&amp;#x2F;to&amp;#x2F;data.csv&amp;#39; DELIMITER &amp;#39;,&amp;#39; CSV HEADER;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;strong&gt;分区表&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建分区表
CREATE TABLE sales (
id SERIAL,
sale_date DATE,
amount NUMERIC
) PARTITION BY RANGE (sale_date);

-- 创建子分区
CREATE TABLE sales_2023 PARTITION OF sales
FOR VALUES FROM (&amp;#39;2023-01-01&amp;#39;) TO (&amp;#39;2024-01-01&amp;#39;);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;七、事务与并发控制&#34;&gt;七、事务与并发控制&lt;/h2&gt;
&lt;h3 id=&#34;事务隔离级别&#34;&gt;事务隔离级别&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 查看当前隔离级别
SHOW default_transaction_isolation;

-- 设置隔离级别
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;锁机制&#34;&gt;锁机制&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 显式锁定
BEGIN;
LOCK TABLE accounts IN EXCLUSIVE MODE;
-- 执行操作
COMMIT;

-- 行级锁
SELECT * FROM orders WHERE id &amp;#x3D; 100 FOR UPDATE;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;MVCC（多版本并发控制）&#34;&gt;MVCC（多版本并发控制）&lt;/h3&gt;
&lt;p&gt;PostgreSQL使用MVCC处理并发，避免读写冲突：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;stateDiagram-v2
[*] --&amp;gt; Active
Active --&amp;gt; Committed
Active --&amp;gt; Aborted
Committed --&amp;gt; [*]
Aborted --&amp;gt; [*]&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;八、存储过程与函数&#34;&gt;八、存储过程与函数&lt;/h2&gt;
&lt;h3 id=&#34;PL-pgSQL函数&#34;&gt;PL/pgSQL函数&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;CREATE OR REPLACE FUNCTION calculate_tax(amount NUMERIC)
RETURNS NUMERIC AS $$
DECLARE
tax_rate NUMERIC :&amp;#x3D; 0.1;
tax_amount NUMERIC;
BEGIN
tax_amount :&amp;#x3D; amount * tax_rate;
RETURN tax_amount;
EXCEPTION
WHEN division_by_zero THEN
RAISE NOTICE &amp;#39;Division by zero occurred&amp;#39;;
RETURN 0;
END;
$$ LANGUAGE plpgsql;

-- 调用函数
SELECT calculate_tax(1000);-- 返回100.00&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;返回结果集&#34;&gt;返回结果集&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;CREATE OR REPLACE FUNCTION get_employees(dept_name VARCHAR)
RETURNS TABLE (id INT, name VARCHAR, salary NUMERIC) AS $$
BEGIN
RETURN QUERY
SELECT e.id, e.name, e.salary
FROM employees e
WHERE e.department &amp;#x3D; dept_name;
END;
$$ LANGUAGE plpgsql;

-- 调用
SELECT * FROM get_employees(&amp;#39;研发部&amp;#39;);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;九、触发器与规则&#34;&gt;九、触发器与规则&lt;/h2&gt;
&lt;h3 id=&#34;创建触发器&#34;&gt;创建触发器&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 审计日志表
CREATE TABLE audit_log (
id SERIAL PRIMARY KEY,
table_name VARCHAR(100),
action VARCHAR(10),
old_data JSONB,
new_data JSONB,
change_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 触发器函数
CREATE OR REPLACE FUNCTION log_employee_changes()
RETURNS TRIGGER AS $$
BEGIN
IF (TG_OP &amp;#x3D; &amp;#39;DELETE&amp;#39;) THEN
INSERT INTO audit_log (table_name, action, old_data)
VALUES (TG_TABLE_NAME, &amp;#39;DELETE&amp;#39;, to_jsonb(OLD));
ELSIF (TG_OP &amp;#x3D; &amp;#39;UPDATE&amp;#39;) THEN
INSERT INTO audit_log (table_name, action, old_data, new_data)
VALUES (TG_TABLE_NAME, &amp;#39;UPDATE&amp;#39;, to_jsonb(OLD), to_jsonb(NEW));
ELSIF (TG_OP &amp;#x3D; &amp;#39;INSERT&amp;#39;) THEN
INSERT INTO audit_log (table_name, action, new_data)
VALUES (TG_TABLE_NAME, &amp;#39;INSERT&amp;#39;, to_jsonb(NEW));
END IF;
RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- 创建触发器
CREATE TRIGGER employees_audit
AFTER INSERT OR UPDATE OR DELETE ON employees
FOR EACH ROW EXECUTE FUNCTION log_employee_changes();&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;十、备份与恢复&#34;&gt;十、备份与恢复&lt;/h2&gt;
&lt;h3 id=&#34;逻辑备份（pg-dump）&#34;&gt;逻辑备份（pg_dump）&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 备份单个数据库
pg_dump -U username -d dbname -f backup.sql

# 备份所有数据库
pg_dumpall -U postgres -f alldb.sql

# 压缩备份
pg_dump -U username -d dbname | gzip &amp;gt; backup.gz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;物理备份（PITR）&#34;&gt;物理备份（PITR）&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 开启WAL归档
# postgresql.conf中设置：
wal_level &amp;#x3D; replica
archive_mode &amp;#x3D; on
archive_command &amp;#x3D; &amp;#39;cp %p &amp;#x2F;path&amp;#x2F;to&amp;#x2F;wal_archive&amp;#x2F;%f&amp;#39;

# 创建基础备份
pg_basebackup -D &amp;#x2F;path&amp;#x2F;to&amp;#x2F;backup -U replicator -P -Fp -Xs -R&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;恢复数据库&#34;&gt;恢复数据库&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 从逻辑备份恢复
psql -U postgres -d newdb -f backup.sql

# 时间点恢复(PITR)
1. 恢复基础备份
2. 创建recovery.conf文件：
restore_command &amp;#x3D; &amp;#39;cp &amp;#x2F;path&amp;#x2F;to&amp;#x2F;wal_archive&amp;#x2F;%f %p&amp;#39;
recovery_target_time &amp;#x3D; &amp;#39;2023-05-01 12:00:00&amp;#39;
3. 启动PostgreSQL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;十一、高可用与复制&#34;&gt;十一、高可用与复制&lt;/h2&gt;
&lt;h3 id=&#34;流复制配置&#34;&gt;流复制配置&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 主库配置 (postgresql.conf)
wal_level &amp;#x3D; replica
max_wal_senders &amp;#x3D; 10
hot_standby &amp;#x3D; on

# 创建复制用户
CREATE USER replicator WITH REPLICATION ENCRYPTED PASSWORD &amp;#39;replpass&amp;#39;;

# 备库配置
pg_basebackup -h master-host -U replicator -D &amp;#x2F;var&amp;#x2F;lib&amp;#x2F;postgres&amp;#x2F;data -P -Xs -R

# 备库postgresql.auto.conf中自动生成：
primary_conninfo &amp;#x3D; &amp;#39;host&amp;#x3D;master-host user&amp;#x3D;replicator password&amp;#x3D;replpass&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;使用pgPool-II负载均衡&#34;&gt;使用pgPool-II负载均衡&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 安装pgpool-II
sudo apt install pgpool2

# 配置&amp;#x2F;etc&amp;#x2F;pgpool2&amp;#x2F;pgpool.conf
backend_hostname0 &amp;#x3D; &amp;#39;master-host&amp;#39;
backend_port0 &amp;#x3D; 5432
backend_weight0 &amp;#x3D; 1
backend_hostname1 &amp;#x3D; &amp;#39;replica1-host&amp;#39;
backend_port1 &amp;#x3D; 5432
backend_weight1 &amp;#x3D; 1

# 启动pgpool
systemctl start pgpool&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;十二、Python集成&#34;&gt;十二、Python集成&lt;/h2&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-python&#34; data-language=&#34;python&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-python&#34;&gt;import psycopg2
from psycopg2 import sql

# 连接数据库
conn &amp;#x3D; psycopg2.connect(
dbname&amp;#x3D;&amp;quot;mydb&amp;quot;,
user&amp;#x3D;&amp;quot;myuser&amp;quot;,
password&amp;#x3D;&amp;quot;mypassword&amp;quot;,
host&amp;#x3D;&amp;quot;localhost&amp;quot;,
port&amp;#x3D;&amp;quot;5432&amp;quot;
)

try:
# 创建游标
with conn.cursor() as cursor:
# 执行查询
cursor.execute(&amp;quot;SELECT * FROM employees WHERE department &amp;#x3D; %s&amp;quot;, (&amp;#39;研发部&amp;#39;,))
for record in cursor.fetchall():
print(f&amp;quot;ID: &amp;#123;record[0]&amp;#125;, Name: &amp;#123;record[1]&amp;#125;, Salary: &amp;#123;record[4]&amp;#125;&amp;quot;)

# 插入数据
insert_query &amp;#x3D; sql.SQL(&amp;quot;&amp;quot;&amp;quot;
INSERT INTO employees (name, email, department, salary)
VALUES (%s, %s, %s, %s)
RETURNING id
&amp;quot;&amp;quot;&amp;quot;)
cursor.execute(insert_query, (&amp;#39;王芳&amp;#39;, &amp;#39;wang@company.com&amp;#39;, &amp;#39;市场部&amp;#39;, 13000))
new_id &amp;#x3D; cursor.fetchone()[0]
print(f&amp;quot;New employee ID: &amp;#123;new_id&amp;#125;&amp;quot;)

# 提交事务
conn.commit()

except Exception as e:
print(f&amp;quot;Database error: &amp;#123;e&amp;#125;&amp;quot;)
conn.rollback()

finally:
# 关闭连接
if conn:
conn.close()&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;十三、学习资源&#34;&gt;十三、学习资源&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/&#34;&gt;官方文档&lt;/a&gt; - 最权威的参考资料&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://pgexercises.com/&#34;&gt;PGExercises&lt;/a&gt; - PostgreSQL交互式练习平台&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.postgresqltutorial.com/&#34;&gt;PostgreSQL Tutorial&lt;/a&gt; - 免费教程网站&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.pgadmin.org/&#34;&gt;pgAdmin&lt;/a&gt; - 官方图形化管理工具&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://postgresweekly.com/&#34;&gt;PostgreSQL Weekly&lt;/a&gt; - 每周更新资讯&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;graph LR
A[学习基础SQL] --&amp;gt; B[掌握PostgreSQL特性]
B --&amp;gt; C[性能优化]
C --&amp;gt; D[高可用架构]
D --&amp;gt; E[扩展开发]
E --&amp;gt; F[成为PostgreSQL专家]&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;PostgreSQL作为功能最强大的开源数据库，适用于从嵌入式系统到企业级应用的各种场景。通过本教程，你已经掌握了其核心功能和高级技巧，建议结合实际项目深入实践。记住：&lt;strong&gt;正确的数据库设计比后期优化更重要&lt;/strong&gt;！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;参考-致谢&#34;&gt;参考&amp;amp;致谢&lt;/h2&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css&#34;&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/d3@7&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-view@0.18.10&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;/css/markmap.css&#34;&gt;

&lt;script src=&#34;/js/markmap.js&#34;&gt;&lt;/script&gt;
</content>
        <category term="sql" />
        <category term="postgresql" />
        <updated>2025-11-22T07:36:06.000Z</updated>
    </entry>
    <entry>
        <id>https://blog.17lai.site/posts/622f0f0f/</id>
        <title>MySQL 使用全面指南：从入门到高级实践</title>
        <link rel="alternate" href="https://blog.17lai.site/posts/622f0f0f/"/>
        <content type="html">&lt;blockquote&gt;
&lt;p&gt;MySQL 是全球最流行的开源关系型数据库管理系统，广泛应用于 Web 应用开发。本教程将全面介绍 MySQL 的安装配置、核心操作、高级功能及最佳实践。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;h2 id=&#34;📦-一、MySQL-安装与配置&#34;&gt;📦 一、MySQL 安装与配置&lt;/h2&gt;
&lt;h3 id=&#34;安装-MySQL&#34;&gt;安装 MySQL&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# Ubuntu&amp;#x2F;Debian
sudo apt update
sudo apt install mysql-server

# CentOS&amp;#x2F;RHEL
sudo yum install mysql-server

# macOS (Homebrew)
brew install mysql

# Windows
下载官方安装包：https:&amp;#x2F;&amp;#x2F;dev.mysql.com&amp;#x2F;downloads&amp;#x2F;mysql&amp;#x2F;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;初始配置&#34;&gt;初始配置&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 安全配置向导（设置root密码等）
sudo mysql_secure_installation

# 启动&amp;#x2F;停止服务
sudo systemctl start mysql
sudo systemctl stop mysql

# 设置开机启动
sudo systemctl enable mysql&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;配置文件详解（my-cnf）&#34;&gt;配置文件详解（my.cnf）&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-ini&#34; data-language=&#34;ini&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-ini&#34;&gt;[mysqld]
# 数据存储目录
datadir&amp;#x3D;&amp;#x2F;var&amp;#x2F;lib&amp;#x2F;mysql

# 允许最大连接数
max_connections&amp;#x3D;200

# 查询缓存大小
query_cache_size&amp;#x3D;128M

# 字符集设置
character-set-server&amp;#x3D;utf8mb4
collation-server&amp;#x3D;utf8mb4_unicode_ci

# InnoDB 缓冲池大小 (推荐70-80%内存)
innodb_buffer_pool_size&amp;#x3D;1G

# 错误日志路径
log-error&amp;#x3D;&amp;#x2F;var&amp;#x2F;log&amp;#x2F;mysql&amp;#x2F;error.log&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🔌-二、MySQL-基础操作&#34;&gt;🔌 二、MySQL 基础操作&lt;/h2&gt;
&lt;h3 id=&#34;连接-MySQL&#34;&gt;连接 MySQL&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 本地连接
mysql -u root -p

# 远程连接
mysql -h 192.168.1.100 -P 3306 -u username -p&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;数据库操作&#34;&gt;数据库操作&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建数据库
CREATE DATABASE company_db;

-- 查看所有数据库
SHOW DATABASES;

-- 选择数据库
USE company_db;

-- 删除数据库
DROP DATABASE legacy_db;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;表操作&#34;&gt;表操作&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建员工表
CREATE TABLE employees (
id INT AUTO_INCREMENT PRIMARY KEY,
name VARCHAR(50) NOT NULL,
email VARCHAR(100) UNIQUE,
department VARCHAR(50),
salary DECIMAL(10,2),
hire_date DATE DEFAULT (CURRENT_DATE)
);

-- 查看表结构
DESCRIBE employees;

-- 修改表结构
ALTER TABLE employees ADD COLUMN phone VARCHAR(15);
ALTER TABLE employees MODIFY COLUMN salary FLOAT;

-- 删除表
DROP TABLE temp_table;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;📊-三、数据操作（CRUD）&#34;&gt;📊 三、数据操作（CRUD）&lt;/h2&gt;
&lt;h3 id=&#34;插入数据&#34;&gt;插入数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 单条插入
INSERT INTO employees (name, email, department, salary)
VALUES (&amp;#39;张三&amp;#39;, &amp;#39;zhang@company.com&amp;#39;, &amp;#39;技术部&amp;#39;, 15000);

-- 批量插入
INSERT INTO employees (name, email, department, salary) VALUES
(&amp;#39;李四&amp;#39;, &amp;#39;li@company.com&amp;#39;, &amp;#39;市场部&amp;#39;, 12000),
(&amp;#39;王五&amp;#39;, &amp;#39;wang@company.com&amp;#39;, &amp;#39;财务部&amp;#39;, 13000),
(&amp;#39;赵六&amp;#39;, &amp;#39;zhao@company.com&amp;#39;, &amp;#39;技术部&amp;#39;, 16000);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;查询数据&#34;&gt;查询数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 基本查询
SELECT * FROM employees;

-- 条件查询
SELECT name, salary
FROM employees
WHERE department &amp;#x3D; &amp;#39;技术部&amp;#39; AND salary &amp;gt; 14000;

-- 排序与分页
SELECT * FROM employees
ORDER BY hire_date DESC
LIMIT 5 OFFSET 0;

-- 模糊查询
SELECT * FROM employees
WHERE name LIKE &amp;#39;张%&amp;#39; OR email LIKE &amp;#39;%@company.com&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;更新数据&#34;&gt;更新数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 更新单条记录
UPDATE employees
SET salary &amp;#x3D; salary * 1.1
WHERE id &amp;#x3D; 1;

-- 批量更新
UPDATE employees
SET department &amp;#x3D; &amp;#39;研发部&amp;#39;
WHERE department &amp;#x3D; &amp;#39;技术部&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;删除数据&#34;&gt;删除数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 删除单条记录
DELETE FROM employees
WHERE id &amp;#x3D; 5;

-- 清空表数据
TRUNCATE TABLE temp_employees;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🔗-四、高级查询技巧&#34;&gt;🔗 四、高级查询技巧&lt;/h2&gt;
&lt;h3 id=&#34;多表连接&#34;&gt;多表连接&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建部门表
CREATE TABLE departments (
id INT AUTO_INCREMENT PRIMARY KEY,
name VARCHAR(50) NOT NULL,
location VARCHAR(100)
);

-- 内连接
SELECT e.name, e.salary, d.name AS dept_name
FROM employees e
INNER JOIN departments d ON e.department_id &amp;#x3D; d.id;

-- 左连接
SELECT e.name, d.name AS dept_name
FROM employees e
LEFT JOIN departments d ON e.department_id &amp;#x3D; d.id;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;聚合函数&#34;&gt;聚合函数&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 基本聚合
SELECT
COUNT(*) AS total_employees,
AVG(salary) AS avg_salary,
MAX(salary) AS max_salary,
MIN(hire_date) AS oldest_hire
FROM employees;

-- 分组统计
SELECT
department,
COUNT(*) AS employee_count,
AVG(salary) AS avg_salary
FROM employees
GROUP BY department
HAVING COUNT(*) &amp;gt; 3;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;子查询&#34;&gt;子查询&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 单行子查询
SELECT name, salary
FROM employees
WHERE salary &amp;gt; (SELECT AVG(salary) FROM employees);

-- IN子查询
SELECT name
FROM employees
WHERE department_id IN (
SELECT id
FROM departments
WHERE location &amp;#x3D; &amp;#39;北京&amp;#39;
);

-- EXISTS子查询
SELECT d.name
FROM departments d
WHERE EXISTS (
SELECT 1
FROM employees e
WHERE e.department_id &amp;#x3D; d.id
);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;⚡-五、索引与性能优化&#34;&gt;⚡ 五、索引与性能优化&lt;/h2&gt;
&lt;h3 id=&#34;索引类型&#34;&gt;索引类型&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建普通索引
CREATE INDEX idx_email ON employees(email);

-- 创建唯一索引
CREATE UNIQUE INDEX uidx_email ON employees(email);

-- 创建复合索引
CREATE INDEX idx_dept_salary ON employees(department, salary);

-- 查看索引
SHOW INDEX FROM employees;

-- 删除索引
DROP INDEX idx_email ON employees;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;查询优化技巧&#34;&gt;查询优化技巧&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 使用EXPLAIN分析查询
EXPLAIN SELECT * FROM employees WHERE department &amp;#x3D; &amp;#39;技术部&amp;#39;;

-- 避免SELECT *
SELECT id, name, department FROM employees;

-- 合理使用LIMIT
SELECT * FROM large_table LIMIT 100;

-- 避免在WHERE子句中使用函数
-- 不推荐
SELECT * FROM employees WHERE YEAR(hire_date) &amp;#x3D; 2023;
-- 推荐
SELECT * FROM employees
WHERE hire_date BETWEEN &amp;#39;2023-01-01&amp;#39; AND &amp;#39;2023-12-31&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;👥-六、用户与权限管理&#34;&gt;👥 六、用户与权限管理&lt;/h2&gt;
&lt;h3 id=&#34;用户管理&#34;&gt;用户管理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建用户
CREATE USER &amp;#39;dev_user&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;secure_password&amp;#39;;

-- 修改密码
ALTER USER &amp;#39;dev_user&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;new_password&amp;#39;;

-- 删除用户
DROP USER &amp;#39;old_user&amp;#39;@&amp;#39;%&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;权限管理&#34;&gt;权限管理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 授予权限
GRANT SELECT, INSERT, UPDATE ON company_db.* TO &amp;#39;dev_user&amp;#39;@&amp;#39;localhost&amp;#39;;

-- 授予所有权限
GRANT ALL PRIVILEGES ON *.* TO &amp;#39;admin&amp;#39;@&amp;#39;%&amp;#39; WITH GRANT OPTION;

-- 查看权限
SHOW GRANTS FOR &amp;#39;dev_user&amp;#39;@&amp;#39;localhost&amp;#39;;

-- 撤销权限
REVOKE DELETE ON company_db.* FROM &amp;#39;dev_user&amp;#39;@&amp;#39;localhost&amp;#39;;

-- 刷新权限
FLUSH PRIVILEGES;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;💾-七、备份与恢复&#34;&gt;💾 七、备份与恢复&lt;/h2&gt;
&lt;h3 id=&#34;备份数据库&#34;&gt;备份数据库&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 备份单个数据库
mysqldump -u root -p company_db &amp;gt; company_db_backup.sql

# 备份所有数据库
mysqldump -u root -p --all-databases &amp;gt; all_dbs_backup.sql

# 压缩备份
mysqldump -u root -p company_db | gzip &amp;gt; company_db_backup.sql.gz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;恢复数据库&#34;&gt;恢复数据库&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 恢复数据库
mysql -u root -p company_db &amp;lt; company_db_backup.sql

# 从压缩文件恢复
gunzip &amp;lt; company_db_backup.sql.gz | mysql -u root -p company_db

# 单表恢复
mysql -u root -p company_db employees &amp;lt; employees_backup.sql&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;定时备份（Cron-Job）&#34;&gt;定时备份（Cron Job）&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 添加定时任务
crontab -e

# 每天凌晨2点备份
0 2 * * * &amp;#x2F;usr&amp;#x2F;bin&amp;#x2F;mysqldump -u root -pPASSWORD company_db | gzip &amp;gt; &amp;#x2F;backups&amp;#x2F;company_db_$(date +\%F).sql.gz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🔄-八、事务与锁机制&#34;&gt;🔄 八、事务与锁机制&lt;/h2&gt;
&lt;h3 id=&#34;事务处理&#34;&gt;事务处理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 开始事务
START TRANSACTION;

-- 执行操作
UPDATE accounts SET balance &amp;#x3D; balance - 100 WHERE id &amp;#x3D; 1;
UPDATE accounts SET balance &amp;#x3D; balance + 100 WHERE id &amp;#x3D; 2;

-- 提交事务
COMMIT;

-- 回滚事务
ROLLBACK;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;事务隔离级别&#34;&gt;事务隔离级别&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 查看当前隔离级别
SELECT @@transaction_isolation;

-- 设置隔离级别
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;锁机制&#34;&gt;锁机制&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 手动加锁
SELECT * FROM orders WHERE id &amp;#x3D; 100 FOR UPDATE;

-- 查看当前锁
SHOW OPEN TABLES WHERE In_use &amp;gt; 0;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🧩-九、存储过程与函数&#34;&gt;🧩 九、存储过程与函数&lt;/h2&gt;
&lt;h3 id=&#34;创建存储过程&#34;&gt;创建存储过程&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;DELIMITER &amp;#x2F;&amp;#x2F;

CREATE PROCEDURE IncreaseSalaries(IN dept_name VARCHAR(50), IN increase_percent FLOAT)
BEGIN
UPDATE employees
SET salary &amp;#x3D; salary * (1 + increase_percent&amp;#x2F;100)
WHERE department &amp;#x3D; dept_name;
END &amp;#x2F;&amp;#x2F;

DELIMITER ;

-- 调用存储过程
CALL IncreaseSalaries(&amp;#39;技术部&amp;#39;, 10);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;创建函数&#34;&gt;创建函数&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;DELIMITER &amp;#x2F;&amp;#x2F;

CREATE FUNCTION GetEmployeeCount(dept_name VARCHAR(50))
RETURNS INT
DETERMINISTIC
BEGIN
DECLARE emp_count INT;
SELECT COUNT(*) INTO emp_count
FROM employees
WHERE department &amp;#x3D; dept_name;
RETURN emp_count;
END &amp;#x2F;&amp;#x2F;

DELIMITER ;

-- 使用函数
SELECT GetEmployeeCount(&amp;#39;市场部&amp;#39;);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;⏰-十、触发器与事件调度&#34;&gt;⏰ 十、触发器与事件调度&lt;/h2&gt;
&lt;h3 id=&#34;创建触发器&#34;&gt;创建触发器&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 审计日志表
CREATE TABLE audit_log (
id INT AUTO_INCREMENT PRIMARY KEY,
action VARCHAR(20),
table_name VARCHAR(50),
record_id INT,
change_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 创建触发器
DELIMITER &amp;#x2F;&amp;#x2F;

CREATE TRIGGER after_employee_update
AFTER UPDATE ON employees
FOR EACH ROW
BEGIN
INSERT INTO audit_log (action, table_name, record_id)
VALUES (&amp;#39;UPDATE&amp;#39;, &amp;#39;employees&amp;#39;, NEW.id);
END &amp;#x2F;&amp;#x2F;

DELIMITER ;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;事件调度&#34;&gt;事件调度&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 启用事件调度器
SET GLOBAL event_scheduler &amp;#x3D; ON;

-- 创建定期清理事件
CREATE EVENT daily_audit_cleanup
ON SCHEDULE EVERY 1 DAY
STARTS CURRENT_TIMESTAMP
DO
DELETE FROM audit_log WHERE change_time &amp;lt; NOW() - INTERVAL 30 DAY;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🐍-十一、Python-中使用-MySQL&#34;&gt;🐍 十一、Python 中使用 MySQL&lt;/h2&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-python&#34; data-language=&#34;python&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-python&#34;&gt;import mysql.connector
from mysql.connector import Error

try:
# 创建连接
connection &amp;#x3D; mysql.connector.connect(
host&amp;#x3D;&amp;#39;localhost&amp;#39;,
user&amp;#x3D;&amp;#39;python_user&amp;#39;,
password&amp;#x3D;&amp;#39;secure_pass&amp;#39;,
database&amp;#x3D;&amp;#39;company_db&amp;#39;
)

if connection.is_connected():
cursor &amp;#x3D; connection.cursor()

# 执行查询
cursor.execute(&amp;quot;SELECT * FROM employees&amp;quot;)
employees &amp;#x3D; cursor.fetchall()

# 插入数据
insert_query &amp;#x3D; &amp;quot;&amp;quot;&amp;quot;
INSERT INTO employees (name, email, department, salary)
VALUES (%s, %s, %s, %s)
&amp;quot;&amp;quot;&amp;quot;
employee_data &amp;#x3D; (&amp;#39;钱七&amp;#39;, &amp;#39;qian@company.com&amp;#39;, &amp;#39;人事部&amp;#39;, 11000)
cursor.execute(insert_query, employee_data)
connection.commit()

# 更新数据
update_query &amp;#x3D; &amp;quot;UPDATE employees SET salary &amp;#x3D; salary * 1.05 WHERE department &amp;#x3D; %s&amp;quot;
cursor.execute(update_query, (&amp;#39;技术部&amp;#39;,))
connection.commit()

except Error as e:
print(&amp;quot;数据库错误:&amp;quot;, e)

finally:
if connection.is_connected():
cursor.close()
connection.close()&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🚨-十二、常见问题解决&#34;&gt;🚨 十二、常见问题解决&lt;/h2&gt;
&lt;h3 id=&#34;忘记-root-密码&#34;&gt;忘记 root 密码&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 停止MySQL服务
sudo systemctl stop mysql

# 启动安全模式
sudo mysqld_safe --skip-grant-tables &amp;amp;

# 登录并修改密码
mysql -u root
FLUSH PRIVILEGES;
ALTER USER &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;new_password&amp;#39;;
FLUSH PRIVILEGES;
exit;

# 重启MySQL
sudo systemctl restart mysql&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;性能问题诊断&#34;&gt;性能问题诊断&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 查看慢查询
SHOW VARIABLES LIKE &amp;#39;slow_query_log&amp;#39;;
SHOW VARIABLES LIKE &amp;#39;long_query_time&amp;#39;;

-- 查看进程列表
SHOW PROCESSLIST;

-- 优化表
OPTIMIZE TABLE large_table;

-- 分析表
ANALYZE TABLE employees;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;连接问题排查&#34;&gt;连接问题排查&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 错误：ERROR 1045 (28000)
# 解决方案：检查用户名&amp;#x2F;密码，确保主机权限

# 错误：ERROR 2002 (HY000)
# 解决方案：确认MySQL服务运行中，检查socket路径

# 错误：ERROR 2013 (HY000)
# 解决方案：增加连接超时时间 wait_timeout&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;📚-学习资源推荐&#34;&gt;📚 学习资源推荐&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://dev.mysql.com/doc/&#34;&gt;MySQL 官方文档&lt;/a&gt; - 最权威的参考资料&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.mysqltutorial.org/&#34;&gt;MySQL Tutorial&lt;/a&gt; - 免费教程网站&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://leetcode.com/problemset/database/&#34;&gt;LeetCode 数据库题库&lt;/a&gt; - 实战练习&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.mysql.com/products/workbench/&#34;&gt;MySQL Workbench&lt;/a&gt; - 官方图形化管理工具&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.percona.com/software/database-tools/percona-toolkit&#34;&gt;Percona Toolkit&lt;/a&gt; - 高级管理工具集&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;graph TD
A[安装MySQL] --&amp;gt; B[创建数据库]
B --&amp;gt; C[设计表结构]
C --&amp;gt; D[数据操作CRUD]
D --&amp;gt; E[高级查询]
E --&amp;gt; F[性能优化]
F --&amp;gt; G[备份恢复]
G --&amp;gt; H[事务管理]
H --&amp;gt; I[程序集成]&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;MySQL 作为最流行的关系型数据库之一，掌握其核心功能对开发者和DBA至关重要。本教程覆盖了从基础到高级的全面知识体系，建议结合实际项目实践加深理解。记住，数据库设计优化往往比硬件升级更能提升性能！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;参考-致谢&#34;&gt;参考&amp;amp;致谢&lt;/h2&gt;
&lt;h2 id=&#34;系列教程&#34;&gt;&lt;strong&gt;系列教程&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;/atom.xml&#34;&gt;&lt;i class=&#34;fas fa-rss&#34;&gt;&lt;/i&gt;全部文章RSS订阅&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;数据库系列&#34;&gt;&lt;strong&gt;数据库系列&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/posts/b2f7c564/&#34;&gt;SQL命令使用教程：从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/847851a6/&#34;&gt;SQLite使用全面教程：轻量级数据库的终极指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/a460ae99/&#34;&gt;MySQL命令行使用全面教程：从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/622f0f0f/&#34;&gt;MySQL 使用全面指南：从入门到高级实践&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/16bffe88/&#34;&gt;PostgreSQL 使用全面指南：从入门到企业级应用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/6c6f64dc/&#34;&gt;PostgreSQL命令行使用教程：掌握 psql 工具&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/a416ccaa/&#34;&gt;PostgreSQL 实现原理深度剖析：高性能数据库引擎的核心机制&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;link rel=&#34;stylesheet&#34; href=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css&#34;&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/d3@7&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-view@0.18.10&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;/css/markmap.css&#34;&gt;

&lt;script src=&#34;/js/markmap.js&#34;&gt;&lt;/script&gt;
</content>
        <category term="mysql" />
        <category term="sql" />
        <updated>2025-11-22T07:34:08.000Z</updated>
    </entry>
    <entry>
        <id>https://blog.17lai.site/posts/847851a6/</id>
        <title>SQLite使用全面教程：轻量级数据库的终极指南</title>
        <link rel="alternate" href="https://blog.17lai.site/posts/847851a6/"/>
        <content type="html">&lt;blockquote&gt;
&lt;p&gt;SQLite是世界上最广泛部署的数据库引擎，以其轻量、零配置和嵌入式特性著称。本教程将带你从基础到高级全面掌握SQLite的使用技巧，特别强化了数据库连接和命令行操作部分。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;p&gt;&lt;img src=&#34;https://cimg1.17lai.site/data/2025/11/22/20251122171925.webp&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;一、安装与配置&#34;&gt;一、安装与配置&lt;/h2&gt;
&lt;h3 id=&#34;Windows安装&#34;&gt;Windows安装&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;访问 &lt;a href=&#34;https://sqlite.org/download.html&#34;&gt;SQLite官网&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;下载 &lt;code&gt;sqlite-tools-win32-*.zip&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;解压后添加目录到系统PATH&lt;/li&gt;
&lt;li&gt;命令行输入 &lt;code&gt;sqlite3&lt;/code&gt; 验证安装&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;Linux-macOS安装&#34;&gt;Linux/macOS安装&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# Debian&amp;#x2F;Ubuntu
sudo apt install sqlite3

# macOS (需先安装Homebrew)
brew install sqlite&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;二、数据库连接与基本操作&#34;&gt;二、数据库连接与基本操作&lt;/h2&gt;
&lt;h3 id=&#34;创建并连接数据库&#34;&gt;创建并连接数据库&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 创建或打开数据库（不存在则创建）
sqlite3 mydatabase.db&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;p&gt;成功连接后，提示符变为：&lt;/p&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;sqlite&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;实时操作示例&#34;&gt;实时操作示例&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建用户表
CREATE TABLE users (
id INTEGER PRIMARY KEY AUTOINCREMENT,
name TEXT NOT NULL,
email TEXT UNIQUE,
created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 插入数据
INSERT INTO users (name, email) VALUES
(&amp;#39;张三&amp;#39;, &amp;#39;zhangsan@example.com&amp;#39;),
(&amp;#39;李四&amp;#39;, &amp;#39;lisi@example.com&amp;#39;);

-- 查询数据
SELECT * FROM users;

-- 退出SQLite命令行
.quit&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;连接到现有数据库&#34;&gt;连接到现有数据库&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 连接到已存在的数据库
sqlite3 existing_db.db&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;内存数据库（临时数据库）&#34;&gt;内存数据库（临时数据库）&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 创建内存中的临时数据库（关闭后消失）
sqlite3 :memory:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;三、SQLite命令行工具高级用法&#34;&gt;三、SQLite命令行工具高级用法&lt;/h2&gt;
&lt;h3 id=&#34;常用点命令&#34;&gt;常用点命令&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;命令&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;.open test.db&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;打开/创建数据库&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;.tables&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;显示所有表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;.schema users&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;显示表结构&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;.mode column&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;列模式显示&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;.headers on&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;显示列名&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;.show&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;显示当前配置&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;.quit&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;退出命令行&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;.help&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;显示帮助信息&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;数据导入导出实战&#34;&gt;数据导入导出实战&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;导出数据到CSV：&lt;/strong&gt;&lt;/p&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;sqlite3 mydatabase.db
.headers on
.mode csv
.output users.csv
SELECT * FROM users;
.output stdout&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;从CSV导入数据：&lt;/strong&gt;&lt;/p&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建临时表
CREATE TABLE temp_import(
name TEXT,
email TEXT
);

-- 导入数据
.mode csv
.import &amp;#x2F;path&amp;#x2F;to&amp;#x2F;new_users.csv temp_import

-- 插入到主表
INSERT INTO users (name, email)
SELECT name, email FROM temp_import;

-- 清理临时表
DROP TABLE temp_import;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;备份与恢复&#34;&gt;备份与恢复&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;完整备份：&lt;/strong&gt;&lt;/p&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;sqlite3 mydatabase.db &amp;quot;.backup &amp;#39;backup.db&amp;#39;&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;增量备份（使用WAL模式）：&lt;/strong&gt;&lt;/p&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 启用WAL模式
sqlite3 mydatabase.db &amp;quot;PRAGMA journal_mode&amp;#x3D;WAL;&amp;quot;

# 创建备份
cp mydatabase.db backup.db
cp mydatabase.db-wal backup.db-wal
cp mydatabase.db-shm backup.db-shm&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;四、Python集成实战&#34;&gt;四、Python集成实战&lt;/h2&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-python&#34; data-language=&#34;python&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-python&#34;&gt;import sqlite3
from datetime import datetime

# 连接数据库（不存在则创建）
conn &amp;#x3D; sqlite3.connect(&amp;#39;mydatabase.db&amp;#39;)
cursor &amp;#x3D; conn.cursor()

# 创建表
cursor.execute(&amp;#39;&amp;#39;&amp;#39;CREATE TABLE IF NOT EXISTS orders (
id INTEGER PRIMARY KEY,
user_id INTEGER,
product TEXT,
amount REAL,
order_date TIMESTAMP,
FOREIGN KEY(user_id) REFERENCES users(id))&amp;#39;&amp;#39;&amp;#39;)

# 插入订单数据
user_id &amp;#x3D; 1
orders &amp;#x3D; [
(user_id, &amp;#39;Laptop&amp;#39;, 1200.50, datetime.now()),
(user_id, &amp;#39;Mouse&amp;#39;, 25.99, datetime.now())
]
cursor.executemany(&amp;quot;INSERT INTO orders (user_id, product, amount, order_date) VALUES (?, ?, ?, ?)&amp;quot;, orders)

# 复杂查询：用户及其订单
cursor.execute(&amp;#39;&amp;#39;&amp;#39;SELECT users.name, orders.product, orders.amount
FROM users
JOIN orders ON users.id &amp;#x3D; orders.user_id&amp;#39;&amp;#39;&amp;#39;)
for row in cursor.fetchall():
print(f&amp;quot;&amp;#123;row&amp;#125; purchased &amp;#123;row&amp;#125; for $&amp;#123;row:.2f&amp;#125;&amp;quot;)

# 提交并关闭连接
conn.commit()
conn.close()&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;五、高级特性与优化&#34;&gt;五、高级特性与优化&lt;/h2&gt;
&lt;h3 id=&#34;事务处理&#34;&gt;事务处理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;BEGIN TRANSACTION;

-- 转账操作
UPDATE accounts SET balance &amp;#x3D; balance - 100 WHERE id &amp;#x3D; 1;
UPDATE accounts SET balance &amp;#x3D; balance + 100 WHERE id &amp;#x3D; 2;

-- 提交事务
COMMIT;

-- 出错时回滚
-- ROLLBACK;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;性能优化技巧&#34;&gt;性能优化技巧&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;索引优化&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_orders_date ON orders(order_date);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;WAL模式&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;PRAGMA journal_mode&amp;#x3D;WAL;-- 启用写前日志&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;缓存调整&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;PRAGMA cache_size &amp;#x3D; -2000;-- 设置2000页缓存(约3.2MB)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;strong&gt;查询优化&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;EXPLAIN QUERY PLAN SELECT * FROM users WHERE email &amp;#x3D; &amp;#39;test@example.com&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;全文搜索&#34;&gt;全文搜索&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建虚拟表
CREATE VIRTUAL TABLE docs USING fts5(title, content);

-- 插入数据
INSERT INTO docs VALUES
(&amp;#39;SQLite Guide&amp;#39;, &amp;#39;Comprehensive guide to SQLite database&amp;#39;),
(&amp;#39;Python Tutorial&amp;#39;, &amp;#39;Learn Python programming language&amp;#39;);

-- 全文搜索
SELECT * FROM docs WHERE docs MATCH &amp;#39;guide database&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;六、图形化管理工具推荐&#34;&gt;六、图形化管理工具推荐&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;DB Browser for SQLite&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;开源可视化工具&lt;/li&gt;
&lt;li&gt;下载地址：&lt;a href=&#34;https://sqlitebrowser.org/&#34;&gt;https://sqlitebrowser.org/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;SQLiteStudio&lt;/strong&gt;：&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;跨平台多功能管理器&lt;/li&gt;
&lt;li&gt;下载地址：&lt;a href=&#34;https://sqlitestudio.pl/&#34;&gt;https://sqlitestudio.pl/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;七、常见问题解决方案&#34;&gt;七、常见问题解决方案&lt;/h2&gt;
&lt;h3 id=&#34;数据库锁定问题&#34;&gt;数据库锁定问题&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 查看锁定进程
lsof mydatabase.db

# 安全解锁
cp mydatabase.db unlocked.db
sqlite3 unlocked.db &amp;quot;PRAGMA wal_checkpoint;&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;数据库修复&#34;&gt;数据库修复&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 导出数据
sqlite3 corrupt.db .dump &amp;gt; recovery.sql

# 重建数据库
sqlite3 new.db &amp;lt; recovery.sql&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;跨数据库操作&#34;&gt;跨数据库操作&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 附加另一个数据库
ATTACH DATABASE &amp;#39;another.db&amp;#39; AS other;

-- 跨数据库查询
SELECT * FROM main.users
UNION ALL
SELECT * FROM other.users;

-- 分离数据库
DETACH DATABASE other;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;八、实际应用场景&#34;&gt;八、实际应用场景&lt;/h2&gt;
&lt;h3 id=&#34;移动应用数据存储&#34;&gt;移动应用数据存储&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-java&#34; data-language=&#34;java&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-java&#34;&gt;&amp;#x2F;&amp;#x2F; Android示例
SQLiteDatabase db &amp;#x3D; openOrCreateDatabase(&amp;quot;app_data.db&amp;quot;, MODE_PRIVATE, null);
db.execSQL(&amp;quot;CREATE TABLE IF NOT EXISTS settings (key TEXT PRIMARY KEY, value TEXT)&amp;quot;);
ContentValues values &amp;#x3D; new ContentValues();
values.put(&amp;quot;key&amp;quot;, &amp;quot;theme&amp;quot;);
values.put(&amp;quot;value&amp;quot;, &amp;quot;dark&amp;quot;);
db.insert(&amp;quot;settings&amp;quot;, null, values);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;网站数据分析&#34;&gt;网站数据分析&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-python&#34; data-language=&#34;python&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-python&#34;&gt;# 日志分析示例
import sqlite3

conn &amp;#x3D; sqlite3.connect(&amp;#39;weblog.db&amp;#39;)
conn.execute(&amp;#39;&amp;#39;&amp;#39;CREATE TABLE IF NOT EXISTS visits
(id INTEGER PRIMARY KEY,
ip TEXT,
url TEXT,
timestamp DATETIME DEFAULT CURRENT_TIMESTAMP)&amp;#39;&amp;#39;&amp;#39;)

# 模拟插入访问记录
conn.execute(&amp;quot;INSERT INTO visits (ip, url) VALUES (?, ?)&amp;quot;,
(&amp;#39;192.168.1.1&amp;#39;, &amp;#39;&amp;#x2F;homepage&amp;#39;))
conn.commit()&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;学习资源推荐&#34;&gt;学习资源推荐&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://sqlite.org/docs.html&#34;&gt;SQLite官方文档&lt;/a&gt; - 最权威的参考指南&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.sqlitetutorial.net/&#34;&gt;SQLite Tutorial&lt;/a&gt; - 交互式学习平台&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://sqlfiddle.com/&#34;&gt;SQLite Fiddle&lt;/a&gt; - 在线SQLite测试环境&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://sqliteviewer.app/&#34;&gt;SQLite Viewer&lt;/a&gt; - 在线查看SQLite文件&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;mermaid&#34;&gt;graph TD
A[启动SQLite] --&amp;gt; B&amp;#123;数据库存在？&amp;#125;
B --&amp;gt;|是| C[打开数据库]
B --&amp;gt;|否| D[创建新数据库]
C --&amp;gt; E[执行SQL操作]
D --&amp;gt; E
E --&amp;gt; F[保存更改]
F --&amp;gt; G[退出SQLite]&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;通过本增强版教程，你不仅掌握了SQLite的核心操作，还学习了实际开发中的高级技巧。SQLite的轻量级特性使其成为嵌入式系统、移动应用和小型网站的完美选择，立即开始你的SQLite项目实践吧！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;参考-致谢&#34;&gt;参考&amp;amp;致谢&lt;/h2&gt;
&lt;h2 id=&#34;系列教程&#34;&gt;&lt;strong&gt;系列教程&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;/atom.xml&#34;&gt;&lt;i class=&#34;fas fa-rss&#34;&gt;&lt;/i&gt;全部文章RSS订阅&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;数据库系列&#34;&gt;&lt;strong&gt;数据库系列&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/posts/b2f7c564/&#34;&gt;SQL命令使用教程：从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/847851a6/&#34;&gt;SQLite使用全面教程：轻量级数据库的终极指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/a460ae99/&#34;&gt;MySQL命令行使用全面教程：从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/622f0f0f/&#34;&gt;MySQL 使用全面指南：从入门到高级实践&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/16bffe88/&#34;&gt;PostgreSQL 使用全面指南：从入门到企业级应用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/6c6f64dc/&#34;&gt;PostgreSQL命令行使用教程：掌握 psql 工具&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/a416ccaa/&#34;&gt;PostgreSQL 实现原理深度剖析：高性能数据库引擎的核心机制&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;link rel=&#34;stylesheet&#34; href=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css&#34;&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/d3@7&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-view@0.18.10&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;/css/markmap.css&#34;&gt;

&lt;script src=&#34;/js/markmap.js&#34;&gt;&lt;/script&gt;
</content>
        <category term="sql" />
        <category term="sqlite" />
        <updated>2025-11-22T07:28:00.000Z</updated>
    </entry>
    <entry>
        <id>https://blog.17lai.site/posts/a460ae99/</id>
        <title>MySQL命令行使用全面教程：从入门到精通</title>
        <link rel="alternate" href="https://blog.17lai.site/posts/a460ae99/"/>
        <content type="html">&lt;blockquote&gt;
&lt;p&gt;MySQL是最流行的关系型数据库之一，掌握其命令行工具是每位开发者和DBA的必备技能。本教程将带你系统学习MySQL命令行的核心功能和实用技巧。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;p&gt;&lt;img src=&#34;https://cimg1.17lai.site/data/2025/11/22/20251122171403.webp&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;🚀-连接MySQL服务器&#34;&gt;🚀 连接MySQL服务器&lt;/h2&gt;
&lt;h3 id=&#34;基础连接方式&#34;&gt;基础连接方式&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 连接到本地MySQL服务器
mysql -u root -p

# 指定主机和端口
mysql -h 127.0.0.1 -P 3306 -u username -p

# 连接后直接选择数据库
mysql -u root -p database_name&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;连接参数说明&#34;&gt;连接参数说明&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;th&gt;示例&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-u&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用户名&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-u admin&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-p&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;密码提示&lt;/td&gt;
&lt;td&gt;(回车后输入密码)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-h&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;主机地址&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-h db.example.com&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-P&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;端口号&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-P 3307&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-D&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;指定数据库&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-D mydb&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;🔍-数据库与表操作&#34;&gt;🔍 数据库与表操作&lt;/h2&gt;
&lt;h3 id=&#34;数据库管理&#34;&gt;数据库管理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 显示所有数据库
SHOW DATABASES;

-- 创建新数据库
CREATE DATABASE school_db;

-- 选择数据库
USE school_db;

-- 删除数据库
DROP DATABASE old_db;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;表操作&#34;&gt;表操作&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建学生表
CREATE TABLE students (
id INT PRIMARY KEY AUTO_INCREMENT,
name VARCHAR(50) NOT NULL,
age INT CHECK (age &amp;gt;&amp;#x3D; 15),
email VARCHAR(100) UNIQUE,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 显示所有表
SHOW TABLES;

-- 查看表结构
DESCRIBE students;

-- 修改表结构
ALTER TABLE students ADD COLUMN major VARCHAR(50);
ALTER TABLE students MODIFY COLUMN age TINYINT;
ALTER TABLE students DROP COLUMN email;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;📊-数据操作-CRUD&#34;&gt;📊 数据操作(CRUD)&lt;/h2&gt;
&lt;h3 id=&#34;插入数据&#34;&gt;插入数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;INSERT INTO students (name, age)
VALUES
(&amp;#39;张三&amp;#39;, 18),
(&amp;#39;李四&amp;#39;, 19),
(&amp;#39;王五&amp;#39;, 17);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;查询数据&#34;&gt;查询数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 查询所有数据
SELECT * FROM students;

-- 条件查询
SELECT name, age FROM students WHERE age &amp;gt; 18;

-- 排序和限制
SELECT * FROM students ORDER BY created_at DESC LIMIT 5;

-- 模糊查询
SELECT * FROM students WHERE name LIKE &amp;#39;张%&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;更新数据&#34;&gt;更新数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;UPDATE students
SET age &amp;#x3D; 20
WHERE name &amp;#x3D; &amp;#39;张三&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;删除数据&#34;&gt;删除数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;DELETE FROM students
WHERE name &amp;#x3D; &amp;#39;王五&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🔧-高级查询技巧&#34;&gt;🔧 高级查询技巧&lt;/h2&gt;
&lt;h3 id=&#34;聚合函数&#34;&gt;聚合函数&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT
COUNT(*) AS total,
AVG(age) AS avg_age,
MIN(created_at) AS oldest,
MAX(age) AS max_age
FROM students;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;分组统计&#34;&gt;分组统计&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT
major,
COUNT(*) AS student_count,
AVG(age) AS avg_age
FROM students
GROUP BY major
HAVING COUNT(*) &amp;gt; 5;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;表连接&#34;&gt;表连接&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建课程表
CREATE TABLE courses (
id INT PRIMARY KEY AUTO_INCREMENT,
name VARCHAR(50),
instructor VARCHAR(50)
);

-- 内连接查询
SELECT s.name, c.name AS course
FROM students s
JOIN courses c ON s.id &amp;#x3D; c.student_id;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;👥-用户与权限管理&#34;&gt;👥 用户与权限管理&lt;/h2&gt;
&lt;h3 id=&#34;用户管理&#34;&gt;用户管理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 创建新用户
CREATE USER &amp;#39;dev&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;password123&amp;#39;;

-- 修改密码
ALTER USER &amp;#39;dev&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;newpassword456&amp;#39;;

-- 删除用户
DROP USER &amp;#39;dev&amp;#39;@&amp;#39;localhost&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;权限管理&#34;&gt;权限管理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 授予权限
GRANT SELECT, INSERT, UPDATE ON school_db.* TO &amp;#39;dev&amp;#39;@&amp;#39;localhost&amp;#39;;

-- 查看权限
SHOW GRANTS FOR &amp;#39;dev&amp;#39;@&amp;#39;localhost&amp;#39;;

-- 撤销权限
REVOKE UPDATE ON school_db.* FROM &amp;#39;dev&amp;#39;@&amp;#39;localhost&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;📤-数据导入导出&#34;&gt;📤 数据导入导出&lt;/h2&gt;
&lt;h3 id=&#34;导出数据&#34;&gt;导出数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 导出整个数据库
mysqldump -u root -p school_db &amp;gt; school_db.sql

# 导出特定表
mysqldump -u root -p school_db students &amp;gt; students.sql

# 导出为CSV格式
mysql -u root -p -e &amp;quot;SELECT * FROM students&amp;quot; school_db &amp;gt; students.csv&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;导入数据&#34;&gt;导入数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 导入SQL文件
mysql -u root -p school_db &amp;lt; backup.sql

# 导入CSV数据
mysql -u root -p school_db -e &amp;quot;
LOAD DATA INFILE &amp;#39;&amp;#x2F;path&amp;#x2F;to&amp;#x2F;students.csv&amp;#39;
INTO TABLE students
FIELDS TERMINATED BY &amp;#39;,&amp;#39;
LINES TERMINATED BY &amp;#39;\n&amp;#39;
IGNORE 1 ROWS;&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;⚙️-配置与优化&#34;&gt;⚙️ 配置与优化&lt;/h2&gt;
&lt;h3 id=&#34;配置文件-my-cnf&#34;&gt;配置文件(my.cnf)&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-ini&#34; data-language=&#34;ini&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-ini&#34;&gt;[mysqld]
datadir&amp;#x3D;&amp;#x2F;var&amp;#x2F;lib&amp;#x2F;mysql
socket&amp;#x3D;&amp;#x2F;var&amp;#x2F;lib&amp;#x2F;mysql&amp;#x2F;mysql.sock
log-error&amp;#x3D;&amp;#x2F;var&amp;#x2F;log&amp;#x2F;mysql&amp;#x2F;error.log
pid-file&amp;#x3D;&amp;#x2F;var&amp;#x2F;run&amp;#x2F;mysql&amp;#x2F;mysql.pid

# 性能优化
innodb_buffer_pool_size&amp;#x3D;1G
max_connections&amp;#x3D;200
query_cache_size&amp;#x3D;128M&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;性能分析&#34;&gt;性能分析&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 查看查询执行计划
EXPLAIN SELECT * FROM students WHERE age &amp;gt; 18;

-- 查看进程列表
SHOW PROCESSLIST;

-- 优化表
OPTIMIZE TABLE students;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🚨-常见问题解决&#34;&gt;🚨 常见问题解决&lt;/h2&gt;
&lt;h3 id=&#34;忘记root密码&#34;&gt;忘记root密码&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;停止MySQL服务&lt;/li&gt;
&lt;li&gt;启动安全模式：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;mysqld_safe --skip-grant-tables &amp;amp;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;登录并修改密码：&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;FLUSH PRIVILEGES;
ALTER USER &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;newpassword&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;重启MySQL服务&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;连接错误&#34;&gt;连接错误&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 错误：ERROR 1045 (28000)
# 解决方案：检查用户名&amp;#x2F;密码，确保主机权限

# 错误：ERROR 2002 (HY000)
# 解决方案：确认MySQL服务运行中，检查socket路径&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;备份与恢复&#34;&gt;备份与恢复&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 定时备份脚本
mysqldump -u root -p --all-databases | gzip &amp;gt; &amp;#x2F;backups&amp;#x2F;mysql-$(date +%F).sql.gz

# 恢复备份
gunzip &amp;lt; &amp;#x2F;backups&amp;#x2F;mysql-2023-01-01.sql.gz | mysql -u root -p&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;💡-实用技巧&#34;&gt;💡 实用技巧&lt;/h2&gt;
&lt;h3 id=&#34;批处理模式&#34;&gt;批处理模式&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;mysql -u root -p -e &amp;quot;SHOW DATABASES; SELECT VERSION();&amp;quot;

# 执行SQL脚本
mysql -u root -p &amp;lt; script.sql&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;输出格式化&#34;&gt;输出格式化&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 垂直显示结果
SELECT * FROM students \G

-- 表格格式
SELECT * FROM students \T

-- 导出为HTML
SELECT * FROM students --html&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;命令历史&#34;&gt;命令历史&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 查看历史命令
cat ~&amp;#x2F;.mysql_history

# 实时监控查询
mysqladmin -u root -p processlist&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;📚-学习资源推荐&#34;&gt;📚 学习资源推荐&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://dev.mysql.com/doc/&#34;&gt;MySQL官方文档&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.mysqltutorial.org/&#34;&gt;MySQL Tutorial&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://sqlzoo.net/wiki/SQL_Tutorial&#34;&gt;SQLZoo MySQL练习&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.mysql.com/products/workbench/&#34;&gt;MySQL Workbench图形工具&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;通过掌握这些MySQL命令和技巧，你将能够高效地管理和操作数据库。实践是最好的学习方式 - 立即创建你的第一个数据库项目吧！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;附录：常用命令速查表&#34;&gt;附录：常用命令速查表&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类别&lt;/th&gt;
&lt;th&gt;命令&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;连接&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;mysql -u user -p&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;连接数据库&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;数据库&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;SHOW DATABASES;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;显示所有数据库&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CREATE DATABASE dbname;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;创建数据库&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;USE dbname;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;选择数据库&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;表操作&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;SHOW TABLES;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;显示所有表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;DESCRIBE tablename;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;查看表结构&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;ALTER TABLE ...&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;修改表结构&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;数据&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;SELECT ... FROM ...&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;查询数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;INSERT INTO ... VALUES ...&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;插入数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;UPDATE ... SET ... WHERE ...&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;更新数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;DELETE FROM ... WHERE ...&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;删除数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;用户&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CREATE USER ...&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;创建用户&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;GRANT ... ON ... TO ...&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;授予权限&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;维护&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;SHOW PROCESSLIST;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;查看活动连接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;EXPLAIN SELECT ...&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;分析查询性能&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;参考-致谢&#34;&gt;参考&amp;amp;致谢&lt;/h2&gt;
&lt;h2 id=&#34;系列教程&#34;&gt;&lt;strong&gt;系列教程&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;/atom.xml&#34;&gt;&lt;i class=&#34;fas fa-rss&#34;&gt;&lt;/i&gt;全部文章RSS订阅&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;数据库系列&#34;&gt;&lt;strong&gt;数据库系列&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/posts/b2f7c564/&#34;&gt;SQL命令使用教程：从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/847851a6/&#34;&gt;SQLite使用全面教程：轻量级数据库的终极指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/a460ae99/&#34;&gt;MySQL命令行使用全面教程：从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/622f0f0f/&#34;&gt;MySQL 使用全面指南：从入门到高级实践&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/16bffe88/&#34;&gt;PostgreSQL 使用全面指南：从入门到企业级应用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/6c6f64dc/&#34;&gt;PostgreSQL命令行使用教程：掌握 psql 工具&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/a416ccaa/&#34;&gt;PostgreSQL 实现原理深度剖析：高性能数据库引擎的核心机制&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;link rel=&#34;stylesheet&#34; href=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css&#34;&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/d3@7&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-view@0.18.10&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;/css/markmap.css&#34;&gt;

&lt;script src=&#34;/js/markmap.js&#34;&gt;&lt;/script&gt;
</content>
        <category term="web" />
        <category term="sql" />
        <updated>2025-11-22T07:18:53.000Z</updated>
    </entry>
    <entry>
        <id>https://blog.17lai.site/posts/6c6f64dc/</id>
        <title>PostgreSQL命令行使用教程：掌握 psql 工具</title>
        <link rel="alternate" href="https://blog.17lai.site/posts/6c6f64dc/"/>
        <content type="html">&lt;blockquote&gt;
&lt;p&gt;掌握PostgreSQL的命令行工具&lt;code&gt;psql&lt;/code&gt;是高效管理数据库的关键。本文将带你全面了解这个强大的交互式终端工具的各种使用方法，包括各种常见问题和技巧总结。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;h2 id=&#34;🚀-启动psql&#34;&gt;🚀 启动psql&lt;/h2&gt;
&lt;h3 id=&#34;基本连接方式&#34;&gt;基本连接方式&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 连接到本地默认数据库
psql

# 指定用户名和数据库
psql -U username -d dbname

# 指定主机和端口
psql -h localhost -p 5432 -U postgres -d mydb&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;连接参数说明&#34;&gt;连接参数说明&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;参数&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;th&gt;示例&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-U&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;用户名&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-U admin&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-d&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;数据库名&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-d sales_db&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-h&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;主机地址&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-h db.example.com&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-p&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;端口号&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-p 6432&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-W&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;强制密码提示&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;-f&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;执行SQL文件&lt;/td&gt;
&lt;td&gt;&lt;code&gt;-f setup.sql&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;🔍-常用元命令（以-开头）&#34;&gt;🔍 常用元命令（以&lt;code&gt;\&lt;/code&gt;开头）&lt;/h2&gt;
&lt;h3 id=&#34;数据库操作&#34;&gt;数据库操作&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 列出所有数据库
\l

-- 切换数据库
\c dbname

-- 创建新数据库
CREATE DATABASE newdb;

-- 删除数据库
DROP DATABASE olddb;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;表操作&#34;&gt;表操作&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 列出当前数据库所有表
\dt

-- 查看表结构
\d users

-- 显示表详细信息
\d+ orders

-- 显示表、视图和序列
\dv&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;用户和权限管理&#34;&gt;用户和权限管理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 列出所有用户
\du

-- 创建新用户
CREATE USER dev WITH PASSWORD &amp;#39;secret123&amp;#39;;

-- 修改密码
ALTER USER dev WITH PASSWORD &amp;#39;newsecret456&amp;#39;;

-- 授予权限
GRANT SELECT, INSERT ON customers TO dev;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;信息查询&#34;&gt;信息查询&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 显示当前连接信息
\conninfo

-- 显示SQL版本
SELECT version();

-- 显示当前时间
SELECT NOW();

-- 显示当前数据库
SELECT current_database();&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;文件操作&#34;&gt;文件操作&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 执行SQL文件
\i path&amp;#x2F;to&amp;#x2F;script.sql

-- 将查询结果输出到文件
\o output.txt
SELECT * FROM products;
\o&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;帮助系统&#34;&gt;帮助系统&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 显示所有元命令帮助
\?

-- 显示SQL命令帮助
\h

-- 查看特定命令帮助
\h CREATE TABLE&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;📊-查询与编辑&#34;&gt;📊 查询与编辑&lt;/h2&gt;
&lt;h3 id=&#34;基本查询&#34;&gt;基本查询&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 简单查询
SELECT * FROM employees;

-- 条件查询
SELECT name, salary FROM employees WHERE salary &amp;gt; 50000;

-- 排序
SELECT * FROM orders ORDER BY order_date DESC;

-- 限制结果
SELECT * FROM products LIMIT 10;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;多行编辑&#34;&gt;多行编辑&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 开启多行模式
\set PROMPT1 &amp;#39;%&amp;#x2F;%R%# &amp;#39;

-- 输入多行SQL语句
SELECT
first_name,
last_name,
department
FROM employees
WHERE hire_date &amp;gt; &amp;#39;2020-01-01&amp;#39;;

-- 结束多行输入（分号后回车）
;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;查询历史&#34;&gt;查询历史&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 查看历史命令
\s

-- 保存历史到文件
\s history.sql

-- 执行历史命令（!后跟行号）
\! 15&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🔄-导入导出数据&#34;&gt;🔄 导入导出数据&lt;/h2&gt;
&lt;h3 id=&#34;导出数据&#34;&gt;导出数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 导出整个数据库
pg_dump dbname &amp;gt; dbname.sql

# 导出特定表
pg_dump -t tablename dbname &amp;gt; table.sql

# 导出为CSV格式
\copy (SELECT * FROM users) TO &amp;#39;&amp;#x2F;path&amp;#x2F;to&amp;#x2F;users.csv&amp;#39; CSV HEADER&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;导入数据&#34;&gt;导入数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 导入SQL文件
psql -d dbname -f backup.sql

# 导入CSV文件
\copy users FROM &amp;#39;&amp;#x2F;path&amp;#x2F;to&amp;#x2F;users.csv&amp;#39; CSV HEADER

# 使用COPY命令（需要超级用户权限）
COPY employees FROM &amp;#39;&amp;#x2F;path&amp;#x2F;to&amp;#x2F;employees.csv&amp;#39; DELIMITER &amp;#39;,&amp;#39; CSV HEADER;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;⚙️-配置与定制&#34;&gt;⚙️ 配置与定制&lt;/h2&gt;
&lt;h3 id=&#34;配置文件（-psqlrc）&#34;&gt;配置文件（.psqlrc）&lt;/h3&gt;
&lt;p&gt;在用户主目录创建&lt;code&gt;.psqlrc&lt;/code&gt;文件：&lt;/p&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 设置时间格式
\set HISTFILE ~&amp;#x2F;.psql_history- :DBNAME
\set HISTSIZE 1000

-- 自定义提示符
\set PROMPT1 &amp;#39;%[%033[1;33m%]%&amp;#x2F;%R%#%[%033[0m%] &amp;#39;

-- 自动提交
\set AUTOCOMMIT on

-- 常用别名
\set QUIET on
\echo &amp;#39;常用别名:&amp;#39;
\echo &amp;#39;e: \\dt&amp;#39;
\echo &amp;#39;s: SELECT * FROM&amp;#39;
\set QUIET off&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;常用配置选项&#34;&gt;常用配置选项&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 显示查询执行时间
\timing

-- 扩展显示模式
\x auto

-- 设置空值显示
\pset null &amp;#39;[NULL]&amp;#39;

-- 设置边框样式
\pset border 2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🛠️-高级技巧&#34;&gt;🛠️ 高级技巧&lt;/h2&gt;
&lt;h3 id=&#34;事务管理&#34;&gt;事务管理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 开始事务
BEGIN;

-- 执行多个操作
UPDATE accounts SET balance &amp;#x3D; balance - 100 WHERE id &amp;#x3D; 1;
UPDATE accounts SET balance &amp;#x3D; balance + 100 WHERE id &amp;#x3D; 2;

-- 提交或回滚
COMMIT;
-- ROLLBACK;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;性能分析&#34;&gt;性能分析&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 查看查询计划
EXPLAIN SELECT * FROM large_table WHERE condition &amp;#x3D; &amp;#39;value&amp;#39;;

-- 详细分析（实际执行）
EXPLAIN ANALYZE SELECT * FROM large_table;

-- 索引使用情况
SELECT * FROM pg_stat_user_indexes;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;维护操作&#34;&gt;维护操作&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 重建索引
REINDEX TABLE large_table;

-- 清理表空间
VACUUM FULL ANALYZE;

-- 收集统计信息
ANALYZE VERBOSE;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;🚨-常见问题解决&#34;&gt;🚨 常见问题解决&lt;/h2&gt;
&lt;h3 id=&#34;连接问题&#34;&gt;连接问题&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;# 认证失败
psql: FATAL: password authentication failed for user &amp;quot;user&amp;quot;

# 解决方案：
# 1. 检查pg_hba.conf配置
# 2. 重置密码：ALTER USER user WITH PASSWORD &amp;#39;newpassword&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;权限问题&#34;&gt;权限问题&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 权限拒绝
ERROR: permission denied for table tablename

# 解决方案：
GRANT SELECT, INSERT ON tablename TO username;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;特殊字符处理&#34;&gt;特殊字符处理&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 包含引号的字符串
SELECT * FROM comments WHERE text E&amp;#39;contains \&amp;#39;quote\&amp;#39;&amp;#39;;

-- 使用$tag$语法
DO $$
BEGIN
INSERT INTO logs (message) VALUES (&amp;#39;This contains &amp;#39;&amp;#39;quotes&amp;#39;&amp;#39;&amp;#39;);
END $$;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;💡-实用技巧总结&#34;&gt;💡 实用技巧总结&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;历史命令&lt;/strong&gt;：使用上下箭头键浏览历史命令&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;自动补全&lt;/strong&gt;：Tab键补全对象名（表名、列名等）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;变量设置&lt;/strong&gt;：使用&lt;code&gt;:variable&lt;/code&gt;存储和重用值&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;\set id 100
SELECT * FROM users WHERE id &amp;#x3D; :id;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;strong&gt;快速编辑&lt;/strong&gt;：使用&lt;code&gt;\e&lt;/code&gt;打开编辑器编辑当前查询&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;执行系统命令&lt;/strong&gt;：&lt;code&gt;\!&lt;/code&gt;后跟系统命令&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;\! ls -l &amp;#x2F;backups&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;📚-学习资源&#34;&gt;📚 学习资源&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://www.postgresql.org/docs/current/app-psql.html&#34;&gt;PostgreSQL官方文档&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.postgresqltutorial.com/psql-commands/&#34;&gt;psql命令行备忘单&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.pgadmin.org/&#34;&gt;pgAdmin - PostgreSQL图形化管理工具&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;通过掌握这些&lt;code&gt;psql&lt;/code&gt;命令和技巧，你将能够高效地管理和操作PostgreSQL数据库。不断练习和实践是成为数据库管理专家的关键！&lt;/p&gt;
&lt;h2 id=&#34;参考-致谢&#34;&gt;参考&amp;amp;致谢&lt;/h2&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css&#34;&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/d3@7&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-view@0.18.10&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;/css/markmap.css&#34;&gt;

&lt;script src=&#34;/js/markmap.js&#34;&gt;&lt;/script&gt;
</content>
        <category term="sql" />
        <category term="postgresql" />
        <updated>2025-11-22T07:17:17.000Z</updated>
    </entry>
    <entry>
        <id>https://blog.17lai.site/posts/b2f7c564/</id>
        <title>SQL命令使用教程：从入门到精通</title>
        <link rel="alternate" href="https://blog.17lai.site/posts/b2f7c564/"/>
        <content type="html">&lt;blockquote&gt;
&lt;p&gt;作为一个程序员，不掌握SQL怎么行？掌握SQL是数据管理和分析的必备技能，本教程将带你系统学习SQL的核心命令和实用技巧，从入门到精通。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://cimg1.17lai.site/data/2025/11/22/20251122172229.webp&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;span id=&#34;more&#34;&gt;&lt;/span&gt;
&lt;h2 id=&#34;什么是SQL？&#34;&gt;什么是SQL？&lt;/h2&gt;
&lt;p&gt;SQL（Structured Query Language）是用于管理和操作关系型数据库的标准语言。通过SQL，你可以：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建和管理数据库和表&lt;/li&gt;
&lt;li&gt;插入、更新和删除数据&lt;/li&gt;
&lt;li&gt;查询和分析数据&lt;/li&gt;
&lt;li&gt;设置访问权限&lt;/li&gt;
&lt;li&gt;管理事务&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SQL主要分为四类命令：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;DDL&lt;/strong&gt;（数据定义语言） - 创建/修改数据库结构&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DML&lt;/strong&gt;（数据操作语言） - 操作数据&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DQL&lt;/strong&gt;（数据查询语言） - 查询数据&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DCL&lt;/strong&gt;（数据控制语言） - 控制访问权限&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;一、数据库操作&#34;&gt;一、数据库操作&lt;/h2&gt;
&lt;h3 id=&#34;创建数据库&#34;&gt;创建数据库&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;CREATE DATABASE school_db;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;查看所有数据库&#34;&gt;查看所有数据库&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SHOW DATABASES;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;选择数据库&#34;&gt;选择数据库&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;USE school_db;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;删除数据库&#34;&gt;删除数据库&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;DROP DATABASE school_db;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;二、表操作&#34;&gt;二、表操作&lt;/h2&gt;
&lt;h3 id=&#34;创建表&#34;&gt;创建表&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;CREATE TABLE students (
id INT PRIMARY KEY AUTO_INCREMENT,
name VARCHAR(50) NOT NULL,
age INT CHECK (age &amp;gt;&amp;#x3D; 15),
email VARCHAR(100) UNIQUE,
enrollment_date DATE DEFAULT CURRENT_DATE
);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;查看表结构&#34;&gt;查看表结构&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;DESCRIBE students;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;修改表结构&#34;&gt;修改表结构&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 添加新列
ALTER TABLE students ADD COLUMN major VARCHAR(50);

-- 修改列类型
ALTER TABLE students MODIFY COLUMN age SMALLINT;

-- 删除列
ALTER TABLE students DROP COLUMN email;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;删除表&#34;&gt;删除表&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;DROP TABLE students;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;三、数据操作（CRUD）&#34;&gt;三、数据操作（CRUD）&lt;/h2&gt;
&lt;h3 id=&#34;插入数据&#34;&gt;插入数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;INSERT INTO students (name, age, enrollment_date)
VALUES
(&amp;#39;张三&amp;#39;, 18, &amp;#39;2023-09-01&amp;#39;),
(&amp;#39;李四&amp;#39;, 19, &amp;#39;2023-08-25&amp;#39;),
(&amp;#39;王五&amp;#39;, 17, &amp;#39;2023-09-05&amp;#39;);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;查询数据&#34;&gt;查询数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 查询所有列
SELECT * FROM students;

-- 查询特定列
SELECT name, age FROM students;

-- 带条件查询
SELECT * FROM students WHERE age &amp;gt; 18;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;更新数据&#34;&gt;更新数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;UPDATE students
SET age &amp;#x3D; 20
WHERE name &amp;#x3D; &amp;#39;张三&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;删除数据&#34;&gt;删除数据&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;DELETE FROM students
WHERE name &amp;#x3D; &amp;#39;王五&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;四、高级查询技巧&#34;&gt;四、高级查询技巧&lt;/h2&gt;
&lt;h3 id=&#34;排序结果&#34;&gt;排序结果&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT * FROM students
ORDER BY age DESC, name ASC;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;限制结果数量&#34;&gt;限制结果数量&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT * FROM students
ORDER BY enrollment_date DESC
LIMIT 5;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;模糊查询&#34;&gt;模糊查询&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT * FROM students
WHERE name LIKE &amp;#39;张%&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;聚合函数&#34;&gt;聚合函数&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT
COUNT(*) AS total_students,
AVG(age) AS average_age,
MIN(enrollment_date) AS earliest_enrollment,
MAX(age) AS max_age
FROM students;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;分组统计&#34;&gt;分组统计&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT
major,
COUNT(*) AS student_count,
AVG(age) AS avg_age
FROM students
GROUP BY major
HAVING COUNT(*) &amp;gt; 5;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;五、表连接&#34;&gt;五、表连接&lt;/h2&gt;
&lt;h3 id=&#34;创建课程表&#34;&gt;创建课程表&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;CREATE TABLE courses (
course_id INT PRIMARY KEY AUTO_INCREMENT,
course_name VARCHAR(50),
instructor VARCHAR(50)
);

CREATE TABLE enrollments (
student_id INT,
course_id INT,
enrollment_date DATE,
FOREIGN KEY (student_id) REFERENCES students(id),
FOREIGN KEY (course_id) REFERENCES courses(course_id)
);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;内连接&#34;&gt;内连接&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT s.name, c.course_name
FROM students s
INNER JOIN enrollments e ON s.id &amp;#x3D; e.student_id
INNER JOIN courses c ON e.course_id &amp;#x3D; c.course_id;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;左连接&#34;&gt;左连接&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT s.name, c.course_name
FROM students s
LEFT JOIN enrollments e ON s.id &amp;#x3D; e.student_id
LEFT JOIN courses c ON e.course_id &amp;#x3D; c.course_id;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;六、子查询&#34;&gt;六、子查询&lt;/h2&gt;
&lt;h3 id=&#34;单行子查询&#34;&gt;单行子查询&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT * FROM students
WHERE age &amp;gt; (SELECT AVG(age) FROM students);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;多行子查询&#34;&gt;多行子查询&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT * FROM courses
WHERE course_id IN (
SELECT course_id FROM enrollments
GROUP BY course_id
HAVING COUNT(*) &amp;gt; 30
);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;七、索引优化&#34;&gt;七、索引优化&lt;/h2&gt;
&lt;h3 id=&#34;创建索引&#34;&gt;创建索引&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 单列索引
CREATE INDEX idx_student_name ON students(name);

-- 复合索引
CREATE INDEX idx_student_age_name ON students(age, name);

-- 唯一索引
CREATE UNIQUE INDEX idx_unique_email ON students(email);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;查看索引&#34;&gt;查看索引&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SHOW INDEX FROM students;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;删除索引&#34;&gt;删除索引&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;DROP INDEX idx_student_name ON students;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;八、视图&#34;&gt;八、视图&lt;/h2&gt;
&lt;h3 id=&#34;创建视图&#34;&gt;创建视图&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;CREATE VIEW student_summary AS
SELECT
s.id,
s.name,
COUNT(e.course_id) AS courses_enrolled
FROM students s
LEFT JOIN enrollments e ON s.id &amp;#x3D; e.student_id
GROUP BY s.id, s.name;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;使用视图&#34;&gt;使用视图&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;SELECT * FROM student_summary
WHERE courses_enrolled &amp;gt; 3;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;删除视图&#34;&gt;删除视图&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;DROP VIEW student_summary;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;九、事务管理&#34;&gt;九、事务管理&lt;/h2&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;START TRANSACTION;

-- 一系列操作
UPDATE accounts SET balance &amp;#x3D; balance - 100 WHERE id &amp;#x3D; 1;
UPDATE accounts SET balance &amp;#x3D; balance + 100 WHERE id &amp;#x3D; 2;

-- 提交事务
COMMIT;

-- 或回滚事务
-- ROLLBACK;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;十、最佳实践&#34;&gt;十、最佳实践&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;命名规范&lt;/strong&gt;：使用有意义的表名和列名（如&lt;code&gt;student_id&lt;/code&gt;而非&lt;code&gt;sid&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;**避免SELECT ***：只选择需要的列&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;使用参数化查询&lt;/strong&gt;：防止SQL注入攻击&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;索引优化&lt;/strong&gt;：为经常查询的列创建索引&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;定期备份&lt;/strong&gt;：使用&lt;code&gt;mysqldump&lt;/code&gt;或类似工具&lt;/li&gt;
&lt;/ol&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;mysqldump -u username -p database_name &amp;gt; backup.sql&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;常见错误处理&#34;&gt;常见错误处理&lt;/h2&gt;
&lt;h3 id=&#34;权限问题&#34;&gt;权限问题&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 授予权限
GRANT SELECT, INSERT ON school_db.* TO &amp;#39;user&amp;#39;@&amp;#39;localhost&amp;#39;;

-- 撤销权限
REVOKE INSERT ON school_db.* FROM &amp;#39;user&amp;#39;@&amp;#39;localhost&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h3 id=&#34;保留关键字冲突&#34;&gt;保留关键字冲突&lt;/h3&gt;
&lt;figure&gt;&lt;div class=&#34;code-area&#34;&gt;&lt;pre class=&#34;line-numbers language-sql&#34; data-language=&#34;sql&#34; data-start=&#34;1&#34;&gt;&lt;code class=&#34;language-sql&#34;&gt;-- 使用反引号包裹关键字
CREATE TABLE &amp;#96;user&amp;#96; (
&amp;#96;id&amp;#96; INT PRIMARY KEY,
&amp;#96;name&amp;#96; VARCHAR(50)
);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/figure&gt;
&lt;h2 id=&#34;学习资源推荐&#34;&gt;学习资源推荐&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://sqlzoo.net/&#34;&gt;SQLZoo&lt;/a&gt; - 交互式SQL学习平台&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.w3schools.com/sql/&#34;&gt;W3Schools SQL教程&lt;/a&gt; - 基础到进阶教程&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://sqlfiddle.com/&#34;&gt;SQL Fiddle&lt;/a&gt; - 在线SQL测试环境&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://leetcode.com/problemset/database/&#34;&gt;LeetCode数据库题库&lt;/a&gt; - 实战练习题&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;通过本教程，你已经掌握了SQL的核心概念和常用命令。持续练习是提高SQL技能的关键 - 尝试创建自己的数据库项目，解决实际问题，你将成为SQL专家！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;参考-致谢&#34;&gt;参考&amp;amp;致谢&lt;/h2&gt;
&lt;h2 id=&#34;系列教程&#34;&gt;&lt;strong&gt;系列教程&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;/atom.xml&#34;&gt;&lt;i class=&#34;fas fa-rss&#34;&gt;&lt;/i&gt;全部文章RSS订阅&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;数据库系列&#34;&gt;&lt;strong&gt;数据库系列&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/posts/b2f7c564/&#34;&gt;SQL命令使用教程：从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/847851a6/&#34;&gt;SQLite使用全面教程：轻量级数据库的终极指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/a460ae99/&#34;&gt;MySQL命令行使用全面教程：从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/622f0f0f/&#34;&gt;MySQL 使用全面指南：从入门到高级实践&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/16bffe88/&#34;&gt;PostgreSQL 使用全面指南：从入门到企业级应用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/6c6f64dc/&#34;&gt;PostgreSQL命令行使用教程：掌握 psql 工具&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/posts/a416ccaa/&#34;&gt;PostgreSQL 实现原理深度剖析：高性能数据库引擎的核心机制&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;link rel=&#34;stylesheet&#34; href=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css&#34;&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/d3@7&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-view@0.18.10&#34;&gt;&lt;/script&gt;&lt;script src=&#34;https://fastly.jsdelivr.net/npm/markmap-toolbar@0.18.10&#34;&gt;&lt;/script&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;/css/markmap.css&#34;&gt;

&lt;script src=&#34;/js/markmap.js&#34;&gt;&lt;/script&gt;
</content>
        <category term="web" />
        <category term="sql" />
        <updated>2025-11-22T07:14:19.000Z</updated>
    </entry>
</feed>
