const cacheStorageKeyPrefix="17lai-cache-";const cacheStorageKey=`17lai-cache-20251118204057`;var cacheList=["/css/main.css?v=1.3.0","/css/highlight.css?v=1.0.0","/css/highlight-dark.css?v=1.0.0","/libs/awesome/css/all.min.css?v=5.15.4","/libs/jquery/jquery.min.js?v=3.7.1","/libs/materialize/materialize.min.js?v=1.2.2","/libs/materialize/materialize.min.css?v=1.2.2","/libs/masonry/masonry.pkgd.min.js?v=4.2.2","/libs/aos/aos.min.css","/libs/aos/aos.min.js","/js/ana.js?v=1.1.1","/js/color-schema.js?v=1.0.1","/js/plugins.js?v=1.1.3","/js/boot.js?v=1.0.0","/js/utils.js?v=1.1.2","/js/events.js?v=1.0.0"];self.addEventListener("install",event=>{event.waitUntil(caches.open(cacheStorageKey).then(cache=>cache.addAll(cacheList)).then(()=>self.skipWaiting()))});self.addEventListener("message",event=>{if(event.data&&event.data.action==="skipWaiting"){self.skipWaiting();console.log("[PWA] rec message skipWaiting")}});self.addEventListener("activate",event=>{event.waitUntil(caches.keys().then(cacheNames=>{return Promise.all(cacheNames.map(cacheName=>{if(cacheName.startsWith(cacheStorageKeyPrefix)){if(cacheName!==cacheStorageKey){console.log("[PWA] Removing old cache:",cacheName);return caches.delete(cacheName)}}}))}).then(()=>{console.log("[PWA] Found caching resources",cacheStorageKey);return caches.open(cacheStorageKey).then(cache=>{return cache.addAll(cacheList)})}).then(()=>{console.log("[PWA] Activation complete");return self.clients.claim()}))});const customIdentifier="17laiIdentifier";self.addEventListener("message",event=>{if(event.data&&event.data.action==="checkIdentifier"){event.source.postMessage({identifier:customIdentifier})}});const proxyMap=new Map([["https://cdn.jsdelivr.net","https://fastly.jsdelivr.net"],["https://cimg1.17lai.site/","https://cimg1.17lai.fun/"],["https://unpkg.com/@waline/emojis","https://fastly.jsdelivr.net/npm/@waline/emojis"],["https://fastly.jsdelivr.net/npm/@waline/emojis","https://unpkg.com/@waline/emojis"],["https://cdn.webpushr.com","https://cdn-push.17lai.site"],["https://bot.webpushr.com","https://bot-push.17lai.site"],["https://analytics.webpushr.com","https://analytics-push.17lai.site"],["https://notevents.webpushr.com","https://notevents-push.17lai.site"]]);function isProxyRequired(url){const requestUrl=new URL(url);for(const[origin,proxyUrl]of proxyMap.entries()){const proxyOrigin=new URL(origin);if(requestUrl.origin===proxyOrigin.origin&&requestUrl.pathname.startsWith(proxyOrigin.pathname)){return proxyUrl}}return null}function getMirrorRequired(url){const requestUrl=new URL(url);for(const[origin,proxyUrl]of proxyMap.entries()){const proxyOrigin=new URL(origin);if(requestUrl.origin===proxyOrigin.origin&&requestUrl.pathname.startsWith(proxyOrigin.pathname)){const replacedUrl=url.replace(origin,proxyUrl);return replacedUrl}}return url}function refreshCacheList(cacheStorageKey){return caches.open(cacheStorageKey).then(cache=>{return Promise.all(cacheList.map(url=>{return cache.match(url).then(response=>{if(!response){console.log("[PWA] Resource not found in cache, fetching from network:",url);return fetch(url,{cache:"default"}).then(fetchResponse=>{if(fetchResponse.ok){console.log("[PWA] Caching resource:",url);cache.put(url,fetchResponse.clone());return fetchResponse}else{throw new Error(`Failed to fetch ${url}`)}})}else{return response}})}))}).catch(error=>{console.error("[PWA] Failed to refresh cache list:",error)})}async function fetchData(request){try{return await fetch(request)}catch(error){throw error}}self.addEventListener("fetch",event=>{if(isProxyRequired(event.request.url)){event.respondWith(handleProxyRequest(event.request))}else{event.respondWith(caches.open(cacheStorageKey).then(cache=>cache.match(event.request,{ignoreSearch:true})).then(response=>{return response||fetchData(event.request)}))}});async function handleProxyRequest(request){try{const cacheResponse=await caches.match(request,{ignoreSearch:true});if(cacheResponse){return cacheResponse}else{return fetchData(request).then(response=>{if(response.ok){return response}else{return fetchData(new Request(getMirrorRequired(request.url),request)).then(response=>{return response})}}).catch(error=>{return fetch(request)})}}catch(error){console.error("[PWA] Proxy request failed:",error);return fetch(request)}}